!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(this,(function(){return(()=>{"use strict";var e,t,n,o,a,s,i,r,c,d,l,h,u,p,m,g,f,w,T,I,y,E={d:(e,t)=>{for(var n in t)E.o(t,n)&&!E.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},v={};E.r(v),E.d(v,{IdOption:()=>y,setup:()=>mr}),function(e){let t,n,o;!function(e){e.PHASE_CHANGE="application.phasechange"}(t=e.Event||(e.Event={})),function(e){e.UNINITIALIZED="appphase.uninitialized",e.WAITING="appphase.waiting",e.LOADING="appphase.loading",e.STARTING="appphase.starting",e.PLAYING="appphase.playing",e.ERROR="appphase.error"}(n=e.Phase||(e.Phase={})),function(e){e.UNKNOWN="application.unknown",e.WEBVR="application.webvr",e.SHOWCASE="application.showcase",e.WORKSHOP="application.workshop"}(o=e.Application||(e.Application={}))}(e||(e={})),function(e){let t,n;!function(e){e.MOVE="camera.move"}(t=e.Event||(e.Event={})),function(e){e.FORWARD="FORWARD",e.LEFT="LEFT",e.RIGHT="RIGHT",e.BACK="BACK",e.UP="UP",e.DOWN="DOWN"}(n=e.Direction||(e.Direction={}))}(t||(t={})),function(e){let t;!function(e){e.CHANGE_START="floors.changestart",e.CHANGE_END="floors.changeend"}(t=e.Event||(e.Event={}))}(n||(n={})),function(e){let t;!function(e){e.SUCCESS="astar.status.success",e.NO_PATH="astar.status.no_path",e.TIMEOUT="astar.status.timeout",e.NO_START_VERTEX="astar.status.no_start",e.NO_END_VERTEX="astar.status.no_end"}(t=e.AStarStatus||(e.AStarStatus={}))}(o||(o={})),function(e){let t;!function(e){e.POSITION_UPDATED="label.positionupdated"}(t=e.Event||(e.Event={}))}(a||(a={})),function(e){let t,n;!function(e){e.WINDOW="link.creationpolicy.window",e.REFERRER="link.creationpolicy.referrer",e.MATTERPORT="link.creationpolicy.matterport"}(t=e.CreationPolicy||(e.CreationPolicy={})),function(e){e.DEFAULT="link.openpolicy.deafult",e.NEW_WINDOW="link.openpolicy.newwindow",e.SAME_FRAME="link.openpolicy.sameframe",e.CURRENT_WINDOW="link.openpolicy.current"}(n=e.OpenPolicy||(e.OpenPolicy={}))}(s||(s={})),function(e){let t,n,o,a,s;!function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(t=e.Transition||(e.Transition={})),function(e){e.NAVIGATION="tag.link.nav",e.MODEL="tag.link.model",e.EXT_LINK="tag.link.ext"}(n=e.LinkType||(e.LinkType={})),function(e){e.NONE="tag.chunk.none",e.TEXT="tag.chunk.text",e.LINK="tag.chunk.link"}(o=e.DescriptionChunkType||(e.DescriptionChunkType={})),function(e){e.HOVER="tag.hover",e.CLICK="tag.click",e.LINK_OPEN="tag.linkopen"}(a=e.Event||(e.Event={})),function(e){e.NONE="mattertag.media.none",e.PHOTO="mattertag.media.photo",e.VIDEO="mattertag.media.video",e.RICH="mattertag.media.rich"}(s=e.MediaType||(e.MediaType={}))}(i||(i={})),function(e){let t,n,o;!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(t=e.Mode||(e.Mode={})),function(e){e.CHANGE_START="viewmode.changestart",e.CHANGE_END="viewmode.changeend"}(n=e.Event||(e.Event={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(o=e.TransitionType||(e.TransitionType={}))}(r||(r={})),function(e){let t;!function(e){e.MODEL_LOADED="model.loaded"}(t=e.Event||(e.Event={}))}(c||(c={})),function(e){let t;!function(e){e.NONE="intersectedobject.none",e.MODEL="intersectedobject.model",e.TAG="intersectedobject.tag",e.SWEEP="intersectedobject.sweep",e.UNKNOWN="intersectedobject.unknown"}(t=e.Colliders||(e.Colliders={}))}(d||(d={})),function(e){let t,n;!function(e){e.CAMERA="sensor.sensortype.camera"}(t=e.SensorType||(e.SensorType={})),function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}(n=e.SourceType||(e.SourceType={}))}(l||(l={})),function(e){let t,n,o,a;!function(e){e.ENTER="sweep.enter",e.EXIT="sweep.exit"}(t=e.Event||(e.Event={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(n=e.Transition||(e.Transition={})),function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(o=e.Alignment||(e.Alignment={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(a=e.Placement||(e.Placement={}))}(h||(h={})),function(e){let t;!function(e){e.UNKNOWN="tag.attachment.unknown",e.APPLICATION="tag.attachment.application",e.AUDIO="tag.attachment.audio",e.IMAGE="tag.attachment.image",e.MODEL="tag.attachment.model",e.PDF="tag.attachment.pdf",e.RICH="tag.attachment.rich",e.TEXT="tag.attachment.text",e.VIDEO="tag.attachment.video",e.ZIP="tag.attachment.zip",e.SANDBOX="tag.attachment.sandbox"}(t=e.AttachmentType||(e.AttachmentType={}))}(u||(u={})),function(e){let t,n;!function(e){e.STARTED="tour.started",e.STOPPED="tour.stopped",e.ENDED="tour.ended",e.STEPPED="tour.stepped"}(t=e.Event||(e.Event={})),function(e){e.INACTIVE="tour.inactive",e.ACTIVE="tour.active",e.STOP_SCHEDULED="tour.stopscheduled"}(n=e.PlayState||(e.PlayState={}))}(p||(p={})),function(e){let t,n,o;!function(e){e.OBJ_LOADER="mp.objLoader",e.FBX_LOADER="mp.fbxLoader",e.DAE_LOADER="mp.daeLoader",e.GLTF_LOADER="mp.gltfLoader",e.SCROLLING_TUBE="mp.scrollingTube",e.TRANSFORM_CONTROLS="mp.transformControls",e.LIGHTS_COMPONENT="mp.lights",e.POINT_LIGHT="mp.pointLight",e.DIRECTIONAL_LIGHT="mp.directionalLight",e.AMBIENT_LIGHT="mp.ambientLight",e.CAMERA="mp.camera",e.INPUT="mp.input",e.XR="mp.xr"}(t=e.Component||(e.Component={})),function(e){e.CLICK="INTERACTION.CLICK",e.HOVER="INTERACTION.HOVER",e.DRAG="INTERACTION.DRAG",e.DRAG_BEGIN="INTERACTION.DRAG_BEGIN",e.DRAG_END="INTERACTION.DRAG_END",e.POINTER_MOVE="INTERACTION.POINTER_MOVE",e.POINTER_BUTTON="INTERACTION.POINTER_BUTTON",e.SCROLL="INTERACTION.SCROLL",e.KEY="INTERACTION.KEY",e.LONG_PRESS_START="INTERACTION.LONG_PRESS_START",e.LONG_PRESS_END="INTERACTION.LONG_PRESS_END",e.MULTI_SWIPE="INTERACTION.MULTI_SWIPE",e.MULTI_SWIPE_END="INTERACTION.MULTI_SWIPE_END",e.PINCH="INTERACTION.PINCH",e.PINCH_END="INTERACTION.PINCH_END",e.ROTATE="INTERACTION.ROTATE",e.ROTATE_END="INTERACTION.ROTATE_END"}(n=e.InteractionType||(e.InteractionType={})),function(e){e.INPUT="input",e.OUTPUT="output",e.EVENT="event",e.EMIT="emit"}(o=e.PathType||(e.PathType={}))}(m||(m={})),function(e){e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.RETURN=13]="RETURN",e[e.SHIFT=16]="SHIFT",e[e.CONTROL=17]="CONTROL",e[e.ALT=18]="ALT",e[e.ESCAPE=27]="ESCAPE",e[e.SPACE=32]="SPACE",e[e.HASH=35]="HASH",e[e.LEFTARROW=37]="LEFTARROW",e[e.UPARROW=38]="UPARROW",e[e.RIGHTARROW=39]="RIGHTARROW",e[e.DOWNARROW=40]="DOWNARROW",e[e.DELETE=46]="DELETE",e[e.ZERO=48]="ZERO",e[e.ONE=49]="ONE",e[e.TWO=50]="TWO",e[e.THREE=51]="THREE",e[e.FOUR=52]="FOUR",e[e.FIVE=53]="FIVE",e[e.SIX=54]="SIX",e[e.SEVEN=55]="SEVEN",e[e.EIGHT=56]="EIGHT",e[e.NINE=57]="NINE",e[e.AT=64]="AT",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.SEMICOLON=186]="SEMICOLON",e[e.PLUSEQUALS=187]="PLUSEQUALS",e[e.COMMA=188]="COMMA",e[e.DASHUNDERSCORE=189]="DASHUNDERSCORE",e[e.PERIOD=190]="PERIOD",e[e.OPENBRACKET=219]="OPENBRACKET"}(g||(g={})),function(e){e[e.DOWN=0]="DOWN",e[e.PRESSED=1]="PRESSED",e[e.UP=2]="UP"}(f||(f={})),function(e){e[e.PRIMARY=0]="PRIMARY",e[e.MIDDLE=1]="MIDDLE",e[e.SECONDARY=2]="SECONDARY",e[e.BACK=3]="BACK",e[e.FORWARD=4]="FORWARD",e[e.COUNT=5]="COUNT"}(w||(w={})),function(e){e[e.NONE=0]="NONE",e[e.PRIMARY=1]="PRIMARY",e[e.SECONDARY=4]="SECONDARY",e[e.MIDDLE=2]="MIDDLE",e[e.BACK=8]="BACK",e[e.FORWARD=16]="FORWARD",e[e.ALL=31]="ALL"}(T||(T={}));class C{constructor(e){this.directionMap={[t.Direction.FORWARD]:e.FORWARD.clone(),[t.Direction.LEFT]:e.LEFT.clone(),[t.Direction.RIGHT]:e.RIGHT.clone(),[t.Direction.BACK]:e.BACK.clone(),[t.Direction.UP]:e.UP.clone(),[t.Direction.DOWN]:e.DOWN.clone()}}toVector(e){return this.directionMap[e]}}class A{constructor(e){this.CwfViewmode=e}toSdk(e,t){switch(e){case this.CwfViewmode.Panorama:return t?r.Mode.INSIDE:r.Mode.OUTSIDE;case this.CwfViewmode.Dollhouse:return r.Mode.DOLLHOUSE;case this.CwfViewmode.Floorplan:return r.Mode.FLOORPLAN;case this.CwfViewmode.Transition:return r.Mode.TRANSITIONING;case this.CwfViewmode.Outdoor:return r.Mode.OUTSIDE;default:return r.Mode.INSIDE}}fromSdk(e){switch(e){case r.Mode.INSIDE:case r.Mode.OUTSIDE:return this.CwfViewmode.Panorama;case r.Mode.DOLLHOUSE:return this.CwfViewmode.Dollhouse;case r.Mode.FLOORPLAN:return this.CwfViewmode.Floorplan;case r.Mode.TRANSITIONING:return this.CwfViewmode.Transition}}}class S{constructor(e){this.CommandMode=e}toSdk(e){switch(e){case this.CommandMode.INSIDE:return r.Mode.INSIDE;case this.CommandMode.DOLLHOUSE:return r.Mode.DOLLHOUSE;case this.CommandMode.FLOORPLAN:return r.Mode.FLOORPLAN;case this.CommandMode.TRANSITIONING:return r.Mode.TRANSITIONING;case this.CommandMode.OUTSIDE:return r.Mode.OUTSIDE;default:return r.Mode.INSIDE}}fromSdk(e){switch(e){case r.Mode.INSIDE:return this.CommandMode.INSIDE;case r.Mode.OUTSIDE:return this.CommandMode.OUTSIDE;case r.Mode.DOLLHOUSE:return this.CommandMode.DOLLHOUSE;case r.Mode.FLOORPLAN:return this.CommandMode.FLOORPLAN;case r.Mode.TRANSITIONING:return this.CommandMode.TRANSITIONING}}}!function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade",e.MOVEFADE="transition.movefade"}(I||(I={}));class b{constructor(e){this.toSdkTransitionMap={[e.Interpolate]:I.FLY,[e.FadeToBlack]:I.FADEOUT,[e.Instant]:I.INSTANT,[e.MoveToBlack]:I.MOVEFADE},this.fromSdkTransitionMap={[I.FLY]:e.Interpolate,[I.FADEOUT]:e.FadeToBlack,[I.INSTANT]:e.Instant,[I.MOVEFADE]:e.MoveToBlack}}toSdkTransition(e){return this.toSdkTransitionMap[e]}fromSdkTransition(e){return this.fromSdkTransitionMap[e]}}class D{constructor(e){this.THREE=e,this.tempEuler=new e.Euler}quaternionToRotation(e,t){const n=this.tempEuler.setFromQuaternion(e,D.eulerOrder),o=t||{};return o.x=this.THREE.MathUtils.radToDeg(n.x),o.y=this.THREE.MathUtils.radToDeg(n.y),o.z=this.THREE.MathUtils.radToDeg(n.z),o}rotationToQuaternion(e,t){const n=t||new this.THREE.Quaternion;return this.tempEuler.x=this.THREE.MathUtils.degToRad(e.x),this.tempEuler.y=this.THREE.MathUtils.degToRad(e.y),this.tempEuler.z=this.THREE.MathUtils.degToRad(e.z||0),this.tempEuler.order=D.eulerOrder,n.setFromEuler(this.tempEuler)}}D.eulerOrder="YXZ";class O{constructor(e){this.CwfSweepAlignmentType=e}isSweepAligned(e,t){if(!e||!t)return!1;const n=t&&e.getSweep(t);return!!n&&n.alignmentType===this.CwfSweepAlignmentType.ALIGNED}isCurrentSweepAligned(e){return this.isSweepAligned(e,e.currentSweep)}}!function(e){e.LEGACY="legacy",e.API="api"}(y||(y={}));class M{constructor(e){this.sweepData=e}getIdForSweep(e){return e.uuid}getSweepForId(e){return this.sweepData.getSweepByUuid(e)}getIdFromCwfId(e){const t=this.sweepData.getSweep(e);return this.getIdForSweep(t)}}class N{constructor(e){this.sweepData=e}getIdForSweep(e){return e.id}getSweepForId(e){return this.sweepData.getSweep(e)}getIdFromCwfId(e){const t=this.sweepData.getSweep(e);return this.getIdForSweep(t)}}class R{constructor(e){this.floorData=e}getIdForFloor(e){return String(e.index)}getFloorForId(e){return this.floorData.getFloorAtIndex(parseInt(e,10))}getIdFromCwfId(e){const t=this.floorData.getFloor(e);return this.getIdForFloor(t)}}class P{constructor(e){this.floorData=e}getIdForFloor(e){return e.id}getFloorForId(e){return this.floorData.getFloor(e)}getIdFromCwfId(e){const t=this.floorData.getFloor(e);return this.getIdForFloor(t)}}class L{constructor(e,t){this.roomData=e,this.floorData=t}getIdForRoom(e){const t=this.floorData.getFloor(e.floorId);return t?String((t.index<<16)+e.meshSubgroup):""}getRoomForId(e){return this.roomData.getByMeshSubgroup(65535&parseInt(e,10))}getIdFromCwfId(e){const t=this.roomData.get(e);return this.getIdForRoom(t)}}class x{constructor(e){this.roomData=e}getIdForRoom(e){return e.id}getRoomForId(e){return this.roomData.get(e)}getIdFromCwfId(e){const t=this.roomData.get(e);return this.getIdForRoom(t)}}class k{constructor(t){this.toSdkPhaseMap={[t.UNINITIALIZED]:e.Phase.UNINITIALIZED,[t.WAITING]:e.Phase.WAITING,[t.LOADING]:e.Phase.LOADING,[t.STARTING]:e.Phase.STARTING,[t.PLAYING]:e.Phase.PLAYING,[t.ERROR]:e.Phase.ERROR},this.fromSdkPhaseMap={[e.Phase.UNINITIALIZED]:t.UNINITIALIZED,[e.Phase.WAITING]:t.WAITING,[e.Phase.LOADING]:t.LOADING,[e.Phase.STARTING]:t.STARTING,[e.Phase.PLAYING]:t.PLAYING,[e.Phase.ERROR]:t.ERROR}}toSdkAppPhase(e){return this.toSdkPhaseMap[e]}fromSdkAppPhase(e){return this.fromSdkPhaseMap[e]}}class _{constructor(t){this.toSdkApplicationMap={[t.SHOWCASE]:e.Application.SHOWCASE,[t.WORKSHOP]:e.Application.WORKSHOP,[t.WEBVR]:e.Application.WEBVR,[t.UNKNOWN]:e.Application.UNKNOWN},this.fromSdkApplicationMap={[e.Application.SHOWCASE]:t.SHOWCASE,[e.Application.WORKSHOP]:t.WORKSHOP,[e.Application.WEBVR]:t.WEBVR,[e.Application.UNKNOWN]:t.UNKNOWN}}toSdkApplication(e){return this.toSdkApplicationMap[e]}fromSdkApplication(e){return this.fromSdkApplicationMap[e]}}class V{constructor(e,t,n){this.dependencies=e,this.subscriptionFactory=t,this.observers=new Set,this.currentData=n.create(),this.freshDataCache=n.create()}static async create(e,t,n){const o=await e.getDependencies();return new V(o,t,n)}getData(){return this.currentData.data}subscribe(e){return this.addObserver(e),new class{constructor(e){this.sdkObservable=e,this.renew()}renew(){this.sdkObservable.addObserver(e)}cancel(){this.sdkObservable.removeObserver(e)}}(this)}addObserver(e){if(!this.observers.has(e)){class t{constructor(e){this.observable=e}onChanged(){this.observable.onChanged()}}this.observers.add(e),1===this.observers.size&&(this.currentData.update(...this.dependencies),this.changeSubscription=this.subscriptionFactory.create(new t(this),...this.dependencies)),e.dirty=!0}}removeObserver(e){0!==this.observers.size&&(this.observers.delete(e),0===this.observers.size&&this.changeSubscription.cancel())}onChanged(){if(this.freshDataCache.update(...this.dependencies),!this.currentData.equals(this.freshDataCache)){this.currentData.copy(this.freshDataCache);for(const e of this.observers)e.dirty=!0}}}class F{constructor(e,...t){this.ctor=e,this.args=t}create(...e){return new this.ctor(...this.args,...e)}}const U=e=>"propertyObservers"===e||"changeObservers"===e||"isObservable"===e||"childChangeFunctions"===e||"isObservableProxy"===e||"diffRoot"===e||"elementChangedHandlers"===e||"knownKeysMap"===e||"knownKeysList"===e||"isVector2"===e||"isVector3"===e||"isQuaternion"===e||"onPropertyChanged"===e||"removeOnPropertyChanged"===e||"onChanged"===e||"target"===e,G=(e,t=[])=>{if(void 0!==e){if(t.includes(e))return Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};if(e instanceof Date)return new Date(e);if(null===e)return null;if(e.deepCopy)return e.deepCopy();if(e.isQuaternion)return{x:e.x,y:e.y,z:e.z,w:e.w};if("object"==typeof e){const n=Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};for(const o in e){if(U(o))continue;const a=e[o];a instanceof Date?n[o]=new Date(a):"function"!=typeof a&&(t.push(e),n[o]="object"==typeof a?G(a,t):a,t.pop())}return n}return e}},H=(e,t)=>{if(null===e||"object"!=typeof e)return e!==t;if(!t)return!0;for(const n in t)if(!(n in e))return!0;for(const n in e)if(H(e[n],t[n]))return!0;return!1};class z{create(e,t){return t.onChanged((()=>e.onChanged()))}}class B{constructor(t,n){this._data={phase:e.Phase.UNINITIALIZED,phaseTimes:{},application:e.Application.SHOWCASE},this.AppPhase=t.AppPhase,this.appPhaseConverter=n.appPhaseConverter,this.applicationConverter=n.applicationConverter}get data(){return this._data}equals(e){return!H(this,e)}copy(e){this._data.phase=e.data.phase,function(e,t,...n){for(const o of n)e[o]=t[o]}(this.data.phaseTimes,e.data.phaseTimes),this._data.application=e.data.application}update(t){this._data.phase=this.appPhaseConverter.toSdkAppPhase(t.phase),this._data.application=this.applicationConverter.toSdkApplication(t.application),this._data.phaseTimes[e.Phase.WAITING]=t.phaseTimes[this.AppPhase.WAITING],this._data.phaseTimes[e.Phase.LOADING]=t.phaseTimes[this.AppPhase.LOADING],this._data.phaseTimes[e.Phase.PLAYING]=t.phaseTimes[this.AppPhase.PLAYING],this._data.phaseTimes[e.Phase.STARTING]=t.phaseTimes[this.AppPhase.STARTING],this._data.phaseTimes[e.Phase.UNINITIALIZED]=t.phaseTimes[this.AppPhase.UNINITIALIZED],this._data.phaseTimes[e.Phase.ERROR]=t.phaseTimes[this.AppPhase.ERROR]}}class j{}class W extends j{constructor(){super(),this.id="GET_APP_STATE"}}class q extends j{constructor(){super(),this.id="GET_APP_PHASE_TIMES"}}var $,K;!function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH",e[e.HIGHEST=3]="HIGHEST"}($||($={})),function(e){e[e.PENDING=0]="PENDING",e[e.SENDING=1]="SENDING",e[e.FAILED=2]="FAILED",e[e.DONE=3]="DONE"}(K||(K={}));const Y=new WeakMap;class X{constructor({retries:e=0,concurrency:t=6}={}){this.totalBytesDownloaded=0,this.queue=[],this.retries=e,this.concurrency=t}get(e,t){return this.request("GET",e,t)}head(e,t){return this.request("HEAD",e,t)}options(e,t){return this.request("OPTIONS",e,t)}post(e,t){return this.request("POST",e,t)}put(e,t){return this.request("PUT",e,t)}patch(e,t){return this.request("PATCH",e,t)}delete(e,t){return this.request("DELETE",e,t)}request(e,t,n){const o=new Z(e,t,n);if(null==n?void 0:n.signal){const e=()=>{this.queue.includes(o)&&(o.status===K.SENDING&&o.abort(),this.dequeue(o),o.onFail(new DOMException("Aborted","AbortError")))};n.signal.addEventListener("abort",e),Y.set(o,(()=>{var t;null===(t=n.signal)||void 0===t||t.removeEventListener("abort",e),Y.delete(o)}))}return this.enqueue(o),o.promise}update(){let e;for(;e=this.getNextPendingRequest();)this.sendRequest(e);for(;e=this.getNextOverflowingGet();)e.abort(),e.status=K.PENDING;this.updateTimeout=null}enqueue(e){let t=0;for(t=0;t<this.queue.length;t++){if(this.queue[t].priority<e.priority)break}this.queue.splice(t,0,e),this.updateTimeout||(this.updateTimeout=window.setTimeout((()=>{this.update()}),1))}dequeue(e){var t;null===(t=Y.get(e))||void 0===t||t();const n=this.queue.indexOf(e);if(-1===n)throw new Error("Can't dequeue request not in queue");this.queue.splice(n,1),this.update()}getNextPendingRequest(){for(let e=0;e<this.queue.length&&e<this.concurrency;e++){const t=this.queue[e];if(t.status===K.PENDING)return t}return null}getNextOverflowingGet(){for(let e=this.concurrency;e<this.queue.length;e++){const t=this.queue[e];if(t.status===K.SENDING&&t.priority!==$.HIGHEST&&"GET"===t.method)return t}return null}shouldRetryStatusCode(e){return!X.doNotRetryStatusCodes[e]}sendRequest(e){e.status=K.SENDING,e.send().then((t=>{e.status=K.DONE,this.dequeue(e),e.contentLength&&e.contentLength>0&&(this.totalBytesDownloaded+=Number(e.contentLength)),e.onDone(t)})).catch((t=>{const n=null!==e.maxRetries?e.maxRetries:this.retries;let o=e.sendAttempts<n;if("object"==typeof t){const e=t.status_code||0;o=o&&this.shouldRetryStatusCode(e)}o?(e.status=K.PENDING,this.update(),console.warn(`Retried ${e.url}`),console.warn(t)):(e.status=K.FAILED,this.dequeue(e),console.warn(`Failed ${e.url}`),e.onFail(t))}))}}X.doNotRetryStatusCodes={400:!0,401:!0,403:!0,404:!0,405:!0,406:!0,410:!0,411:!0,414:!0,415:!0,421:!0,431:!0,451:!0};class Z{constructor(e,t,n={}){this.sendAttempts=0,this.status=K.PENDING,this.contentLength=0,this.isAborting=!1,this.url=t,this.method=e,this.auth=n.auth||null,this.withCredentials=n.withCredentials||!1,this.priority=n.priority||$.MEDIUM,this.responseType=n.responseType||null,this.body=n.body||null,this.headers=n.headers||{},this.maxRetries=n.maxRetries||null,this.onProgress=n.onProgress,this.promise=new Promise(((e,t)=>{this.onDone=e,this.onFail=t}))}send(){const e=this.xhr=function(e,t,n){let o;if("undefined"!=typeof XMLHttpRequest)o=new XMLHttpRequest,o.withCredentials=n;else{if("undefined"==typeof XDomainRequest)throw new Error("No XMLHTTPRequest or XDomainRequest... are you trying to run me in node? :(");o=new XDomainRequest}return o.open(e,t,!0),o}(this.method,this.url,this.withCredentials);if(this.responseType)if("arraybuffer"===this.responseType||"text"===this.responseType||"json"===this.responseType||"blob"===this.responseType)e.responseType=this.responseType;else{if("image"!==this.responseType)throw new Error('reponseType can only be one of "arraybuffer", "text", "json", "blob", "image"');e.responseType="blob"}"json"===this.responseType&&e.setRequestHeader("Accept","application/json"),this.auth&&"string"==typeof this.auth&&e.setRequestHeader("Authorization",this.auth);for(const t in this.headers)e.setRequestHeader(t,this.headers[t]);return this.body&&"object"==typeof this.body&&(this.body instanceof FormData||(this.body=JSON.stringify(this.body),e.setRequestHeader("Content-Type","application/json"))),this.onProgress&&(e.onprogress=this.onProgress),new Promise(((t,n)=>{e.onreadystatechange=()=>{if(4===e.readyState){if(200===e.status||201===e.status||204===e.status)return this.parseResponse(this.xhr).then((e=>{t(e)}));if(!this.isAborting)return this.parseResponse(this.xhr).then((t=>{n(Object.assign({status_code:e.status},t))})).catch((()=>{n({status_code:e.status})}));this.isAborting=!1}},e.onerror=function(e){n(e)},e.send(this.body),this.sendAttempts++}))}parseResponse(e){return new Promise(((t,n)=>{var o;try{if(!e)throw new Error(`No request received. Trying ${this.method} on ${this.url} and expecting ${this.responseType}, but request was ${this.xhr}`);let n=e.response;if(this.contentLength=parseInt(null!==(o=e.getResponseHeader("Content-Length"))&&void 0!==o?o:"0",10),"json"===this.responseType&&"object"!=typeof n)t(JSON.parse(e.responseText));else if(200!==e.status&&201!==e.status&&204!==e.status||"image"!==this.responseType)t(n);else{const e=URL.createObjectURL(n);n=new Image,n.src=e,n.crossOrigin="Anonymous",n.onload=function(){URL.revokeObjectURL(e),t(n)}}}catch(e){n({error:"Payload was not valid JSON"})}}))}abort(){if(null===this.xhr)throw new Error("Cannot abort unsent Request");this.isAborting=!0,this.xhr.abort()}}const Q=window.navigationStart||Date.now();var J;!function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG"}(J||(J={}));class ee{constructor(e){this.timers={},this.handlers={[J.DEBUG]:console.debug,[J.INFO]:console.info,[J.WARN]:console.warn,[J.ERROR]:console.error};const t=e.split(new RegExp("/|\\\\"));this.prefix="["+t[t.length-1].replace(".js","")+"]"}message(e){if(ee.level>=e&&console){return(this.handlers[e]?this.handlers[e]:console.log).bind(console,this.getPrefix())}return()=>{}}get debug(){return this.message(J.DEBUG)}get devInfo(){return()=>{}}get debugInfo(){return this.debug}get debugWarn(){return this.message(ee.level>=J.DEBUG?J.WARN:J.DEBUG)}get info(){return this.message(J.INFO)}get warn(){return this.message(J.WARN)}get error(){return this.message(J.ERROR)}time(e){ee.level>=J.DEBUG&&(this.timers[e]=Date.now())}timeEnd(e){if(ee.level>=J.DEBUG){const t=this.timers[e];if(!t)return;const n=(Date.now()-t)/1e3;this.debug(e,n+"s")}}getPrefix(){const e=(Date.now()-Q)/1e3+"s";return`${this.prefix} ${e}`}}ee.level=J.INFO;const te=new ee("sdk command");class ne{constructor(e){this._executor=e}static async create(e,t){const n=await e.getDependencies();return new ne(t.create(...n))}get executor(){return this._executor}exec(e,t){const n=this.executor.validateInput(e,t);return this.executor.exec(n,t)}}function oe(e,t,n){return`'${e}' is expected to be a(n) ${t}; got '${JSON.stringify(n)}'`}function ae(e,t,n){return e.exec(t,n)}function se(e,t,...n){return new F(class{constructor(...t){this.executor=e.create(...n,...t)}validateInput(e,n){return te.warn(t),this.executor.validateInput(e,n)}exec(e,t){return this.executor.exec(e,t)}})}function ie(e){return!!e&&"string"==typeof e}function re(e){return"string"==typeof e}class ce{constructor(){this.base=new Promise(((e,t)=>{this.resolver=e,this.rejecter=t})),this._promise=new de(this.base,this),this.progressCallbacks=[]}then(e,t){return this.base.then(e,t)}catch(e){return this.base.catch(e)}resolve(e){return this.resolver(e),this}reject(e){return this.rejecter(e),this}notify(e){for(const t of this.progressCallbacks)t(e)}progress(e){return this.progressCallbacks.push(e),this}promise(){return this._promise}nativePromise(){return this.base}static resolve(){const e=new ce;return e.resolve(),e.promise()}static reject(e){const t=new ce;return t.reject(e),t.promise()}static all(e){const t=[];for(const n of e)n.nativePromise?t.push(n.nativePromise()):t.push(n);const n=new ce;return Promise.all(t).then((e=>n.resolve(e)),(e=>n.reject(e))),n.promise()}}class de{constructor(e,t){this.basePromise=e,this.baseDeferred=t}then(e,t){return this.baseDeferred.then(e,t),this}catch(e){return this.baseDeferred.catch(e),this}progress(e){return this.baseDeferred.progress(e),this}nativePromise(){return this.basePromise}}const le=new ee("asset.registerTexture");class he{constructor(e,t,n){this.THREE=e,this.loadImage=t,this.scopedTextures=n,this.svgLoader=new ue(new X)}validateInput(e,t){const{textureId:n,textureSrc:o}=e;if(!ie(n))throw Error(`textureId ${n} is not a valid string`);if(!ie(o))throw Error(`textureSrc ${o} is not a valid string`);const a=this.scopedTextures.get(t.applicationKey);if(a){if(a.map[n])throw Error(n+" already has a registered texture")}return{textureId:n,textureSrc:o}}async exec(e,t){const{textureId:n,textureSrc:o}=e,a=this.scopedTextures.get(t.applicationKey)||{imagePromise:{},map:{}};this.scopedTextures.set(t.applicationKey,a);const[s,i]=o.endsWith(".svg")?this.loadSvgTexture(o):this.loadImageTexture(o);a.imagePromise[n]=i;try{const e=await i;s.image=e,s.needsUpdate=!0,a.map[n]=s}catch(e){throw delete a.imagePromise[n],Error(e)}}loadImageTexture(e){const t=new ce,n=this.loadImage(e,(()=>t.resolve(n.image)),(e=>t.reject(e)));return[n,t.nativePromise()]}loadSvgTexture(e){return[new this.THREE.Texture,this.svgLoader.load(e)]}}class ue{constructor(e){this.queue=e}async load(e){const t=await this.queue.get(e,{responseType:"text"}),n=document.createElement("div");n.innerHTML=t;const o=n.querySelector("svg");if(!o)throw Error("Failed trying to load "+e+"as an svg.");const a=o.getAttribute("width"),s=o.getAttribute("height");return a||s?(s&&!a&&(le.warn(e,"does not have a defined width. Defaulting width equal to height"),o.setAttribute("width",s)),a&&!s&&(le.warn(e,"does not have a defined height. Defaulting height equal to width"),o.setAttribute("height",a))):(le.warn(e,"does not have a defined size. Defaulting to a 128x128 resolution"),o.setAttribute("width",ue.defaultResolution),o.setAttribute("height",ue.defaultResolution)),new Promise((e=>{const t=new Image;t.onload=()=>e(t),t.src=URL.createObjectURL(new Blob([o.outerHTML],{type:"image/svg+xml"}))}))}}ue.defaultResolution="128";class pe{constructor(...e){this.dependencies=e}async getDependencies(){return Promise.all(this.dependencies)}static extend(e,...t){return new pe(...e.dependencies,...t)}static combine(e,t){return new pe(...e.dependencies,...t.dependencies)}}function me(e,t,n,o){return{registerTexture:function(e,t,n,o){const a=ne.create(o,new F(he,t,n.loadImage));return e.addAsyncCommandToInterface({namespace:"Asset",name:"registerTexture",args:["textureId","textureSrc"]},a),a}(e,t,n,new pe(o.iconMaps))}}class ge extends j{constructor(){super(),this.id="GET_POSE"}}const fe=40*Math.PI/180/1e3;class we extends j{constructor(e){super(),this.payload=e}}const Te=new ee("broadcast.move");function Ie(e,t){return Object.values(e).includes(t)}class ye extends j{constructor(e){super(),this.id="MOVE_DIRECTION",this.payload=e}}class Ee extends j{constructor(e){super(),this.id="PAN",this.payload={x:e.x,z:e.z}}}class ve{constructor(...e){this.subs=e}renew(){for(const e of this.subs)e.renew()}cancel(){for(const e of this.subs)e.cancel()}}function Ce(e,t){e.x=t.x,e.y=t.y}function Ae(e,t){Ce(e,t),e.z=t.z}class Se extends Error{constructor(e,t){var n;super(e instanceof Error?e.message:e),this.name="BaseException",t&&(this.code=t),e instanceof Error&&(this.originalError=e,(n=e)&&n instanceof Error&&n.isMock&&(this.isMock=!0))}}function be(e,t){const n=t.length;e.length=n;for(let o=0;o<n;++o)e[o]=t[o];return e}class De extends Se{constructor(){super("Cannot copy into an array of a different size"),this.name="ArraySizeMismatch"}}const Oe=(e,t,n=1e-5)=>Math.abs(e-t)<=n,Me=(e,t,n=1e-5)=>Oe(e.x,t.x,n)&&Oe(e.y,t.y,n),Ne=(e,t,n=1e-5)=>Me(e,t,n)&&Oe(e.z,t.z,n);class Re{create(e,t,n,o){const a=()=>e.onChanged();return new ve(t.onChanged(a),n.onChanged(a),o.onChanged(a))}}class Pe{constructor(e,t){this._data={position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:r.Mode.TRANSITIONING},this.THREE=e,this.viewmodeConverter=t,this.tempEuler=new e.Euler}get data(){return this._data}equals(e){const t=1e-5;return Ne(e._data.position,this._data.position,t)&&Me(e._data.rotation,this._data.rotation,t)&&((e,t,n=1e-5)=>e.length===t.length&&!Array.prototype.some.call(e,((e,o)=>!Oe(e,t[o],n))))(e._data.projection,this._data.projection,t)&&e._data.sweep===this._data.sweep&&e._data.mode===this._data.mode}update(e,t,n,o){const a=this.tempEuler.setFromQuaternion(e.pose.rotation,"YXZ"),s=t.currentSweep&&t.isSweepUnaligned(t.currentSweep);Ae(this._data.position,e.pose.position),this._data.rotation.x=this.THREE.MathUtils.radToDeg(a.x),this._data.rotation.y=this.THREE.MathUtils.radToDeg(a.y),this._data.projection=Float32Array.from(e.pose.projection.asThreeMatrix4().transpose().elements),this._data.sweep=t.currentSweepObject?o.getIdForSweep(t.currentSweepObject):"",this._data.mode=this.viewmodeConverter.toSdk(n.currentMode,!s)}copy(e){Ae(this._data.position,e.data.position),Ce(this._data.rotation,e.data.rotation),function(e,t){if(e.byteLength!==t.byteLength)throw new De;const n=t.length;for(let o=0;o<n;++o)e[o]=t[o]}(this._data.projection,e.data.projection),this._data.sweep=e.data.sweep,this._data.mode=e.data.mode}}class Le extends j{constructor(e){super(),this.id="ROTATE",this.payload={xAngle:e.xAngle,yAngle:e.yAngle,zAngle:e.zAngle,rotationSpeed:e.rotationSpeed}}}function xe(e,t,n){const o=new e.Euler,a=new e.Euler;return async function(e,s,i,r){if(i.currentMode!==t.Panorama)throw Error("Camera.setRotation is only available in Panorama mode");const c=r.xAngle%(.5*Math.PI),d=r.yAngle%(2*Math.PI),l=e.pose.rotation;o.setFromQuaternion(l,"YXZ");let h=d-o.y;return Math.abs(h)>Math.PI&&(h-=2*Math.sign(h)*Math.PI),a.set(c-o.x,h,0,"YXZ"),a.y%=2*Math.PI,n(s,{xAngle:-a.y,yAngle:a.x,zAngle:0,rotationSpeed:r.rotationSpeed})}}class ke extends Le{}const _e=.7,Ve=3,Fe=function(e,t,n){return Math.max(t,Math.min(e,n))};const Ue=new ee("command.zoom");class Ge{constructor(e,t,n,o){this.cameraData=n,this.viewmodeData=o,this.Viewmode=e.Viewmode,this.ZoomSetCommand=e.ZoomSetCommand,this.issueCommand=t.issueCommand}validateInput(e){const t=e.zoomPct-0;if(isNaN(t))throw Error(t+" is not a valid zoom level");return t<_e&&Ve<t&&(e.zoomPct=Fe(t,_e,Ve),Ue.warn(t,`is outside the valid zoom range of [${_e}, ${Ve}]`)),e}async exec(e,t){return Be(this.Viewmode,this.viewmodeData.currentMode),await this.issueCommand(new this.ZoomSetCommand(e.zoomPct)),this.cameraData.zoom()}}class He{constructor(e,t,n,o){this.cameraData=n,this.viewmodeData=o,this.Viewmode=e.Viewmode,this.ZoomInCommand=e.ZoomInCommand,this.issueCommand=t.issueCommand}validateInput(e){const t=e.zoomDelta-0;if(isNaN(t))throw Error(t+" is not a valid zoom delta");return e.zoomDelta=t||0,e}async exec(e,t){return Be(this.Viewmode,this.viewmodeData.currentMode),await this.issueCommand(new this.ZoomInCommand(e.zoomDelta)),this.cameraData.zoom()}}class ze{constructor(e,t,n,o){this.viewmodeData=o,this.Viewmode=e.Viewmode,this.ZoomResetCommand=e.ZoomResetCommand,this.issueCommand=t.issueCommand}validateInput(e){return e}async exec(e,t){Be(this.Viewmode,this.viewmodeData.currentMode),await this.issueCommand(new this.ZoomResetCommand)}}function Be(e,t){if(t!==e.Panorama)throw Error("Zoom controls are currently only supported in Panorama mode")}class je{create(e,t){return t.onChanged((()=>e.onChanged()))}}class We{constructor(e){this._data={level:1}}get data(){return this._data}equals(e){return this._data.level===e.data.level}copy(e){this._data.level=e.data.level}update(e,t){t.isInside()&&(this._data.level=e.zoom())}}function qe(e,t){const n=new e.Euler;return function(o,a,s,i,r){const c=n.setFromQuaternion(a.pose.rotation,"YXZ"),d=s.currentSweep&&s.isSweepUnaligned(s.currentSweep);return o.position.x=a.pose.position.x,o.position.y=a.pose.position.y,o.position.z=a.pose.position.z,o.rotation.x=e.MathUtils.radToDeg(c.x),o.rotation.y=e.MathUtils.radToDeg(c.y),o.projection=Float32Array.from(a.pose.projection.asThreeMatrix4().transpose().elements),o.sweep=s.currentSweepObject?r.getIdForSweep(s.currentSweepObject):"",o.mode=t.toSdk(i.currentMode,!d),o}}class $e{constructor(){this.wasInTransition=!1,this.currentFloor=""}create(e,t,n,o){return new ve(t.makeFloorChangeSubscription((()=>this.throttleCurrentFloorChanges(e,t))),o.onChanged((()=>this.throttleCameraTranstionChanges(e,o,n))),n.onChanged((()=>this.throttleCameraTranstionChanges(e,o,n))))}throttleCameraTranstionChanges(e,t,n){const o=t.transition.active||n.transition.active;o!==this.wasInTransition&&(this.wasInTransition=o,e.onChanged())}throttleCurrentFloorChanges(e,t){const n=t.currentFloorId;n!==this.currentFloor&&(this.currentFloor=n,e.onChanged())}}class Ke{constructor(e){this._data={id:void 0,sequence:void 0,name:""},this.SweepAlignmentType=e.SweepAlignmentType,this.SweepPlacementType=e.SweepPlacementType}get data(){return this._data}equals(e){const t=this.data,n=e.data;return t.id===n.id&&t.sequence===n.sequence&&t.name===n.name}copy(e){this._data.id=e.data.id,this._data.sequence=e.data.sequence,this._data.name=e.data.name}update(e,t,n,o){const a=e.currentFloor,s=t.currentSweep&&t.getSweep(t.currentSweep);n.transition.active&&!t.transitionActive||function(){if(t.transitionActive&&t.transition.to&&t.transition.from){const e=t.getSweep(t.transition.to),n=t.getSweep(t.transition.from);return e.floorId!==n.floorId}return!1}()?(this._data.id="",this._data.sequence=void 0,this._data.name=""):s&&s.alignmentType===this.SweepAlignmentType.UNALIGNED&&s.placementType===this.SweepPlacementType.UNPLACED?(this._data.id=void 0,this._data.sequence=void 0,this._data.name=""):a?(this._data.id=o.getIdFromCwfId(a.id),this._data.sequence=a.index,this._data.name=a.name):(this._data.id="",this._data.sequence=-1,this._data.name="all")}}class Ye{constructor(e,t,n){this.dependencies=e,this.subscriptionFactory=t,this.dataFactory=n,this.dirty=!0,this.observers=new Set,this.currentData=n.create(...e);this.changeSubscription=this.subscriptionFactory.create(new class{constructor(e){this.collection=e}onChanged(){this.collection.dirty=!0;for(const e of this.collection.observers)e.onChanged()}}(this),...this.dependencies),this.changeSubscription.cancel()}static async create(e,t,n){const o=await e.getDependencies();return new Ye(o,t,n)}getData(){return this.currentData.data}subscribe(e){const t=this.dependencies;const n=new class{constructor(e){this.sdkCollection=e,this.needsUpdate=!0,this.diffRecord={added:new Map,removed:new Map,updated:new Map},this.dataView=e.dataFactory.create(...t)}get dirty(){return this.needsUpdate}readDiff(){const{added:e,removed:t,updated:n}=this.diffRecord;if(e.clear(),t.clear(),n.clear(),!this.dirty)return this.diffRecord;this.sdkCollection.update();const o=this.sdkCollection.currentData;for(const t in o.data)this.dataView.data.hasOwnProperty(t)?this.dataView.isItemEqual(o,t)||n.set(t,o.data[t]):e.set(t,o.data[t]);for(const e in this.dataView.data)o.data.hasOwnProperty(e)||t.set(e,this.dataView.data[e]);return this.dataView.update(),this.needsUpdate=!1,this.diffRecord}onChanged(){this.needsUpdate=!0}renew(){this.sdkCollection.addObserver(this)}cancel(){this.sdkCollection.removeObserver(this)}}(this);return this.addObserver(n),n}update(){this.dirty&&(this.currentData.update(),this.dirty=!1)}addObserver(e){0===this.observers.size&&(this.changeSubscription.renew(),this.dirty=!0),this.observers.add(e)}removeObserver(e){this.observers.delete(e),0===this.observers.size&&(this.changeSubscription.cancel(),this.currentData.clear())}}class Xe{create(e,t){return t.onChanged((()=>e.onChanged()))}}class Ze{constructor(e,t){this.floorData=e,this.floorIdMap=t,this._data={}}get data(){return this._data}isItemEqual(e,t){const n=this.data[t],o=e.data[t];return n.id===o.id&&n.name===o.name&&n.sequence===o.sequence}update(){for(const e of this.floorData.getCollection()){const t=this.floorIdMap.getIdFromCwfId(e.id),n=this._data[t]||{};n.id=t,n.sequence=e.index,n.name=e.name,this._data[t]=n}for(const e in this.data){this.floorIdMap.getFloorForId(e)||delete this._data[e]}}clear(){this._data={}}}class Qe extends j{constructor(){super(...arguments),this.id="GET_FLOORS_DATA"}}async function Je(e){try{const{currentFloor:t,totalFloors:n}=e,o=e.getFloorNames();return{currentFloor:t?t.index:-1,floorNames:o,totalFloors:n}}catch(e){throw Error("no floors currently loaded")}}class et extends j{constructor(e){super(),this.id="MOVE_TO_FLOOR",this.payload=e}}class tt{constructor(e,t,n){this.floorsViewData=n,this.issueCommand=t.issueCommand,this.ShowAllFloorsCommand=e.ShowAllFloorsCommand}validateInput(e){return e}async exec(e,t){try{await this.issueCommand(new this.ShowAllFloorsCommand({moveCamera:!0}));const e=this.floorsViewData.currentFloor;return e?e.index:-1}catch(e){throw Error("Could not show all floors")}}}class nt extends j{constructor(){super(...arguments),this.id="LABEL_GET"}}function ot(e,t){return function(n,o,a,s){const i=a.getCollection(),r=[],c=new e.Vector2;for(const a of i){t(n,a.position,c);const{id:i,index:d}=o.getFloor(a.floorId),l=s.getIdFromCwfId(i),h=G(a);r.push(Object.assign(Object.assign({},h),{position:(new e.Vector3).copy(a.position),screenPosition:c,floor:d,floorInfo:{id:l,sequence:d}}))}return r}}class at{create(e,t){return t.onChanged((()=>e.onChanged()))}}class st{constructor(e,t,n){this.labelData=e,this.floorsData=t,this.floorIdMap=n,this._data={}}get data(){return this._data}isItemEqual(e,t){return!H(this.data[t],e.data[t])}update(){var e;for(const t of this.labelData.getCollection()){const n=null!==(e=this.data[t.sid])&&void 0!==e?e:{};n.position=t.position,n.sid=t.sid,n.text=t.text,n.visible=t.visible;const o=this.floorsData.getFloor(t.floorId);n.floorInfo={id:this.floorIdMap.getIdFromCwfId(o.id),sequence:o.index},this.data[n.sid]=n}for(const e in this.data){this.labelData.getLabel(e)||delete this.data[e]}}clear(){this._data={}}}class it{constructor(e){this.deepLinker=e}validateInput(e){return e}async exec(e,t){const n=this.deepLinker.creator.createLink();return decodeURIComponent(n.href)}}class rt{constructor(e){this.deepLinker=e}validateInput(e){return e}async exec(e,t){const n=this.deepLinker.creator.createDeepLink();return decodeURIComponent(n.href)}}function ct(e){return!!e&&"object"==typeof e}function dt(e){return"boolean"==typeof e}function lt(e,t,n,o){switch(e){case s.OpenPolicy.DEFAULT:n.handler.resetPolicy(t);break;case s.OpenPolicy.NEW_WINDOW:n.handler.setPolicy(t,n.handler.HandlingPolicy.NEW_WINDOW);break;case s.OpenPolicy.SAME_FRAME:n.handler.setPolicy(t,n.handler.HandlingPolicy.IN_FRAME);break;case s.OpenPolicy.CURRENT_WINDOW:n.handler.setPolicy(t,n.handler.HandlingPolicy.CUSTOM,(e=>{o.sendPrivateMessage("open link",{href:e})}))}}class ht{constructor(e,t){this.sdk=e,this.deepLinker=t}validateInput(e){if(!Ie(s.OpenPolicy,e.policy))throw Error(`Link.setModelLinkPolicy: ${e.policy} is not a valid Link.OpenPolicy`);if(!ie(e.baseHref))throw Error("Link.setModelLinkPolicy: could not determine window.location");const t=ct(e.options)?e.options.templateHref:void 0;if(void 0!==t&&!ie(t)||ie(t)&&new URL(e.baseHref).origin!==new URL(t).origin)throw Error("Link.setModelLinkPolicy: setting the policy to a different domain is not supported");return{policy:e.policy,baseHref:e.baseHref,options:{templateHref:t}}}async exec(e,t){const n=e.options.templateHref;e.policy!==s.OpenPolicy.NEW_WINDOW&&e.policy!==s.OpenPolicy.CURRENT_WINDOW||!n?lt(e.policy,this.deepLinker.LinkType.MODEL,this.deepLinker,this.sdk):this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.MODEL,this.deepLinker.handler.HandlingPolicy.CUSTOM,(t=>{const o=new URLSearchParams(window.location.search),a=new URL(gt(n,o)),i=new URLSearchParams(t);a.searchParams.set("m",i.get("m")||i.get("model")||""),this.sdk.sendPrivateMessage("open link",{newWindow:e.policy===s.OpenPolicy.NEW_WINDOW,href:decodeURIComponent(a.href)})}))}}class ut{constructor(e,t){this.sdk=e,this.deepLinker=t}validateInput(e){if(!Ie(s.OpenPolicy,e.policy))throw Error(`${e.policy} is not a valid Link.OpenPolicy`);if(!ie(e.baseHref))throw Error("Link.setNavigationLinkPolicy: could not determine window.location");const t=ct(e.options)?e.options.templateHref:void 0;if(void 0!==t&&!ie(t)||ie(t)&&new URL(e.baseHref).origin!==new URL(t).origin)throw Error("Link.setNavigationLinkPolicy: setting the policy to a different domain is not supported");return{policy:e.policy,baseHref:e.baseHref,options:{templateHref:t}}}async exec(e,t){const n=e.options.templateHref;e.policy!==s.OpenPolicy.NEW_WINDOW&&e.policy!==s.OpenPolicy.CURRENT_WINDOW||!n?lt(e.policy,this.deepLinker.LinkType.NAVIGATION,this.deepLinker,this.sdk):this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.NAVIGATION,this.deepLinker.handler.HandlingPolicy.CUSTOM,(t=>{const o=new URLSearchParams(window.location.search),a=new URL(gt(n,o)),i=new URLSearchParams(t);!function(e,t){const[n,o,a,s,i,r,c]=[t.get("sm"),t.get("sp"),t.get("sq"),t.get("sr"),t.get("ss"),t.get("sz"),t.get("start")];ie(n)&&e.set("sm",n);ie(o)&&e.set("sp",o);ie(a)&&e.set("sq",a);ie(s)&&e.set("sr",s);ie(i)&&e.set("ss",i);ie(r)&&e.set("sz",r);ie(c)&&e.set("start",c)}(a.searchParams,i),a.searchParams.set("m",i.get("m")||i.get("model")||""),this.sdk.sendPrivateMessage("open link",{newWindow:e.policy===s.OpenPolicy.NEW_WINDOW,href:decodeURIComponent(a.href)})}))}}class pt{constructor(e,t){this.sdk=e,this.deepLinker=t}validateInput(e){if(!Ie(s.OpenPolicy,e.policy))throw Error(`${e.policy} is not a valid Link.OpenPolicy`);return{policy:e.policy}}async exec(e,t){lt(e.policy,this.deepLinker.LinkType.SAME_ORIGIN,this.deepLinker,this.sdk)}}class mt{constructor(e,t){this.sdk=e,this.deepLinker=t}validateInput(e){const{openInNewWindow:t}=e;if(!dt(t))throw Error(`${e.openInNewWindow} is expected to strictly be a boolean to avoid confusion about truth-y and false-y values.`);return{openInNewWindow:t}}async exec(e,t){e.openInNewWindow?this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.EXTERNAL,this.deepLinker.handler.HandlingPolicy.NEW_WINDOW):this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.EXTERNAL,this.deepLinker.handler.HandlingPolicy.CUSTOM,(e=>{this.sdk.sendPrivateMessage("open link",{href:e})}))}}function gt(e,t){const n=/\$\{([a-zA-Z]+)\}/,o=new URL(e);let a,s=decodeURI(o.pathname);for(;a=s.match(n);){const e=t.get(a[1]);s=s.replace(a[0],`${e}`)}for(o.pathname=s;a=o.search.match(n);){const e=t.get(a[1]);o.search=null!==e||""===e?o.search.replace(a[0],`${a[1]}=${e}`):o.search.replace(a[0],`${a[1]}`)}return o.href}function ft(e,t){return!!Array.isArray(e)&&e.every(t)}class wt{constructor(e){this.deepLinks=e}validateInput(e){const{policy:t,baseHref:n}=e;if(!Ie(s.CreationPolicy,t))throw Error(`Link.setShareLinkPolicy: ${e.policy} is not a valid Link.ShareLinkPolicy`);if(!ie(n))throw Error("Link.setShareLinkPolicy: Could not determine window.location");const o=ct(e.options)&&e.options.includeParams?e.options.includeParams:[];if(!ft(o,ie))throw Error("Link.setShareLinkPolicy: 'includeParams' expects an array of strings");return{policy:t,baseHref:this.validateBaseHref(t,n),options:{includeParams:o}}}validateBaseHref(e,t){const n=/^https:\/\/([a-z0-9\-]*\.)*(matterport\.com|matterportvr\.cn)$/,o=/^https:\/\/static\.(matterport\.com|matterportvr\.cn)$/;return{[s.CreationPolicy.MATTERPORT]:function(){if(window.location.origin.match(n)&&!window.location.origin.match(o))return window.location.href;const e=decodeURIComponent(new URLSearchParams(window.location.search.toLowerCase()).get("apihost")||"");return e.match(n)?e+"/show/":"https://my.matterport.com/show/"},[s.CreationPolicy.REFERRER]:function(){return t},[s.CreationPolicy.WINDOW]:function(){return window.location.href}}[e]()}async exec(e,t){this.deepLinks.creator.setDefaultBaseHref(e.baseHref,e.options.includeParams)}}class Tt{constructor(e,t){this.toSdkMediaMap={[e.PHOTO]:i.MediaType.PHOTO,[e.VIDEO]:i.MediaType.VIDEO,[e.RICH]:i.MediaType.RICH},this.toSdkMediaFromChunk={[t.error]:i.MediaType.NONE,[t.link]:i.MediaType.NONE,[t.none]:i.MediaType.NONE,[t.photo]:i.MediaType.PHOTO,[t.rich]:i.MediaType.RICH,[t.text]:i.MediaType.NONE,[t.video]:i.MediaType.VIDEO}}toSdkMedia(e){return this.toSdkMediaMap[e]}fromTagChunkType(e){return this.toSdkMediaFromChunk[e]}}class It{constructor(e){this.toSdkChunkTypeMap={[e.error]:i.DescriptionChunkType.NONE,[e.link]:i.DescriptionChunkType.LINK,[e.none]:i.DescriptionChunkType.NONE,[e.photo]:i.DescriptionChunkType.NONE,[e.rich]:i.DescriptionChunkType.NONE,[e.text]:i.DescriptionChunkType.TEXT,[e.video]:i.DescriptionChunkType.NONE}}toSdkChunkType(e){return this.toSdkChunkTypeMap[e]}}class yt{constructor(e){this.toSdkLinkTypeMap={[e.NAVIGATION]:i.LinkType.NAVIGATION,[e.MODEL]:i.LinkType.MODEL,[e.EXT_LINK]:i.LinkType.EXT_LINK}}toSdkLinkType(e){return this.toSdkLinkTypeMap[e]}}function Et(e){return"number"==typeof e&&!isNaN(e)}function vt(e){return e-0}function Ct(e,t,n){return Math.max(t,Math.min(e,n))}function At(e,t,n){return t<=e&&e<=n}function St(e){if(e&&"object"==typeof e&&"x"in e&&"y"in e&&"z"in e){const t=e;return Et(t.x)&&Et(t.y)&&Et(t.z)}return!1}function bt(e){if(e&&"object"==typeof e&&"r"in e&&"g"in e&&"b"in e){const t=e;return Et(t.r)&&Et(t.g)&&Et(t.b)}return!1}function Dt(e,t){return!!bt(e)&&(!At(e.r,0,1)&&t&&t.warn("The color provided should have an r value be in the range of [0, 1]"),!At(e.g,0,1)&&t&&t.warn("The color provided should have an g value be in the range of [0, 1]"),!At(e.b,0,1)&&t&&t.warn("The color provided should have an b value be in the range of [0, 1]"),(n=e).r=Ct(n.r,0,1),n.g=Ct(n.g,0,1),n.b=Ct(n.b,0,1),!0);var n}const Ot=new ee("mattertag-util");function Mt(e,t,n,o){const a=o.meshSubGroupsFromPoint(e);let s=1/0,i="";for(const t of n.rooms())if(a.includes(t.meshSubgroup)){const n=o.meshGroups.rooms.get(t.meshSubgroup),a=e.y-((null==n?void 0:n.boundingBox.min.y)||-1/0);a<s&&(s=a,i=t.floorId)}try{return t.getFloor(i).index}catch(e){return Ot.debug("Unable to deduce floor index from position; defaulting to floor 0"),0}}const Nt=new ee("mattertag.add");class Rt extends j{constructor(e){super(),this.payload=e,this.id="BATCH_ADD_MATTERTAG"}}function Pt(e,t,n,o,a){const s={[i.MediaType.NONE]:n.TagDescriptionChunkType.none,[i.MediaType.PHOTO]:n.TagDescriptionChunkType.photo,[i.MediaType.VIDEO]:n.TagDescriptionChunkType.video,[i.MediaType.RICH]:n.TagDescriptionChunkType.rich};function r(e,o,a,i){if(!St(e.anchorPosition))throw Error("anchorPosition is not a valid Vector3");if(!St(e.stemVector))throw Error("stemVector is not a valid Vector3");const r=(new t.Vector3).copy(e.anchorPosition),c=(new t.Vector3).copy(e.stemVector),d=c.length();c.normalize();let l=void 0!==e.floorIndex?e.floorIndex:e.floorId;void 0===l&&(l=Mt(r,o,a,i));const h=o.getFloorAtIndex(l);if(!h)throw new Error(`Could not add Mattertag on invalid floor with index: ${l}`);const u=Dt(e.color,Nt)?new t.Color(e.color.r,e.color.g,e.color.b):n.Color.MATTERTAG_BLUE,p=e.description,m=e.label,g=!e.hasOwnProperty("stemVisible")||e.stemVisible;let f;return e.media&&(f={mediaType:s[e.media.type]||n.TagDescriptionChunkType.none,mediaSrc:e.media.src||""}),{positionOptions:{position:r,normal:c,floorId:h.id},standardOptions:{color:u,description:p,label:m,stemHeight:d,stemVisible:g,enabled:!0},mediaOptions:f}}e.addCommandCreator({namespace:"Mattertag",name:"add",args:["tags"]},((e,t)=>{const n=Array.isArray(e.tags)?e.tags:[e.tags];return new Rt({tagDescriptors:n,clientInfo:t})})),o.addBinding(Rt,(async e=>{const[t,s,i,,c]=await a.getDependencies(),d=function(e,t,n,o){const a=[],s=e,i=s.length;a.length=i;for(let e=0;e<s.length;++e)try{a[e]=r(s[e],t,n,o)}catch(t){throw Error(`Error in tag ${e} - ${t.message}`)}return a}(e.tagDescriptors,t,s,i),l=await o.issueCommand(new n.AddMattertagCommand(d));for(let t=0;t<d.length;++t){const n=e.tagDescriptors[t];n.iconId&&await c.exec({tagId:l[t],iconId:n.iconId},e.clientInfo)}return l}))}class Lt extends j{constructor(){super(...arguments),this.id="MATTERTAG_GET"}}function xt(e,t,n){function o(e){if(!e)return;return{label:e.label,type:n.toSdkLinkType(e.type),url:e.url,navigationData:e.navigationData}}const a=[];for(const n of e)a.push({type:t.toSdkChunkType(n.type),link:o(n.link),text:n.text});return a}class kt{constructor(e,t,n,o,a){this.THREE=e,this.iconMap=n,this.mattertagMeshes=o,this.mattertagData=a}validateInput(e,t){const{iconId:n,tagId:o}=e;if(!ie(n))throw Error(`iconId ${n} is not a valid string`);if(!ie(o))throw Error(`tagId ${o} is not a valid string`);const a=this.iconMap.get(t.applicationKey);if(!a||!a.map[n]&&!a.imagePromise[n])throw Error(n+" has not been ied as valid icon id");if(!this.mattertagData.getTag(o))throw Error(o+" is not a valid tag id");return e}async exec(e,t){const{iconId:n,tagId:o}=e,a=this.iconMap.get(t.applicationKey);let s;try{s=await a.imagePromise[n]}catch(e){throw Error(e)}const i=a.map[n],r=s.naturalWidth/s.naturalHeight,c=new this.THREE.Vector3;r>1?c.set(r,1,1):c.set(1,1/r,1),this.mattertagMeshes.setOverrideMaterial(o,i,c)}}class _t{constructor(e,t,n,o,a){this.mattertagMeshes=o}validateInput(e){const{tagId:t}=e;if(!ie(t))throw Error(`tagId ${t} is not a valid string`);return e}async exec(e,t){const{tagId:n}=e;this.mattertagMeshes.setOverrideMaterial(n,null,null)}}function Vt(e){return"string"==typeof e}class Ft extends Se{constructor(e){super("Expected tagId parameter to be of type string; got "+(Array.isArray(e)?"Array":typeof e))}}const Ut=new ee("mattertag.edit");var Gt;!function(e){e.LABEL="label",e.DESCRIPTION="description",e.MEDIA="media"}(Gt||(Gt={}));class Ht extends j{constructor(e,t){super(),this.payload={tagId:e,properties:t}}}class zt extends j{constructor(e,t){super(),this.payload={tagId:e,color:t}}}class Bt extends j{constructor(e,t){super(),this.payload=Object.assign({tagId:e},t)}}const jt=new ee("command.editOpacity");class Wt{constructor(e,t){this.mattertagData=e,this.mattertagMesh=t}validateInput(e){const t=e.sid;if(!Vt(t))throw new Ft(t);if(!this.mattertagData.getTag(t))throw Error(e.sid+" is not a valid Mattertag sid");if("number"!=typeof e.opacity||isNaN(e.opacity))throw Error(e.opacity+" is not a valid opacity value");let n=e.opacity;return(n<0||1<n)&&(jt.warn(n,"is outside the valid range of [0, 1]"),n=Fe(n,0,1)),{sid:t,opacity:n}}async exec(e,t){this.mattertagMesh.changeDiscOpacity(e.sid,e.opacity)}}function qt(e,t,n){return(n=n||{}).x=e[t].x,n.y=e[t].y,n.z=e[t].z,n}function $t(e,t,n){return(n=n||{}).r=e[t].r,n.g=e[t].g,n.b=e[t].b,n}function Kt(e,t,n,o){o=o||{};try{const a=t.getFloor(e);o.id=n.getIdFromCwfId(a.id),o.sequence=a.index}catch(e){o.id="",o.sequence=-1}return o}class Yt{create(e,t){return t.onChanged((()=>e.onChanged()))}}class Xt{constructor(e,t,n,o){this.mattertagData=t,this.floorsData=n,this.floorIdMap=o,this._data={},this.mediaConverter=e.mediaConverter}get data(){return this._data}isItemEqual(e,t){return!H(this.data[t],e.data[t])}update(){for(const e of this.mattertagData.getTagList()){const t=this.mattertagData.getTag(e),n=this.floorsData.getFloor(t.floorId),o=this.data[t.sid]||{};o.sid=t.sid,o.enabled=t.enabled,o.anchorPosition=qt(t,"anchorPosition",o.anchorPosition),o.stemVector=qt(t,"stemVector",o.stemVector),o.stemVisible=t.stemVisible,o.label=t.label,o.description=t.description,o.media=this.getMedia(t,o.media),o.color=$t(t,"color",o.color),o.floorIndex=n?n.index:-1,o.floorInfo=o.floorInfo||{},o.floorInfo.id=this.floorIdMap.getIdFromCwfId(n.id),o.floorInfo.sequence=n.index,this.data[t.sid]=o}for(const e in this.data){this.mattertagData.getTag(e)||delete this.data[e]}}clear(){this._data={}}getMedia(e,t){const n=this.mediaConverter.toSdkMedia(e.mediaType);return(t=t||{}).src=e.mediaSrc,t.type=n||i.MediaType.NONE,t}}var Zt,Qt;!function(e){e.LOADED="inject.loaded",e.SETUP="inject.setup",e.RESOLVE="inject.resolve"}(Zt||(Zt={}));Symbol.iterator;class Jt{constructor(){this.usedIds=new Set,this.usedIds.add(0)}generate(){let e;do{e=Math.floor(1e6*Math.random())}while(this.usedIds.has(e));return this.usedIds.add(e),e}isInUse(e){return this.usedIds.has(e)}}!function(e){e[e.POSTMESSAGE=1]="POSTMESSAGE"}(Qt||(Qt={}));class en{constructor(e,t){this.mattertagData=e,this.iframeSrcDoc=t,this.idGenerator=new Jt}validateInput(e){const t=e.tagId;if(!ie(t))throw new Ft(t);if(!this.mattertagData.getTag(t))throw Error(e.tagId+" is not a valid tagId");if(!e.html||"string"!=typeof e.html)throw Error(e.html+" is not valid html");if(!Et(e.clientId))throw Error("Unexpected error: unable to create iframe");const n=e.options||{};let o="string"==typeof n.windowPath?n.windowPath:"";if(o&&o.split(".").filter((e=>"parent"!==e&&"opener"!==e)).length>0)throw Error(o+" is an unsupported window path");o.length>0&&"."!==o[0]&&(o="."+o);try{if(!Function("return window"+o)().postMessage)throw Error("invalid window")}catch(e){throw Error("problem finding a valid window with path: "+o)}const a={on:"on",off:"off",send:"send",tag:"tag",docked:"docked"};n.globalVariableMap&&(ie(n.globalVariableMap.on)&&(a.on=n.globalVariableMap.on),ie(n.globalVariableMap.off)&&(a.off=n.globalVariableMap.off),ie(n.globalVariableMap.send)&&(a.send=n.globalVariableMap.send),ie(n.globalVariableMap.tag)&&(a.tag=n.globalVariableMap.tag));const s={w:0,h:0};if(n.size){const e=vt(n.size.w+""),t=vt(n.size.h+"");isNaN(e)||isNaN(t)||(s.w=e,s.h=t)}return{tagId:t,clientId:e.clientId,html:e.html,options:{name:"",size:s,windowPath:o,globalVariableMap:a}}}async exec(e,t){const n=this.idGenerator.generate();return new Promise((t=>{const o=function(e){const t=document.createElement("iframe");return t.srcdoc=e,t.sandbox.add("allow-scripts"),t}(this.iframeSrcDoc);o.addEventListener("load",(function(){o.contentWindow.postMessage({type:Zt.SETUP,id:n,targetId:e.clientId,customHTML:e.html,windowPath:e.options.windowPath,parentTag:e.tagId,docked:!1,globalVariableMap:e.options.globalVariableMap},"*"),t({messengerType:Qt.POSTMESSAGE,iframeId:n})})),this.mattertagData.getTag(e.tagId).widgetFrame={size:{width:e.options.size.w,height:e.options.size.h},frame:new tn(o)},this.mattertagData.commit()}))}}class tn{constructor(e){this.iframe=e}mount(e){e.appendChild(this.iframe)}unmount(){this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe)}}const nn={namespace:"Mattertag",name:"injectHTML",subRoutine:"mattertag.inject",args:["tagId","html","options"]};class on extends j{constructor(e,t){super(),this.id="NAVIGATE_TO_MATTERTAG";const n=t;this.payload={sid:e,transition:n}}}class an{constructor(e){this.mattertagViewData=e}validateInput(e){const t=e.sid;if(!Vt(t))throw new Ft(t);if(!this.mattertagViewData.mattertags.getTag(t))throw Error(e.sid+" is not a valid tag sid");const n={opening:!1,navigating:!1};if("object"==typeof e.prevent&&e.prevent){const t=e.prevent;n.opening=!!t.opening,n.navigating=!!t.navigating}return{sid:t,prevent:n}}async exec(e,t){e.prevent.opening=!e.prevent.opening,e.prevent.navigating=!e.prevent.navigating,this.mattertagViewData.setTagCapabilities(e.sid,e.prevent)}}class sn extends j{constructor(e){super(),this.id="BATCH_REMOVE_MATTERTAG",this.payload={removeCommands:e}}}function rn(e,t,n){const o=["",!1],a=e=>(o[0]=e.id,o[1]=e.hovering,o);n.subscribe(t.PinHoverChangeMessage,(n=>{n.pinType===t.PinType.MATTERTAG&&e.broadcast(i.Event.HOVER,a,n)}));const s=[""],r=e=>(s[0]=e.id,s);n.subscribe(t.PinClickedMessage,(n=>{n.pinType===t.PinType.MATTERTAG&&e.broadcast(i.Event.CLICK,r,n)}))}class cn extends j{constructor(e){super(),this.id="MATTERTAG_OPEN",this.payload={tag:e}}}class dn extends j{constructor(e){super(),this.id="MATTERTAG_CLOSE",this.payload={tag:e}}}class ln{constructor(){this.observers=new Set}observe(e){this.observers.add(e);const t=this;return{renew(){t.observers.add(e)},cancel(){t.removeObserver(e)}}}removeObserver(e){this.observers.delete(e)}notify(){for(const e of this.observers)e.notify()}}var hn,un,pn,mn,gn,fn,wn,Tn,In,yn,En,vn,Cn,An,Sn,bn,Dn,On,Mn,Nn,Rn,Pn,Ln,xn,kn,_n,Vn,Fn,Un,Gn,Hn,zn,Bn,jn,Wn,qn,$n,Kn,Yn,Xn,Zn,Qn,Jn,eo,to,no,oo,ao,so,io,ro,co,lo,ho,uo,po,mo,go,fo,wo,To,Io,yo,Eo,vo,Co,Ao,So,bo,Do,Oo,Mo,No,Ro,Po,Lo,xo,ko,_o,Vo,Fo;!function(e){e.ROLE="ROLE",e.TYPE="TYPE",e.USER_EMAIL="USER_EMAIL"}(hn||(hn={})),function(e){e.EMPTY="empty",e.PARSED="parsed",e.RAW="raw",e.VERIFIED="verified"}(un||(un={})),function(e){e.FULL="full",e.NONE="none",e.PARTIAL="partial"}(pn||(pn={})),function(e){e.IMPRESSION="impression",e.MODELLOADED="modelLoaded"}(mn||(mn={})),function(e){e.LAST7DAYS="last7Days",e.LAST30DAYS="last30Days",e.LIFETIME="lifetime"}(gn||(gn={})),function(e){e.LZMA="lzma",e.NONE="none"}(fn||(fn={})),function(e){e.AVAILABLE="available",e.LOCKED="locked",e.UNAVAILABLE="unavailable"}(wn||(wn={})),function(e){e.EXTERNAL="external",e.UPLOAD="upload"}(Tn||(Tn={})),function(e){e.IMAGE="image",e.PDF="pdf",e.RICH="rich",e.VIDEO="video",e.ZIP="zip"}(In||(In={})),function(e){e.DELETED="deleted",e.PROVISIONED="provisioned",e.TRASHED="trashed",e.UPLOADED="uploaded"}(yn||(yn={})),function(e){e.LOCKED="locked",e.UNAVAILABLE="unavailable",e.UNLOCKED="unlocked"}(En||(En={})),function(e){e.COMPLETED="completed",e.FAILED="failed",e.INPROGRESS="inprogress",e.ORDERED="ordered",e.PLACED="placed",e.PREVIEWABLE="previewable"}(vn||(vn={})),function(e){e.DOLLHOUSE="dollhouse",e.FLOORPLAN="floorplan",e.OUTDOOR="outdoor",e.PANORAMA="panorama",e.TRANSITION="transition",e.UNKNOWN="unknown"}(Cn||(Cn={})),function(e){e.WALL="wall",e.WINDOW="window"}(An||(An={})),function(e){e.HANDHELD="handheld",e.OTHER="other",e.PRO="pro",e.SPHERICAL="spherical"}(Sn||(Sn={})),function(e){e.DUPLICATE="duplicate",e.FAIL="fail",e.REPLACE="replace",e.SKIP="skip"}(bn||(bn={})),function(e){e.CREATED="created",e.MODIFIED="modified"}(Dn||(Dn={})),function(e){e.FAST="fast",e.NORMAL="normal",e.URGENT="urgent"}(On||(On={})),function(e){e.KILOMETERS="kilometers",e.MILES="miles"}(Mn||(Mn={})),function(e){e.MATTERTAGS="Mattertags",e.NOTECOMMENTS="NoteComments",e.NOTES="Notes"}(Nn||(Nn={})),function(e){e.BLOCKED="blocked",e.DISABLED="disabled",e.GATED="gated",e.UNLOCKED="unlocked"}(Rn||(Rn={})),function(e){e.MAY="may",e.MUST="must",e.MUST_NOT="must_not"}(Pn||(Pn={})),function(e){e.ALPHA="alpha",e.COLORED_ROOMS="colored_rooms",e.MEASUREMENTS="measurements",e.PHOTOGRAMY="photogramy",e.SCHEMATIC="schematic"}(Ln||(Ln={})),function(e){e.ADMIN="Admin",e.FOLDERCREATOR="FolderCreator",e.FOLDERSHARES="FolderShares",e.USERGROUPFOLDERSHARES="UserGroupFolderShares"}(xn||(xn={})),function(e){e.ALL="all",e.ID="id",e.NAME="name"}(kn||(kn={})),function(e){e.CREATED="created",e.MODIFIED="modified",e.NAME="name"}(_n||(_n={})),function(e){e.REEL="reel",e.STORY="story"}(Vn||(Vn={})),function(e){e.COMPLETED="completed",e.CREATED="created",e.FAILED="failed",e.INPROGRESS="inprogress"}(Fn||(Fn={})),function(e){e.ANCHORLOCATION="AnchorLocation",e.HIGHLIGHTREEL="HighlightReel",e.LABEL="Label",e.MATTERTAG="Mattertag",e.MEASUREMENTPATH="MeasurementPath",e.MODELFLOOR="ModelFloor",e.MODELROOM="ModelRoom",e.NOTE="Note",e.OBJECTANNOTATION="ObjectAnnotation",e.ORDEREDLIST="OrderedList",e.PANORAMICIMAGELOCATION="PanoramicImageLocation",e.PHOTO="Photo"}(Un||(Un={})),function(e){e.SHOWCASE="showcase"}(Gn||(Gn={})),function(e){e.PHOTO="photo",e.RICH="rich",e.VIDEO="video"}(Hn||(Hn={})),function(e){e.LINETYPE_2D="linetype_2D",e.LINETYPE_3D="linetype_3D"}(zn||(zn={})),function(e){e.DISABLED="disabled",e.MEASURE="measure",e.MEASUREANDVIEW="measureAndView"}(Bn||(Bn={})),function(e){e.FLOORS="floors",e.HIGHLIGHTREEL="highlightReel",e.IMAGE="image",e.LABELS="labels",e.MATTERTAGS="mattertags",e.MEASUREMENTPATHS="measurementPaths",e.ORDEREDLISTS="orderedLists",e.PLAYEROPTIONS="playerOptions",e.SWEEPS="sweeps"}(jn||(jn={})),function(e){e.FULL="full",e.PUBLIC="public",e.VIEWER="viewer"}(Wn||(Wn={})),function(e){e.ADMIN="Admin",e.MODELCREATOR="ModelCreator",e.MODELSHARES="ModelShares",e.USERGROUPMODELSHARES="UserGroupModelShares"}(qn||(qn={})),function(e){e.BLACK="black",e.GREY="grey",e.WHITE="white"}($n||($n={})),function(e){e.DEFAULT="default",e.MLS="mls",e.UNBRANDED="unbranded"}(Kn||(Kn={})),function(e){e.BUNDLE_COMPLETED="bundle_completed",e.BUNDLE_REQUESTED="bundle_requested",e.DELETED="deleted",e.INSERTED="inserted",e.PROCESSED="processed",e.REPLACED="replaced",e.UPDATED="updated",e.UPLOADED="uploaded"}(Yn||(Yn={})),function(e){e.ACTIVE="active",e.ARCHIVED="archived"}(Xn||(Xn={})),function(e){e.ID="id",e.INTERNALID="internalId",e.MLSID="mlsId"}(Zn||(Zn={})),function(e){e.DEFAULT="default",e.VR="vr"}(Qn||(Qn={})),function(e){e.ADDRESS="address",e.CAMERA="camera",e.CAMERAMANUFACTURER="cameraManufacturer",e.CAMERAMODEL="cameraModel",e.EXTENSIONTAG="extensiontag",e.GEODISTANCE="geoDistance",e.GEOREGION="geoRegion",e.ID="id",e.NAME="name",e.STANDARD="standard",e.SUMMARY="summary"}(Jn||(Jn={})),function(e){e.CREATED="created",e.LAST7IMPRESSIONSEVENTCOUNT="last7ImpressionsEventCount",e.LAST7MODELSLOADEDEVENTCOUNT="last7ModelsLoadedEventCount",e.LAST7MODELSLOADEDUSERCOUNT="last7ModelsLoadedUserCount",e.LAST30IMPRESSIONSEVENTCOUNT="last30ImpressionsEventCount",e.LAST30MODELSLOADEDEVENTCOUNT="last30ModelsLoadedEventCount",e.LAST30MODELSLOADEDUSERCOUNT="last30ModelsLoadedUserCount",e.LIFETIMEIMPRESSIONSEVENTCOUNT="lifetimeImpressionsEventCount",e.LIFETIMEMODELSLOADEDEVENTCOUNT="lifetimeModelsLoadedEventCount",e.LIFETIMEMODELSLOADEDUSERCOUNT="lifetimeModelsLoadedUserCount",e.MODIFIED="modified",e.SCORE="score"}(eo||(eo={})),function(e){e.COPY="copy",e.EDITED="edited",e.ORIGINAL="original",e.UNKNOWN="unknown"}(to||(to={})),function(e){e.ACTIVATING="activating",e.ACTIVATION_PENDING="activation_pending",e.ACTIVE="active",e.FAILED="failed",e.INACTIVATING="inactivating",e.INACTIVATION_PENDING="inactivation_pending",e.INACTIVE="inactive",e.PENDING="pending",e.PROCESSING="processing",e.STAGING="staging"}(no||(no={})),function(e){e.ACTIVE="active",e.INACTIVE="inactive"}(oo||(oo={})),function(e){e.PRIVATE="private",e.PUBLIC="public"}(ao||(ao={})),function(e){e.SERIAL="serial"}(so||(so={})),function(e){e.AUTO="auto",e.LEFT="left",e.RIGHT="right"}(io||(io={})),function(e){e.AUTO="auto",e.MANUAL="manual",e.UNPLACED="unplaced"}(ro||(ro={})),function(e){e.UPLOAD="upload",e.VISION="vision"}(co||(co={})),function(e){e.CYLINDRICAL="cylindrical",e.EQUIRECTANGULAR="equirectangular",e.SKYBOX="skybox"}(lo||(lo={})),function(e){e.COMMENT="comment",e.MATTERTAG="mattertag"}(ho||(ho={})),function(e){e.FOLDER="folder",e.MODEL="model",e.ORGANIZATION="organization",e.USER="user"}(uo||(uo={})),function(e){e.SNAPSHOT="snapshot",e.TOUR="tour"}(po||(po={})),function(e){e.USER="user",e.VISION="vision"}(mo||(mo={})),function(e){e.ICON="icon",e.ORIGINAL="original",e.PRESENTATION="presentation",e.PREVIEW="preview",e.THUMBNAIL="thumbnail",e.WEB="web"}(go||(go={})),function(e){e.EQUIRECTANGULAR="equirectangular",e.PHOTO2D="photo2D"}(fo||(fo={})),function(e){e.AVAILABILITY="availability",e.FLAG="flag",e.QUOTA="quota",e.VALUE="value"}(wo||(wo={})),function(e){e.COMPLETE="complete",e.FAILED="failed",e.INPROGRESS="inprogress",e.STAGING="staging"}(To||(To={})),function(e){e.OPEN="open",e.RESOLVED="resolved"}(Io||(Io={})),function(e){e.ALIGNED="aligned",e.FAILED="failed",e.UNALIGNED="unaligned"}(yo||(yo={})),function(e){e.ANCHOR="anchor",e.ID="id",e.LOCATION="location"}(Eo||(Eo={})),function(e){e.FACE_BLURRING="face_blurring",e.FIDUCIAL_DETECTION="fiducial_detection",e.FIDUCIAL_REMOVAL="fiducial_removal"}(vo||(vo={})),function(e){e.DEMO="demo",e.DISCOVERABLE="discoverable",e.FLAGGED="flagged",e.INACTIVE="inactive"}(Co||(Co={})),function(e){e.DEFAULT="default",e.DISABLED="disabled",e.ENABLED="enabled"}(Ao||(Ao={})),function(e){e.FOLDER="Folder",e.MODEL="Model",e.ORGANIZATION="Organization"}(So||(So={})),function(e){e.ASC="asc",e.DESC="desc"}(bo||(bo={})),function(e){e.ACCEPTED="accepted",e.DISMISSED="dismissed",e.REJECTED="rejected",e.UNREVIEWED="unreviewed"}(Do||(Do={})),function(e){e.HIGH="high",e.LOW="low"}(Oo||(Oo={})),function(e){e.AFTERNOON="afternoon",e.DAWN="dawn",e.DUSK="dusk",e.MORNING="morning",e.NIGHT="night"}(Mo||(Mo={})),function(e){e.FADE_TO_BLACK="fade_to_black",e.INSTANT="instant",e.INTERPOLATE="interpolate"}(No||(No={})),function(e){e.IMPERIAL="imperial",e.METRIC="metric"}(Ro||(Ro={})),function(e){e.CREATED="created",e.EMAIL="email",e.FIRST_NAME="first_name",e.LAST_NAME="last_name",e.MODIFIED="modified"}(Po||(Po={})),function(e){e.DOLLHOUSE="dollhouse",e.FLOORPLAN="floorplan",e.MESH="mesh",e.PANORAMA="panorama"}(Lo||(Lo={})),function(e){e.BASIC="basic",e.NONE="none",e.TOKEN="token"}(xo||(xo={})),function(e){e.FILE_TOO_LARGE="oversize",e.EMPTY_FILE="empty",e.OVER_QUOTA="overQuota",e.UPLOAD_FAILED="failed",e.PERMISSION_DENIED="permission"}(ko||(ko={})),function(e){e.EMBED_FAIL="embedFail",e.EMBED_SUCCESS="success"}(_o||(_o={})),function(e){e.IMAGE="image",e.PDF="pdf",e.VIDEO="video",e.RICH="rich",e.ZIP="zip",e.TEXT="text",e.AUDIO="audio",e.MODEL="model",e.APPLICATION="application"}(Vo||(Vo={})),function(e){e.EXTERNAL="external",e.UPLOAD="upload",e.SANDBOX="sandbox"}(Fo||(Fo={}));const Uo=new ee("expiring-resource"),Go=new WeakMap;class Ho{constructor(e,t){this.value=e,this.validUntil=t}refreshFrom(e){this.value=e.value,this.validUntil=e.validUntil;const t=Go.get(this);t&&(t.resolve(),Go.delete(this))}async get(){if(this.validUntil&&this.onStale){const e=Date.now();if(e+6e4+1e4>this.validUntil.getTime()){let t=Go.get(this);t||(t=new ce,Go.set(this,t),this.onStale()),e+6e4+1e3>this.validUntil.getTime()&&(Uo.info("Stale resource, waiting for refresh"),await t.nativePromise(),Uo.info("Refreshed resource"))}}return this.value}getCurrentValue(){return this.value}}function zo(e=11){let t="";const n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let o=0;o<e;o++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}var Bo,jo;!function(e){e.Behance="behance",e.DailyMotion="dailymotion",e.FaceBook="facebook",e.Flickr="flickr",e.Giphy="giphy",e.GoogleMaps="google maps",e.Instagram="instagram",e.LinkedIn="linkedin",e.Matterport="matterport",e.MixCloud="mixcloud",e.Pinterest="pinterest",e.Reddit="reddit",e.SoundCloud="soundcloud",e.SketchFab="sketchfab",e.Spotify="spotify",e.Tenor="tenor",e.TikTok="tiktok",e.Twitch="twitch",e.Twitter="twitter",e.Tumblr="tumblr",e.Vimeo="vimeo",e.YouTube="youtube"}(Bo||(Bo={})),function(e){e.PHOTO="photo",e.VIDEO="video",e.LINK="link",e.RICH="rich"}(jo||(jo={}));Error;Bo.GoogleMaps;Bo.Behance,Bo.FaceBook,Bo.GoogleMaps,Bo.Instagram,Bo.LinkedIn,Bo.MixCloud,Bo.Pinterest,Bo.Reddit,Bo.TikTok,Bo.Twitter,Bo.Twitch;var Wo;!function(e){e.IMAGE="tag.attachment.image",e.RICH="tag.attachment.rich",e.VIDEO="tag.attachment.video"}(Wo||(Wo={}));class qo{constructor(e,t){this.globalAttachments=new Map,this.perClientAttachments=new Map,this.clientAttachments=new Map,this.clientIds=new Set,this.attachmentDescriptors=new Map,this.observable=new ln,this.oEmbed=t;for(const t of e.getTagList()){const n=e.getTag(t);for(const e of n.fileAttachments)this.globalAttachments.set(e.id,e),this.autoRefreshExpiringAttachment(e);for(const e of n.externalAttachments)this.globalAttachments.set(e.id,e),this.setDescriptorUrl(e,e.src)}}get(e,t){return this.globalAttachments.get(t)||this.clientAttachments.get(t)}add(e,t){const n=this.createIAttachment({src:t.src,type:t.type});return this.clientAttachments.set(n.id,n),this.setDescriptorUrl(n,t.src),this.clientIds.add(n.id),this.observable.notify(),n.id}async addBySrc(e,t){const n=await this.createOEmbedIAttachment(t);return this.clientAttachments.set(n.id,n),this.setDescriptorUrl(n,t),this.clientIds.add(n.id),this.observable.notify(),n.id}addSandbox(e,t){const n=this.getUniqueId(),o=t.name||"sandbox-"+n,a={id:n,src:o,srcDoc:t.srcDoc,onLoad:t.sandboxLoadedHandler,category:Fo.SANDBOX,mediaType:Vo.RICH,parentType:ho.MATTERTAG,thumbnailUrl:new Ho("",null),url:new Ho("",null),created:new Date,height:t.size.h,width:t.size.w};return this.clientAttachments.set(n,a),this.setDescriptorUrl(a,o),this.clientIds.add(n),this.observable.notify(),[n,a]}has(e){return this.globalAttachments.has(e)||this.clientIds.has(e)}*[Symbol.iterator](e){for(const e of this.globalAttachments)yield e;for(const e of this.clientAttachments)yield e;if(e){const t=this.perClientAttachments.get(e)||[];for(const e of t)yield e}}*descriptors(){for(const e of this.attachmentDescriptors)yield e}onChanged(e){return this.observable.observe(e)}getUniqueId(){const e=zo(10);return this.globalAttachments.has(e)||this.clientIds.has(e)?this.getUniqueId():e}async autoRefreshExpiringAttachment(e){const t=e.url,n=async()=>{if(t.validUntil){const o=t.validUntil.getTime()-Date.now(),a=o<=0;if(a){const n=await t.get();this.setDescriptorUrl(e,n),this.observable.notify()}setTimeout(n,a?0:o)}},o=await t.get();this.setDescriptorUrl(e,o),n(),this.observable.notify()}setDescriptorUrl(e,t){this.attachmentDescriptors.set(e.id,{id:e.id,src:t,type:this.getAttachmentType(e.mediaType)})}getAttachmentType(e){return{[Vo.APPLICATION]:u.AttachmentType.APPLICATION,[Vo.AUDIO]:u.AttachmentType.AUDIO,[Vo.IMAGE]:u.AttachmentType.IMAGE,[Vo.MODEL]:u.AttachmentType.MODEL,[Vo.PDF]:u.AttachmentType.PDF,[Vo.RICH]:u.AttachmentType.RICH,[Vo.TEXT]:u.AttachmentType.TEXT,[Vo.VIDEO]:u.AttachmentType.VIDEO,[Vo.ZIP]:u.AttachmentType.ZIP}[e]}createIAttachment(e){const t={[Wo.IMAGE]:Vo.IMAGE,[Wo.RICH]:Vo.RICH,[Wo.VIDEO]:Vo.VIDEO};return{id:this.getUniqueId(),mediaType:t[e.type],category:Fo.EXTERNAL,src:e.src,parentType:ho.MATTERTAG,created:new Date,height:0,width:0,thumbnailUrl:new Ho("",null),url:new Ho("",null),mimeType:""}}async createOEmbedIAttachment(e){const t={[jo.PHOTO]:Vo.IMAGE,[jo.RICH]:Vo.RICH,[jo.VIDEO]:Vo.VIDEO},n=this.getUniqueId(),o=t[(await this.oEmbed.getOEmbedData(e)).type];if(!o)throw Error("unable to determine media type");return{id:n,mediaType:o,category:Fo.EXTERNAL,src:e,parentType:ho.MATTERTAG,created:new Date,height:0,width:0,thumbnailUrl:new Ho("",null),url:new Ho("",null),mimeType:""}}}const $o={[i.MediaType.PHOTO]:Wo.IMAGE,[i.MediaType.RICH]:Wo.RICH,[i.MediaType.VIDEO]:Wo.VIDEO};class Ko{constructor(e,t,n,o){this.tagAdd=e,this.tagEditIcon=t,this.tagAttach=n,this.attachmentRegistry=o}validateInput(e,t){return{descriptors:this.tagAdd.executor.validateInput({descriptors:Array.isArray(e.descriptors)?e.descriptors:[e.descriptors]},t).descriptors}}async exec(e,t){const n=Array.isArray(e.descriptors)?e.descriptors:[e.descriptors],o=new Map;for(const e of n)if(e.media&&e.media.type!==i.MediaType.NONE){const n=this.attachmentRegistry.add(t.applicationKey,{src:e.media.src,type:$o[e.media.type]});o.set(e.media.src,n)}const a=async e=>{for(let o=0;o<e.length;++o){const a=n[o];a.iconId&&await ae(this.tagEditIcon,{id:e[o],iconId:a.iconId},t)}},s=async e=>{for(let a=0;a<e.length;++a){const s=n[a];if(s.media&&s.media.type!==i.MediaType.NONE){const n=o.get(s.media.src);n&&ae(this.tagAttach,{tagId:e[a],attachmentIds:[n]},t)}}};return this.tagAdd.executor.exec({descriptors:n},t).then((async e=>(await a(e),await s(e),e)))}}class Yo{create(e,t){return t.onChanged((()=>e.onChanged()))}}class Xo{constructor(e,t,n,o){this.mattertagData=t,this.floorsData=n,this.floorIdMap=o,this._data={},this.mediaConverter=e.mediaConverter}get data(){return this._data}isItemEqual(e,t){return!H(this.data[t],e.data[t])}update(){for(const e of this.mattertagData.getTagList()){const t=this.mattertagData.getTag(e),n=this.floorsData.getFloor(t.floorId),o=this.data[t.sid]||{};o.sid=t.sid,o.enabled=t.enabled,o.anchorPosition=qt(t,"anchorPosition",o.anchorPosition),o.stemVector=qt(t,"stemVector",o.stemVector),o.stemVisible=t.stemVisible,o.label=t.label,o.description=t.description,o.media=this.getMedia(t,o.media),o.color=$t(t,"color",o.color),o.floorIndex=n?n.index:-1,o.floorInfo=o.floorInfo||{},o.floorInfo.id=this.floorIdMap.getIdFromCwfId(n.id),o.floorInfo.sequence=n.index,this._data[t.sid]=o}for(const e in this.data){this.mattertagData.getTag(e)||delete this._data[e]}}clear(){this._data={}}getMedia(e,t){const n=e.externalAttachments.get(0),o=n?this.mediaConverter.toSdkMedia(n.mediaType):i.MediaType.NONE,a=n&&o!==i.MediaType.NONE?n.src:"";return(t=t||{}).src=a,t.type=o,t}}class Zo{constructor(e,t,n){this.tagEditBillboard=t,this.tagAttach=n,[this.mattertagData,this.attachmentRegistry]=e}validateInput(e,t){if(!ct(e.properties))throw Error("Mattertag.editBillboard: editable properties is not an object");const n=this.tagEditBillboard.executor.validateInput(e,t),o=e.properties.media;if(o){if(!ct(o)||!Ie(i.MediaType,o.type))throw Error("Mattertag.editBillboard: media was not a valid media descriptor");if(o.type!==i.MediaType.NONE){if(!ie(o.src))throw Error(`Mattertag.editBillboard: media was of type "${o.type}" but has no src value`);return{id:n.id,properties:Object.assign(Object.assign({},n.properties),{media:{src:o.src,type:o.type}})}}n.properties.media={src:"",type:i.MediaType.NONE}}return n}async exec(e,t){const n=this.mattertagData.getTag(e.id),o=(()=>{if(e.properties.media&&e.properties.media.type!==i.MediaType.NONE)return this.attachmentRegistry.add(t.applicationKey,{src:e.properties.media.src,type:$o[e.properties.media.type]})})(),a=this.mattertagData;return this.tagEditBillboard.executor.exec(e,t).then((()=>{e.properties.media&&(n.fileAttachments.replace([]),n.externalAttachments.replace([])),o&&ae(this.tagAttach,{tagId:n.sid,attachmentIds:[o]},t),a.commit()}))}}function Qo(e,t,n){function o(e){if(!e)return;return{label:e.label,type:n.toSdkLinkType(e.type),url:e.url,navigationData:e.navigationData}}const a=[];for(const n of e)a.push({type:t.toSdkChunkType(n.type),link:o(n.link),text:n.text});return a}class Jo{constructor(e,t,n,o){this.commands=e,this.tagData=t,this.floorData=n,this.floorIdMap=o}validateInput(e,t){return e}async exec(e,t){return function(e,t,n,o){const a=[];return e.iterate((e=>{const{id:s,index:r}=t.getFloor(e.floorId),c=n.getIdFromCwfId(s),d=e.externalAttachments.get(0),l=d?o.mediaConverter.toSdkMedia(d.mediaType):i.MediaType.NONE,h=d&&l!==i.MediaType.NONE?d.src:"";a.push({sid:e.sid,label:e.label,description:e.description,parsedDescription:Qo(e.parsedDescription,o.chunkTypeConverter,o.linkTypeConverter),mediaSrc:h,mediaType:l,media:{type:l,src:h},anchorPosition:{x:e.anchorPosition.x,y:e.anchorPosition.y,z:e.anchorPosition.z},anchorNormal:{x:e.anchorNormal.x,y:e.anchorNormal.y,z:e.anchorNormal.z},color:{r:e.color.r,g:e.color.g,b:e.color.b},enabled:e.enabled,floorId:r,floorIndex:r,floorInfo:{id:c,sequence:r},stemVector:{x:e.stemVector.x,y:e.stemVector.y,z:e.stemVector.z},stemHeight:e.stemHeight,stemVisible:e.stemVisible})})),a}(this.tagData,this.floorData,this.floorIdMap,this.commands)}}class ea{constructor(e,t,n){this.mattertagData=e,this.annotationsViewData=t,this.iframeSrcDoc=n,this.idGenerator=new Jt,this.usedSids=new Set}validateInput(e){const t=e.tagId;if(!ie(t))throw new Ft(t);if(!this.mattertagData.getTag(t))throw Error(e.tagId+" is not a valid tagId");if(!e.html||"string"!=typeof e.html)throw Error(e.html+" is not valid html");if(!Et(e.clientId))throw Error("Unexpected error: unable to create iframe");const n=e.options||{};let o="string"==typeof n.windowPath?n.windowPath:"";if(o&&o.split(".").filter((e=>"parent"!==e&&"opener"!==e)).length>0)throw Error(o+" is an unsupported window path");o.length>0&&"."!==o[0]&&(o="."+o);try{if(!Function("return window"+o)().postMessage)throw Error("invalid window")}catch(e){throw Error("problem finding a valid window with path: "+o)}const a={on:"on",off:"off",send:"send",tag:"tag",docked:"docked"};n.globalVariableMap&&(ie(n.globalVariableMap.on)&&(a.on=n.globalVariableMap.on),ie(n.globalVariableMap.off)&&(a.off=n.globalVariableMap.off),ie(n.globalVariableMap.send)&&(a.send=n.globalVariableMap.send),ie(n.globalVariableMap.tag)&&(a.tag=n.globalVariableMap.tag));const s={w:0,h:0};if(n.size){const e=vt(n.size.w+""),t=vt(n.size.h+"");isNaN(e)||isNaN(t)||(s.w=e,s.h=t)}return{tagId:t,clientId:e.clientId,html:e.html,options:{name:"",size:s,windowPath:o,globalVariableMap:a}}}async exec(e,t){const n=this.idGenerator.generate();return new Promise((t=>{const o=this.getUniqueSid();this.mattertagData.getTag(e.tagId).sandboxAttachments.replace([{id:o,src:"sandbox-"+o,srcDoc:this.iframeSrcDoc,onLoad:o=>{var a;o.contentWindow.postMessage({type:Zt.SETUP,id:n,targetId:e.clientId,customHTML:e.html,windowPath:e.options.windowPath,parentTag:e.tagId,docked:(null===(a=this.annotationsViewData.dockedAnnotation)||void 0===a?void 0:a.id)===e.tagId,globalVariableMap:e.options.globalVariableMap},"*"),t({messengerType:Qt.POSTMESSAGE,iframeId:n})},category:Fo.SANDBOX,created:new Date,mediaType:Vo.RICH,parentType:ho.MATTERTAG,thumbnailUrl:new Ho("",null),url:new Ho("",null),height:e.options.size.h,width:e.options.size.w}]),this.mattertagData.commit()}))}getUniqueSid(){const e=zo();return this.usedSids.has(e)?this.getUniqueSid():(this.usedSids.add(e),e)}}class ta{constructor(e){this.tagRemove=e}validateInput(e,t){return{ids:this.tagRemove.executor.validateInput({ids:Array.isArray(e.ids)?e.ids:[e.ids]},t).ids}}async exec(e,t){return this.tagRemove.executor.exec({ids:Array.isArray(e.ids)?e.ids:[e.ids]},t)}}var na,oa;!function(e){e.NOTE="note",e.TAG="tag",e.OBJECT="object"}(na||(na={})),function(e){e[e.Instant=0]="Instant",e[e.FadeToBlack=1]="FadeToBlack",e[e.Interpolate=2]="Interpolate",e[e.MoveToBlack=3]="MoveToBlack"}(oa||(oa={}));const aa={[i.Transition.FLY]:oa.Interpolate,[i.Transition.FADEOUT]:oa.FadeToBlack,[i.Transition.INSTANT]:oa.Instant};class sa{constructor(e,t,n,o){this.FocusOnPinInsideCommand=e,this.SelectAnnotationCommand=t,this.issueCommand=n,this.mattertagData=o}validateInput(e,t){if(!ie(e.id)||!this.mattertagData.getTag(e.id))throw Error(`${e.id} does not map to a valid Tag`);if(void 0!==e.transitionType&&!Ie(i.Transition,e.transitionType))throw Error(`${e.transitionType} does not match valid transition type`);return{id:e.id,transitionType:e.transitionType}}async exec(e,t){const n=this.mattertagData.getTag(e.id);let o=aa[e.transitionType];return void 0===o&&(o=oa.Interpolate),await this.issueCommand(new this.FocusOnPinInsideCommand({pinPosition:Object.assign(Object.assign({},n),{stemLength:n.stemHeight,stemNormal:n.stemVector}),transition:o})),await this.issueCommand(new this.SelectAnnotationCommand(e.id,na.TAG)),e.id}}class ia{constructor(e){this.tagAllowAction=e}validateInput(e,t){const n=this.tagAllowAction.executor.validateInput({id:e.tagId,allow:{}},t),o={navigating:!1,opening:!1};return ct(e.prevent)&&(o.navigating=!!e.prevent.navigating,o.opening=!!e.prevent.opening),{tagId:n.id,prevent:o}}exec(e,t){return this.tagAllowAction.executor.exec({id:e.tagId,allow:{navigating:!e.prevent.navigating,opening:!e.prevent.opening}},t)}}function ra(e,t,n,o,a,s){e.addEnumToInterface({namespace:"Mattertag",name:"DescriptionChunkType",values:i.DescriptionChunkType}),e.addEnumToInterface({namespace:"Mattertag",name:"Event",values:i.Event}),e.addEnumToInterface({namespace:"Mattertag",name:"LinkType",values:i.LinkType}),e.addEnumToInterface({namespace:"Mattertag",name:"MediaType",values:i.MediaType}),e.addEnumToInterface({namespace:"Mattertag",name:"Transition",values:i.Transition});const r=Object.assign(Object.assign({},n),{mediaConverter:new ca(t.MediaType)}),[c,d,l,h,u]=s;rn(e,t,n),function(e,t,n,o){o.getDependencies().then((([o])=>{const a=["",""],s=e=>{var t;return a[0]=(null===(t=o.billboardAnnotation)||void 0===t?void 0:t.id)||"",a[1]=e.url,a};n.subscribe(t.MattertagLinkOpenedMessage,(t=>{e.broadcast(i.Event.LINK_OPEN,s,t)}))}))}(e,t,n,new pe(d)),function(e,t,n){const o=ne.create(new pe(t.add,t.editIcon,t.attach,n),new F(Ko));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"add",args:["descriptors"]},o)}(e,a,u),function(e,t,n){const o=Ye.create(n,new Yo,new F(Xo,t));e.addCollectionToInterface({namespace:"Mattertag",name:"data"},o)}(e,r,new pe(c,l,h)),function(e,t,n){const o=ne.create(new pe(n.getDependencies(),t.editBillboard,t.attach),new F(Zo));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editBillboard",args:["id","properties"]},o)}(e,a,new pe(c,u)),function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editColor",args:["id","color"]},t)}(e,a.editColor),function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editIcon",args:["id","iconId"]},t)}(e,a.editIcon),function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editOpacity",args:["id","opacity"]},t)}(e,a.editOpacity),function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editPosition",args:["id","options"]},t)}(e,a.editPosition),function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editStem",args:["id","stemParams"]},t)}(e,a.editStem),function(e,t,n){const o=ne.create(n,se(new F(Jo),"`Mattertag.getData` is deprecated; subscribe to `Mattertag.data` instead",t));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"getData",args:[]},o)}(e,r,new pe(c,l,h)),function(e,t){const n=ne.create(t,new F(ea));e.addCommandToInterface(Object.assign({},nn),n)}(e,new pe(c,d,n.getIframeSrcDoc)),function(e,t,n,o){const a=ne.create(o,new F(sa,t.FocusOnPinInsideCommand,t.SelectAnnotationCommand,n.issueCommand));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"navigateToTag",args:["id","transitionType"]},a)}(e,t,n,new pe(c)),function(e,t){const n=ne.create(new pe(t),new F(ia));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"preventAction",args:["tagId","prevent"]},n)}(e,a.allowAction),function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"registerIcon",args:["textureId","textureSrc"]},t)}(e,o.registerTexture),function(e,t){const n=ne.create(new pe(t),new F(ta));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"remove",args:["ids"]},n)}(e,a.remove),function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"resetIcon",args:["id"]},t)}(e,a.resetIcon)}class ca{constructor(e){this.toSdkMediaMap={[e.IMAGE]:i.MediaType.PHOTO,[e.VIDEO]:i.MediaType.VIDEO,[e.RICH]:i.MediaType.RICH,[e.APPLICATION]:i.MediaType.NONE,[e.AUDIO]:i.MediaType.NONE,[e.MODEL]:i.MediaType.NONE,[e.PDF]:i.MediaType.NONE,[e.TEXT]:i.MediaType.NONE,[e.ZIP]:i.MediaType.NONE}}toSdkMedia(e){return this.toSdkMediaMap[e]}}class da extends j{constructor(){super(...arguments),this.id="MEASUREMENTS_GET"}}const la=async(e,t)=>{const n=[];for(const o of e.groups()){const e=o.info,a=t.getFloor(e.floorId);for(let t=1;t<o.count;t++){const s=o.get(t-1),i=o.get(t);n.push({sid:e.sid,label:e.text,floor:a.index,start:{x:s.x,y:s.y,z:s.z},end:{x:i.x,y:i.y,z:i.z}})}}return n};class ha{constructor(e){this.CwfMeasuringPhase=e}create(e,t){let n=t.groupCount,o=t.phase;const a=()=>{const a=t.groupCount,s=t.phase;n===a&&o!==this.CwfMeasuringPhase.EDITING||s!==this.CwfMeasuringPhase.IDLE||(e.onChanged(),n=a),o=s};return new ve(t.onPhaseChanged(a),t.onSelectedGroupIndexChanged(a))}}class ua{constructor(e){this.measurementModeData=e,this.data={}}update(){for(const e of this.measurementModeData.groups())this.createMeasurement(e);for(const e in this.data){this.measurementModeData.getGroupInfoBySid(e)||delete this.data[e]}}isItemEqual(e,t){return!H(this.data[t],e.data[t])}clear(){this.data={}}createMeasurement(e){const t=e.info.sid,n=this.data[t]||{},o=n.points||[];!function(e,t){let n=0;for(const o of t){const t=e[n]||{};t.x=o.x,t.y=o.y,t.z=o.z,e[n]=t,++n}e.length=n}(o,e),n.sid=t,n.points=o,this.data[t]=n}}class pa{create(e,t){return t.onChanged((()=>e.onChanged()))}}class ma{constructor(){this._data={active:!1}}get data(){return this._data}equals(e){return this._data.active===e.data.active}copy(e){this._data.active=e.data.active}update(e){this._data.active=e.modeActive()}}class ga extends j{constructor(e){super(),this.id="SDK_MEASUREMENT_TOGGLE",this.payload={active:e}}}class fa extends Se{constructor(e="Unhandled Transition Exception"){super(e),this.name="TransitionException"}}class wa extends fa{constructor(e="Unhandled Viewmode Exception",t){super(e),this.originalError=t,this.name="ViewmodeException"}}class Ta extends wa{constructor(e="Tried to start view-mode transition while another transition was active"){super(e),this.name="ViewmodeActiveTransition"}}const Ia=new ee("move-to-mode-command");class ya extends j{constructor(e){super(),this.id="MOVE_TO_MODE",this.payload=e}}class Ea{constructor(e,t,n,o){this.THREE=e,this.CmdViewmode=t,this.conversion=n,this.transitionTypeConverter=o}validateMoveToModeInput(e){if(!e)throw Error("Mode.moveTo -> no arguments provided -- mode is required");e.options||(e.options={});const t=e.mode;if(!Ie(this.CmdViewmode,e.mode))throw Error(`Mode.moveTo -> ${e.mode} is not a valid viewmode`);if(t===this.CmdViewmode.TRANSITIONING)throw Error(`Mode.moveTo -> ${e.mode} is not a valid viewmode`);e.options&&e.options.rotation&&(e.options.rotation.z=e.options.rotation.z||0);const n=this.validatePayloadOptions(e.options);return{mode:t,options:{transition:n.transition,position:n.position,rotation:n.rotation,zoom:n.zoom}}}validatePayloadOptions(e){let t,n,o,a;if(e){if(e.transition&&(o=this.transitionTypeConverter.fromSdkTransition(e.transition),void 0===o))throw Error(`Mode.moveTo -> ${e.transition} is not a valid transition style`);e.rotation&&St(e.rotation)&&(t=this.conversion.rotationToQuaternion(e.rotation)),e.position&&St(e.position)&&(n=new this.THREE.Vector3(parseFloat(e.position.x),parseFloat(e.position.y),parseFloat(e.position.z))),e.zoom&&!isNaN(e.zoom)&&(a=Fe(e.zoom,1,30))}return{rotation:t,position:n,transition:o,zoom:a}}}class va{create(e,t,n){const o=()=>e.onChanged();return new ve(n.onChanged(o),t.onChanged(o))}}class Ca{constructor(e,t){this._data=r.Mode.INSIDE,this.viewmodeConverter=t.viewmodeConverter}get data(){return this._data}equals(e){return this._data===e.data}copy(e){this._data=e.data}update(e,t){const n=t.currentSweep&&t.isSweepAligned(t.currentSweep);this._data=this.viewmodeConverter.toSdk(e.currentMode,!!n)}}class Aa extends j{constructor(){super(...arguments),this.id="GET_MODEL_DATA"}}function Sa(e,t,n){t.addBinding(Aa,(async()=>{const e=await n.getDependencies();return await async function(e,n,o,a){const s={sid:"",sweeps:[],modelSupportsVr:!1};try{const i=n.getSweepList(),r=e.model;return await t.makeModelData(r.sid,r.options.isVR,i,o,a,s),s}catch(e){throw Error("no model currently loaded")}}(...e)})),e.addCommandCreator({namespace:"Model",name:"getData",args:[]},(()=>new Aa))}class ba extends j{constructor(){super(...arguments),this.id="GET_MODEL_DETAILS"}}function Da(e,t,n,o){o.getDependencies().then((e=>n.addBinding(ba,(async()=>function(e,n){function o(e,t){if(n.tryGetProperty(e,!0))return t}const a=e.model;return{sid:a.sid,name:o(t.OptionsKey.DetailsModelName,a.details.name),presentedBy:o(t.OptionsKey.PresentedBy,a.details.presentedBy),summary:o(t.OptionsKey.DetailsSummary,a.details.summary),formattedAddress:o(t.OptionsKey.DetailsAddress,a.details.formattedAddress),contactEmail:o(t.OptionsKey.DetailsEmail,a.details.contact.email),contactName:o(t.OptionsKey.DetailsName,a.details.contact.name),phone:o(t.OptionsKey.DetailsPhone,a.details.contact.phone),formattedContactPhone:o(t.OptionsKey.DetailsPhone,a.details.contact.formattedPhone),externalUrl:o(t.OptionsKey.DetailsExternalUrl,a.details.externalUrl)}}(...e))))),e.addCommandCreator({namespace:"Model",name:"getDetails",args:[]},(()=>new ba))}function Oa(e,t){return async function(n,o,a,s,i,r){r.sweeps=[];for(const n of a){const o=n.floorId?s.getFloor(n.floorId).index:-1;r.sweeps.push({uuid:i.getIdForSweep(n),sid:i.getIdForSweep(n),alignmentType:t.toSdkAlignment(n.alignmentType),placementType:t.toSdkPlacement(n.placementType),neighbors:await Promise.all(n.neighbours.map((async e=>await i.getIdFromCwfId(e)))),position:(c=n,null!==c.position?{x:c.position.x,y:c.position.y,z:c.position.z}:null),rotation:e.quaternionToRotation(n.rotation),floor:o})}var c;return r.sid=n,r.modelSupportsVr=o,r}}class Ma{constructor(e){this.tokenUpdater=e}validateInput(e){const{token:t}=e;if(!ie(t))throw Error();return{token:t}}async exec(e,t){this.tokenUpdater.setToken(e.token)}}var Na;!function(e){e.POSTMESSAGE="postmessage",e.DIRECT="direct",e.WEBSOCKET="websocket"}(Na||(Na={}));const Ra=["dev-app.matterport.com","dev-app.matterportvr.cn","qa3-app.matterport.com","qa3-app.matterportvr.cn","my.matterport.com","my.matterportvr.cn","static.matterport.com","static.matterportvr.cn","matterport.github.io","localhost"];class Pa{constructor(e){this.pluginRegistry=e}validateInput(e){if(!ct(e.key))throw Error(e.key+" is not a valid object");const t=e.key;if(!re(t.applicationKey))throw Error(t.applicationKey+" is not a valid string");if(!re(t.id))throw Error(t.id+"is not a valid string");if(!re(e.path))throw Error(e.path+" is not a valid string");return e}async exec(e){try{await this.pluginRegistry.load({applicationKey:e.key.applicationKey,id:e.key.id||"default",src:e.path,strict:!1,config:e.config||{}})}catch(e){throw Error(e)}}}class La{constructor(e){this.pluginRegistry=e}validateInput(e){if(!ct(e.key))throw Error(e.key+" is not a valid object");if(!re(e.key.applicationKey))throw Error(e.key+" is not a valid string");return e}async exec(e){this.pluginRegistry.unload(e.key)}}class xa{create(e,t){return t.onChanged((()=>e.onChanged()))}}class ka{constructor(e,t){this.colliderTypes=t,this.ZERO=new e.Vector3(0,0,0),this.tempVec=new e.Vector3,this._data={position:{x:0,y:0,z:0},normal:{x:0,y:0,z:0},object:d.Colliders.NONE,floorId:void 0,floorIndex:void 0}}get data(){return this._data}equals(e){const t=1e-5,n=e.data.position,o=this._data.position,a=e.data.normal,s=this._data.normal;return Ne(n,o,t)&&Ne(a,s,t)&&e.data.object===this._data.object}update(e,t,n,o,a){const s=e.hit;s?(Ae(this._data.position,s.point),Ae(this._data.normal,s.face.normal),this._data.floorId=void 0,s.object instanceof this.colliderTypes.ModelColliderTarget?(this._data.object=d.Colliders.MODEL,this._data.floorId=function(e,t,n,o,a,s){let i;const r=a.floorIdFromObject(e.object);if(r)return i=t.getFloor(r),i.index;s.copy(e.point);const c=o.meshSubGroupsFromPoint(s);if(!c.length)return;const d=n.getByMeshSubgroup(c[0]);if(!d)return;return i=t.getFloor(d.floorId),i.index}(s,t,n,o,a,this.tempVec)):s.object instanceof this.colliderTypes.PinHeadMesh||s.object instanceof this.colliderTypes.InstancedPinHeads?this._data.object=d.Colliders.TAG:s.object instanceof this.colliderTypes.PuckCollider?this._data.object=d.Colliders.SWEEP:this._data.object=d.Colliders.UNKNOWN):(Ae(this._data.position,this.ZERO),Ae(this._data.normal,this.ZERO),this._data.object=d.Colliders.NONE,this._data.floorId=void 0),this._data.floorIndex=this._data.floorId}copy(e){Ae(this._data.position,e.data.position),Ae(this._data.normal,e.data.normal),this._data.object=e.data.object,this._data.floorId=e.data.floorId,this._data.floorIndex=e.data.floorIndex}}class _a{constructor(e,t){this.cursorController=e,this.textureAaps=t}validateInput(e){if(!ie(e.textureId))throw Error("textureId is not a valid string");return{textureId:e.textureId}}async exec(e,t){const{textureId:n}=e,o=this.textureAaps.get(t.applicationKey).map[n];this.cursorController.setTexture(o)}}class Va{constructor(e){this.cursorController=e}validateInput(e){return e}async exec(e,t){this.cursorController.setTexture(null)}}class Fa{constructor(e){this.cursorController=e}validateInput(e){(e=e||{}).props=e.props||{};const t=e.props;if(t.fadeIn){const e=t.fadeIn;if(e.duration&&(!Et(e.duration)||e.duration<=0))throw Error(`Pointer.setFadeProps: fadeIn.duration was specified but was not a valid duration; got ${e.duration}`)}if(t.fadeOut){const e=t.fadeOut;if(e.duration&&(!Et(e.duration)||e.duration<=0))throw Error(`Pointer.setFadeProps: fadeOut.duration was specified but was not a valid duration; got ${e.duration}`);if(e.delay&&(!Et(e.delay)||e.delay<=0))throw Error(`Pointer.setFadeProps: fadeOut.delay was specified but was not a valid delay; got ${e.delay}`)}return e}async exec(e,t){this.cursorController.setFadeProps(e.props)}}class Ua{constructor(e){this.cursorController=e,this.visible=!0,this.ruleAdded=!1}isVisible(){return this.visible}validateInput(e){if(!dt(e.visible))throw Error(`Pointer.setVisible: visible was specified but was not a valid boolean; got ${e.visible}`);return e}async exec(e,t){this.ruleAdded||(this.isVisible=this.isVisible.bind(this),this.cursorController.addVisibilityRule(this.isVisible),this.ruleAdded=!0),this.visible=e.visible}}class Ga{constructor(e){this.r3fModule=e}validateInput(e){return e}async exec(e,t){return this.r3fModule.registerExternalR3F(e.callbacks)}}const Ha=new ee("mpSdk.R3F.navigationToggle");class za{constructor(e){this.enabled=!0,this.userNavigationEnabled=()=>this.enabled,e.addNavigationRule(this.userNavigationEnabled.bind(this))}validateInput(e){return e}async exec(e,t){this.enabled=e.enabled,Ha.debug(e)}}class Ba{constructor(e,t,n,o,a){this.THREE=e,this.cwfTypes=t,this.commands=n,this.navigation=o,this.viewmodeData=a}validateInput(e){if(!e)throw Error('focus: no arguments provided -- "target" point|box is required');const t=e.target;if(!function(e){if(e&&"object"==typeof e&&"min"in e&&"max"in e){const t=e;if(St(t.min)&&St(t.max))return!0}return!1}(t)&&!St(t))throw new Error('focus: invalid "target"');const n=e.options;if(n){const{from:e,mode:t,transition:o}=n;if(e&&!St(e))throw new Error('focus: "options.from" must be a Vector3|undefined');if(t){if(void 0===this.commands.viewmodeConverter.fromSdk(t))throw Error(`focus: ${t} is not a valid "options.mode"`)}let a=this.cwfTypes.CameraTransitionType.Interpolate;if(o&&(a=this.commands.cameraTransitionConverter.fromSdkTransition(o),void 0===a))throw Error(`focus: ${o} is not a valid "options.transition"`)}return e}async exec(e,t){const n=e.target,o=this.convertOptions(e);try{await this.navigation.focus(n,o)}catch(e){console.warn("focus: unable to focus",e)}}convertOptions(e){var t,n,o,a;const s=null===(t=e.options)||void 0===t?void 0:t.mode,i=s?this.commands.viewmodeConverter.fromSdk(s):null!==(n=this.viewmodeData.currentMode)&&void 0!==n?n:void 0,r=null===(o=e.options)||void 0===o?void 0:o.from,c=r&&St(r)?new this.THREE.Vector3(r.x,r.y,r.z):void 0,d=null===(a=e.options)||void 0===a?void 0:a.transition;return{from:c,mode:i,transition:d?this.commands.cameraTransitionConverter.fromSdkTransition(d):this.cwfTypes.CameraTransitionType.Interpolate}}}const ja=new ee("mpSdk.R3F.controlsToggle");class Wa{constructor(e){this.controls=e,this.sub=null}validateInput(e){return e}async exec(e,t){if(ja.debug(e),this.sub&&e.enabled&&(this.sub.cancel(),this.sub=null),!this.sub&&!e.enabled){const e=this.controls.cameraPoseProxy;this.sub=e.newSession(new qa)}}}class qa{constructor(){}onAccessGranted(e){ja.debug("controls-block granted")}onAccessRevoked(e){ja.debug("controls-block revoked")}}class $a{constructor(e,t){this.captureCamera=e,this.encodeRenderTarget=t}async capture(e,t,n,o){const{camera:a,scene:s}=t.getScene();return a.getWorldPosition(this.captureCamera.position),a.getWorldQuaternion(this.captureCamera.quaternion),this.captureCamera.projectionMatrix.copy(a.projectionMatrix),this.captureCamera.layers.mask=e.visibleObjects.mask,o.setSize(e.resolution.width,e.resolution.height),n.render(o.target,s,this.captureCamera),await this.encodeRenderTarget(o)}}function Ka(e){return Et(e)&&e%1==0}const Ya=new ee("command.takeScreenshot");var Xa,Za;!function(e){e.Base64JPG="screenshot.base64.jpg",e.ArrayBufferJPG="screenshot.arraybuffer.jpg"}(Xa||(Xa={}));class Qa{constructor(e,t,n,o,a,s){this.canvasData=o,this.rendererModule=a,this.renderToTexture=s,this.RenderLayers=t.RenderLayers,this.screenCapturer=e,this.requestTarget=n.requestTarget,this.getRenderLayer=n.getRenderLayer,this.jpegAsBase64=n.jpegAsBase64}validateInput(e){return{resolution:this.validateResolution(e.resolution,this.canvasData,this.rendererModule),visibleObjects:this.buildVisibilityOptions(e.visibleObjects),returnType:e.returnType===Xa.ArrayBufferJPG?Xa.ArrayBufferJPG:Xa.Base64JPG}}async exec(e,t){const n=await this.requestTarget(),o=await this.screenCapturer.capture({resolution:e.resolution,visibleObjects:this.buildVisibilityLayers(e.visibleObjects)},this.rendererModule,this.renderToTexture,n);return e.returnType===Xa.ArrayBufferJPG?o.buffer:this.jpegAsBase64(o)}validateResolution(e,t,n){const o={width:0,height:0};if(!e)return o.width=t.width,o.height=t.height,o;if(!function(e){const t=e;return!!t&&("number"==typeof t.width&&"number"==typeof t.height)}(e))throw Error('"resolution" provided was not valid. Expected .width and .height to be numbers.');o.width=e.width,o.height=e.height;const a=n.maxTextureSize;if(e.width<=0||e.width>a)throw Error('"resolution.width" provided was outside the valid range of [0, '+a+"]");if(e.height<=0||e.height>a)throw Error('"resolution.height" provided was outside the valid range of [0, '+a+"]");if(!Ka(o.width)){const e=Math.round(o.width);Ya.info(`Integer width expected. Rounding from ${o.width} to ${e}`),o.width=e}if(!Ka(o.height)){const e=Math.round(o.height);Ya.info(`Integer width expected. Rounding from ${o.height} to ${e}`),o.height=e}return o}buildVisibilityOptions(e){const t=e||{};return{measurements:!!t.measurements,mattertags:!!t.mattertags,sweeps:!!t.sweeps,views:!!t.views}}buildVisibilityLayers(e){const t=this.RenderLayers.ALL;return e.mattertags||t.removeLayers(this.getRenderLayer("pins")),e.measurements||t.removeLayers(this.getRenderLayer("measurements")),e.sweeps||t.removeLayers(this.getRenderLayer("sweep-pucks")),e.views||(t.removeLayers(this.getRenderLayer("sweep-portal-mesh")),t.removeLayers(this.getRenderLayer("sweep-pin-mesh"))),t}}class Ja{constructor(e,t,n,o,a,s,i,r){this.renderer=o,this.renderToTexture=a,this.viewmodeData=s,this.sweepData=i,this.sweepTextureLoader=r,this.Viewmode=t.Viewmode,this.requestTarget=n.requestTarget,this.encodeRenderTarget=n.encodeRenderTarget,this.jpegAsBase64=n.jpegAsBase64,this.getXmp=n.getXmp,this.getOrientedAngleTo=n.getOrientedAngleTo,this.forward=new e.Vector3(0,0,-1),this.sweepForward=new e.Vector3,this.viewForward=new e.Vector3}validateInput(e){return e}async exec(e,t){if(!this.sweepData.currentSweep||this.viewmodeData.currentMode!==this.Viewmode.Panorama)throw new Error("Can only capture equirectangular projections while stationary in a sweep");const n=this.renderer.getScene().camera,o=this.sweepData.getSweep(this.sweepData.currentSweep),a=await this.sweepTextureLoader.load(o);this.sweepForward.copy(this.forward),this.sweepForward.copy(this.forward).applyQuaternion(o.rotation).setY(0);const s=this.getOrientedAngleTo(this.sweepForward,n.getWorldDirection(this.viewForward).setY(0))+Math.PI,i=await this.requestTarget();i.setSize(Ja.equirectangularRes.width,Ja.equirectangularRes.height),this.renderToTexture.renderEquirectangular(a,i.target,s);const r=await this.encodeRenderTarget(i,this.getXmp(i.width,i.height,0,0));return this.jpegAsBase64(r)}}Ja.equirectangularRes={width:4096,height:2048};class es{constructor(e,t){this.issueCommand=t.issueCommand,this.GetScreenPositionCommand=e.GetScreenPositionCommand}validateInput(e){if(!St(e.worldPosition))throw Error(`Renderer.getScreenPosition: 'worldPosition' was specified but was not a valid Vector3; got ${e.worldPosition}`);return e}async exec(e,t){return await this.issueCommand(new this.GetScreenPositionCommand(e))}}class ts{constructor(e,t,n){this.floorsData=n,this.GetFloorIntersectCommand=e.GetFloorIntersectCommand,this.issueCommand=t.issueCommand}validateInput(e){if(!function(e){if(e&&"object"==typeof e&&"x"in e&&"y"in e){const t=e;return Et(t.x)&&Et(t.y)}return!1}(e.screenPosition))throw Error(`Renderer.getWorldPositionData: 'screenPosition' was not a valid Vector2; got ${e.screenPosition}`);return e}async exec(e,t){const n=await this.issueCommand(new this.GetFloorIntersectCommand(e)),o=this.floorsData.getFloorAtIndex(n.floorIndex);return o?{position:n.position,floorInfo:{id:o.id,sequence:o.index},floor:n.floorIndex}:{position:n.position,floorInfo:{id:"",sequence:-1},floor:-1}}}class ns{constructor(){this.wasTransitioning360=!1,this.cameraPosition={x:0,y:0,z:0}}create(e,t,n,o,a){return new ve(o.onChanged((()=>this.throttleCameraPositionChanges(e,o))),a.onChanged((()=>this.throttleSweepChanges(e,a))))}throttleCameraPositionChanges(e,t){const n=t.pose.position;n.x===this.cameraPosition.x&&n.y===this.cameraPosition.y&&n.z===this.cameraPosition.z||(this.cameraPosition.x=n.x,this.cameraPosition.y=n.y,this.cameraPosition.z=n.z,e.onChanged())}throttleSweepChanges(e,t){const n=t.transition;t.transitionActive?(t.isSweepUnaligned(n.from)||t.isSweepUnaligned(n.to))&&(this.wasTransitioning360=!0):this.wasTransitioning360&&!t.isSweepUnaligned(t.currentSweep)&&(e.onChanged(),this.wasTransitioning360=!1)}}class os{constructor(){this.currentRooms={rooms:[]}}get data(){return this.currentRooms}equals(e){return this.data.rooms.length===e.data.rooms.length&&this.currentRooms.rooms.every((t=>e.data.rooms.findIndex((e=>e.id===t.id))>-1))}copy(e){this.currentRooms.rooms.length=e.data.rooms.length,be(this.currentRooms.rooms,e.data.rooms)}update(e,t,n,o,a,s,i,r){if(a.isInside()&&o.isSweepUnaligned(o.currentSweep)||o.transitionActive&&(o.isSweepUnaligned(o.transition.to)||o.isSweepUnaligned(o.transition.from)))return void(this.currentRooms.rooms.length=0);const c=s.meshSubGroupsFromPoint(n.pose.position);this.currentRooms.rooms.length=c.length;for(let n=0;n<c.length;++n){const o=c[n],a=e.getByMeshSubgroup(o),d=s.meshGroups.rooms.get(o);if(!a||!d)continue;const l=this.currentRooms.rooms[n]||{};l.id=i.getIdFromCwfId(a.id),l.bounds=l.bounds||{},l.bounds.min=qt(d.boundingBox,"min",l.bounds.min),l.bounds.max=qt(d.boundingBox,"max",l.bounds.max),l.floorInfo=Kt(a.floorId,t,r,l.floorInfo),this.currentRooms.rooms[n]=l}}}class as{create(e,t){return{renew(){},cancel(){}}}}class ss{constructor(e,t,n,o,a){this.roomData=e,this.floorData=t,this.roomIdMap=n,this.floorIdMap=o,this.meshData=a,this._data={}}get data(){return this._data}isItemEqual(e,t){const n=this.data[t],o=e.data[t];return n.id===o.id&&Ne(n.bounds.min,o.bounds.min)&&Ne(n.bounds.max,o.bounds.max)}update(){for(const e of this.roomData.rooms()){const t=this.meshData.meshGroups.rooms.get(e.meshSubgroup);if(!t)continue;const n=this.roomIdMap.getIdFromCwfId(e.id),o=this._data[n]||{};o.id=n,o.bounds=o.bounds||{},o.bounds.min=qt(t.boundingBox,"min",o.bounds.min),o.bounds.max=qt(t.boundingBox,"max",o.bounds.max),o.floorInfo=Kt(e.floorId,this.floorData,this.floorIdMap,o.floorInfo),this._data[n]=o}for(const e in this.data){this.roomIdMap.getRoomForId(e)||delete this._data[e]}}clear(){this._data={}}}!function(e){e.OUTPUT="output",e.INPUT="input",e.EVENT="event",e.EMIT="emit"}(Za||(Za={}));class is{constructor(e){this.sceneModule=e}validateInput(e){if(!ie(e.name))throw Error(`Scene.register name ${e.name} is not a string`);if(!e.factory||"function"!=typeof e.factory)throw Error("Scene.register factory is not a function");return e}async exec(e,t){if(this.sceneModule.registerFactory({scope:t.applicationKey,name:e.name},e.factory))return{dispose:()=>{this.sceneModule.unregisterFactory(e.name,e.factory)}};throw Error("There was an error registering the scene component")}}class rs{constructor(e){this.sceneModule=e}validateInput(e){return e}async exec(e,t){return this.sceneModule.createNode(t.applicationKey).publicFacade()}}class cs extends j{constructor(e){super(),this.id="SCENE_QUERY",this.payload=e}}class ds extends j{constructor(e){super(),this.id="SCENE_CONFIGURE",this.payload=e}}class ls extends j{constructor(e){super(),this.id="SCENE_GETIMAGE",this.payload=e}}class hs{constructor(e){this.sceneModule=e}validateInput(e){return e}async exec(e,t){return this.sceneModule.deserialize(t.applicationKey,e.text).object}}const us=new ee("serialize");class ps{constructor(e){this.sceneModule=e}validateInput(e){return e}async exec(e,t){Array.isArray(e.objects)&&us.warn("Serializing an array of ISceneNodes is deprecated and may produce an unexpected result.                Serialization of the ISceneObject container should be done instead.");return Array.isArray(e.objects)?this.sceneModule.serializeNodeList(e.objects):this.sceneModule.serialize(e.objects)}}class ms{constructor(e){this.sceneModule=e}validateInput(e){if(!Et(e.count))throw Error("count is not a valid number");return e}async exec(e,t){const n=[];for(let o=0;o<e.count;o++){const e=this.sceneModule.createNode(t.applicationKey);n.push(e.publicFacade())}return n}}class gs{constructor(e){this.sceneModule=e}validateInput(e){if(!ft(e.components,ct))throw Error("Scene.registerComponents array elements must be objects");for(const t of e.components){if(!ie(t.name))throw Error(`Scene.registerComponents name ${t.name} is not a string`);if(!t.factory||"function"!=typeof t.factory)throw Error("Scene.registerComponents factory is not a function")}return e}async exec(e,t){const n=[];for(const o of e.components){if(!this.sceneModule.registerFactory({scope:t.applicationKey,name:o.name},o.factory))throw Error("There was an error registering a scene component");{const e=this.sceneModule,t=function(t,n){return{dispose:function(){e.unregisterFactory(t,n)}}}(o.name,o.factory);n.push(t)}}return n}}class fs{constructor(e){this.sceneModule=e}validateInput(e){if(!Et(e.count))throw Error("count is not a valid number");return e}async exec(e,t){const n=[];for(let o=0;o<e.count;o++)n.push(this.sceneModule.createObject(t.applicationKey).publicFacade());return n}}class ws{constructor(e){this.sceneModule=e}validateInput(e){if(e=e||{},!Array.isArray(e.components))throw Error("components must be an array");return e.components=e.components||[],e}async exec(e,t){for(const t of e.components)this.sceneModule.unregisterFactory(t.name,t.factory)}}class Ts{constructor(e,t){this.sensorModule=e,this.sensorMap=t}validateInput(e){if(!ie(e.sensorId)||!this.sensorMap.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");if(!dt(e.show))throw Error(`Sensor.showDebug: 'show' was not a boolean; got ${e.show}`);return{sensorId:e.sensorId,show:e.show}}async exec(e,t){if(e.show){const t=this.sensorMap.get(e.sensorId);this.sensorModule.setDebugSensor(t)}else this.sensorModule.setDebugSensor(null)}}class Is{constructor(e){this.sensor=e,this.sourceMap=new Map,this.reverseSourceLookup=new Map,this.sourceId=0,this._data={}}get data(){return this._data}isItemEqual(e,t){return e.data[t].inRange===this.data[t].inRange&&e.data[t].inView===this.data[t].inView}update(){for(const[e,t]of this.sensor.readings){const n=this.addOrGetSourceId(e),o=this._data[n]||{};o.inRange=t.inRange,o.inView=t.inView,o.distanceSquared=t.distanceSq,o.direction=qt(t,"direction",o.direction),this._data[n]=o}for(const e in this.data){const t=this.reverseSourceLookup.get(e);t&&!this.sensor.readings.get(t)&&(this.sourceMap.delete(t),this.reverseSourceLookup.delete(e),delete this._data[e])}}clear(){this._data={}}addOrGetSourceId(e){const t=this.sourceMap.get(e);if(t)return t;const n="source-"+ ++this.sourceId;return this.sourceMap.set(e,n),this.reverseSourceLookup.set(n,e),n}}class ys{constructor(){this._data={origin:{x:0,y:0,z:0},forward:{x:0,y:0,z:-1}}}get data(){return this._data}equals(e){const t=1e-5;return Ne(this.data.origin,e.data.origin,t)&&Ne(this.data.forward,e.data.forward,t)}copy(e){Ae(this._data.origin,e.data.origin),Ae(this._data.forward,e.data.forward)}update(e){Ae(this._data.origin,e.frustum.origin),Ae(this._data.forward,e.frustum.forward)}}class Es{constructor(e,t,n,o,a){this.sdkModule=e,this.sensorFactories=t,this.sensors=n,this.sensorMap=o,this.removerMap=a}validateInput(e){if(!Ie(l.SensorType,e.type))throw Error(e.type+" is not a valid sensor type");return this.sensorFactories[e.type].validateInput(e)}async exec(e,t){const n=this.sensorFactories[e.type].create(e,this.sensors),o="sensor-"+ ++Es.nextSensorId;this.sensorMap.set(o,n);const a=V.create(new pe(n),new Cs,new F(ys)),s=this.sdkModule.addObservable(o,a),i=Ye.create(new pe(n),new As,new F(Is)),r=this.sdkModule.addCollection(o,i);return this.removerMap.set(o,{dispose(){s.dispose(),r.dispose()}}),{sensorId:o}}}Es.nextSensorId=0;class vs{validateInput(e){return e}create(e,t){return t.createCameraBoundSensor()}}class Cs{create(e,t){return t.frustum.observe(new Ss(e))}}class As{create(e,t){return t.onReadingsUpdated(new Ss(e))}}class Ss{constructor(e){this.dependencyObserver=e}notify(){this.dependencyObserver.onChanged()}}class bs{constructor(e,t){this.sensorMap=e,this.sourceMap=t}validateInput(e){if(!ie(e.sensorId)||!this.sensorMap.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");if(!ft(e.sourceIds,ie))throw Error("dev error: this should not occur unless the sdk was not setup properly");for(const t of e.sourceIds)if(!this.sourceMap.has(t))throw Error("dev error: this should not occur unless the sdk was not setup properly");return{sensorId:e.sensorId,sourceIds:e.sourceIds}}async exec(e,t){const n=this.sensorMap.get(e.sensorId),o=e.sourceIds.map(this.sourceMap.get,this.sourceMap);n.addSource(...o)}}class Ds{constructor(e,t){this.sensorMap=e,this.removerMap=t}validateInput(e){if(!ie(e.sensorId)||!this.sensorMap.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");return{sensorId:e.sensorId}}async exec(e,t){this.removerMap.get(e.sensorId).dispose();this.sensorMap.get(e.sensorId).dispose()}}const Os={namespace:"Sensor",name:"createSensor",subRoutine:"sensor.create",args:[]},Ms={namespace:"Sensor",name:"createSource",subRoutine:"source.create",args:["type","options"]};class Ns{constructor(e,t,n){this.radius=1/0,this.type=e.SPHERE,this._volume=t}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{origin:this._volume.origin,radius:this._volume.radius}}}const Rs=Math.PI/180;class Ps{constructor(e,t,n){this.type=e.BOX,this._volume=t,this.eulerCache=new n.Euler,this.quaternionCache=new n.Quaternion}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{center:this._volume.center,size:this._volume.size,orientation:this.convertQuaternionToOrientation(this._volume.orientation)}}updateOrientation(e){this.eulerCache.set(e.pitch*Rs,e.yaw*Rs,e.roll*Rs,"YXZ"),this.quaternionCache.setFromEuler(this.eulerCache),this._volume.updateOrientation(this.quaternionCache)}convertQuaternionToOrientation(e){return this.eulerCache.setFromQuaternion(this.quaternionCache.set(e.x,e.y,e.z,e.w)).reorder("YXZ"),{yaw:this.eulerCache.y*Rs,pitch:this.eulerCache.x*Rs,roll:this.eulerCache.z*Rs}}}class Ls{constructor(e,t,n){this.type=e.CYLINDER,this._volume=t}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{basePoint:this._volume.basePoint,height:this._volume.height,radius:this._volume.radius}}}function xs(e){if(e&&"object"==typeof e&&"yaw"in e&&"pitch"in e&&"roll"in e){const t=e;return Et(t.yaw)&&Et(t.pitch)&&Et(t.roll)}return!1}class ks{constructor(e,t){this.sourceFactories=e,this.sourceMap=t}validateInput(e){if(!Ie(l.SourceType,e.type))throw Error(e.type+" is not a valid source type");return this.sourceFactories[e.type].validateInput(e)}async exec(e,t){const n=this.sourceFactories[e.type].create(e),o="source-"+ ++ks.nextSourceId;return this.sourceMap.set(o,n),{sourceId:o,type:e.type,volume:n.describeVolume()}}}ks.nextSourceId=0;class _s{constructor(e,t,n){this.sourceType=e,this.sphereVolumeFactory=t,this.THREE=n}validateInput(e){if(ct(e.options)){if(e.options.origin&&!St(e.options.origin))throw Error(`Source.Box: 'origin' was specified but was not a valid Vector3; got ${e.options.origin}`);if(e.options.radius&&(!Et(e.options.radius)||e.options.radius<0))throw Error(`Source.Sphere: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`)}const t=e.options||{};return{type:e.type,options:{origin:t.origin||{x:0,y:0,z:0},radius:t.hasOwnProperty("radius")?t.radius:1/0}}}create(e){const t=new Ns(this.sourceType,new this.sphereVolumeFactory,this.THREE),n=t.volume;return n.updateOrigin(e.options.origin),n.updateRadius(e.options.radius),t}}class Vs{constructor(e,t,n){this.sourceType=e,this.boxVolumeFactory=t,this.THREE=n}validateInput(e){if(ct(e.options)){if(e.options.center&&!St(e.options.center))throw Error(`Source.Box: 'center' was specified but was not a valid Vector3; got ${e.options.center}`);if(e.options.size&&(!St(e.options.size)||e.options.size.x<0||e.options.size.y<0||e.options.size.z<0))throw Error(`Source.Box: 'size' was specified but was not a valid Vector3; got ${e.options.size}`);if(e.options.orientation&&!xs(e.options.orientation))throw Error(`Source.Box: 'orientation' was specified but was not a valid Orientation; got ${e.options.orientation}`)}const t=e.options||{};return{type:e.type,options:{center:t.center||{x:0,y:0,z:0},size:t.size||{x:1/0,y:1/0,z:1/0},orientation:t.orientation||{yaw:0,pitch:0,roll:0}}}}create(e){const t=new Ps(this.sourceType,new this.boxVolumeFactory,this.THREE),n=t.volume;return n.updateCenter(e.options.center),n.updateDimensions(e.options.size),t.updateOrientation(e.options.orientation),t}}class Fs{constructor(e,t,n){this.sourceType=e,this.cylinderVolumeFactory=t,this.THREE=n}validateInput(e){if(ct(e.options)){if(e.options.basePoint&&!St(e.options.basePoint))throw Error(`Source.Cylinder: 'basePoint' was specified but was not a valid Vector3; got ${e.options.basePoint}`);if(e.options.hasOwnProperty("height")&&(!Et(e.options.height)||e.options.height<0))throw Error(`Source.Cylinder: 'height' was specified but was not a positive number or Infinity; got ${e.options.height}`);if(e.options.hasOwnProperty("radius")&&(!Et(e.options.radius)||e.options.radius<0))throw Error(`Source.Cylinder: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`)}const t=e.options||{};return{type:e.type,options:{basePoint:t.basePoint||{x:0,y:0,z:0},height:t.hasOwnProperty("height")?t.height:1/0,radius:t.hasOwnProperty("radius")?t.radius:1/0}}}create(e){const t=new Ls(this.sourceType,new this.cylinderVolumeFactory,this.THREE),n=t.volume;return n.updateBasePoint(e.options.basePoint),n.updateHeight(e.options.height),n.updateRadius(e.options.radius),t}}class Us{constructor(e,t){this.sourceUpdaters=e,this.sourceMap=t}validateInput(e){if(!ie(e.sourceId)||!this.sourceMap.has(e.sourceId))throw Error("dev error: this should not occur unless the sdk was not setup properly");const t=this.sourceMap.get(e.sourceId);return this.sourceUpdaters[t.type].validateInput(e)}async exec(e,t){const n=this.sourceMap.get(e.sourceId);this.sourceUpdaters[n.type].update(e,n)}}class Gs{validateInput(e){if(!ct(e.options))throw Error("Source.Sphere.update: invalid options provided to .update");if(!St(e.options.origin))throw Error(`Source.Sphere.update: 'origin' was specified but was not a valid Vector3; got ${e.options.origin}`);if(!Et(e.options.radius)||e.options.radius<0)throw Error(`Source.Sphere.update: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`);return e}update(e,t){const n=t.volume;n.updateOrigin(e.options.origin),n.updateRadius(e.options.radius),n.notify()}}class Hs{validateInput(e){if(!ct(e.options))throw Error("Source.Box.update: invalid options provided to .update");if(e.options.center&&!St(e.options.center))throw Error(`Source.Box.update: 'center' was specified but was not a valid Vector3; got ${e.options.center}`);if(e.options.size&&!(St(e.options.size)&&e.options.size.x>=0&&e.options.size.y>=0&&e.options.size.z>=0))throw Error(`Source.Box.update: 'size' was specified but was not a valid Vector3; got ${JSON.stringify(e.options.size)}\n        ${"object"==typeof e}`);if(e.options.orientation&&!xs(e.options.orientation))throw Error(`Source.Box.update: 'orientation' was specified but was not a valid Orientation; got ${e.options.orientation}`);return e}update(e,t){const n=t.volume;n.updateCenter(e.options.center),n.updateDimensions(e.options.size),t.updateOrientation(e.options.orientation),n.notify()}}class zs{validateInput(e){if(!ct(e.options))throw Error("Source.Cylinder.update: invalid options provided to .update");if(e.options.basePoint&&!St(e.options.basePoint))throw Error(`Source.Cylinder.update: 'basePoint' was specified but was not a valid Vector3; got ${e.options.basePoint}`);if(e.options.hasOwnProperty("height")&&(!Et(e.options.height)||e.options.height<0))throw Error(`Source.Cylinder.update: 'height' was specified but was not a positive number or Infinity; got ${e.options.height}`);if(e.options.hasOwnProperty("radius")&&(!Et(e.options.radius)||e.options.radius<0))throw Error(`Source.Cylinder: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`);return e}update(e,t){const n=t.volume;n.updateBasePoint(e.options.basePoint),n.updateHeight(e.options.height),n.updateRadius(e.options.radius),n.notify()}}function Bs(e,t,n){const o=new Map,a=new Map;return function(s,i){!function(e,t,n,o){const a=new Map,s=ne.create(new pe(t,n),new F(bs)),i=ne.create(new pe(t,a),new F(Ds)),r=ne.create(pe.extend(o,t),new F(Ts));e.addCommand("Sensor.addSource",s),e.addCommand("sensor.dispose",i),e.addCommand("sensor.showDebug",r);const c={[l.SensorType.CAMERA]:new vs},d=ne.create(pe.extend(o,t,a),new F(Es,e,c));e.addCommandToInterface(Object.assign({},Os),d),e.addEnumToInterface({namespace:"Sensor",name:"SensorType",values:l.SensorType})}(s,o,a,i),function(e,t,n,o,a){const s=new pe(t),i={[o.SPHERE]:new Gs,[o.BOX]:new Hs,[o.CYLINDER]:new zs},r=ne.create(s,new F(Us,i));e.addCommand("Sensor.updateSource",r);const c={[l.SourceType.SPHERE]:new _s(o,a.sphere,n),[l.SourceType.BOX]:new Vs(o,a.box,n),[l.SourceType.CYLINDER]:new Fs(o,a.cylinder,n)},d=ne.create(s,new F(ks,c));e.addCommandToInterface(Object.assign({},Ms),d),e.addEnumToInterface({namespace:"Sensor",name:"SourceType",values:l.SourceType})}(s,a,e,t,n)}}var js;!function(e){e.FPS="stat.fps"}(js||(js={}));class Ws{constructor(e,t){this.perfStatInterval=1e3,this.elapsedTime=0,this.frameCount=0,this.lastCalcTime=0,this.fps=[0],this.waitForUpdate=e,this.perfStatInterval=t.tryGetProperty("perfInterval",this.perfStatInterval)}async calcAndBroadcast(e){await this.waitForUpdate();const t=Date.now(),n=t-this.lastCalcTime;this.lastCalcTime=t,this.elapsedTime+=n,this.frameCount++,this.elapsedTime>=this.perfStatInterval&&(this.fps[0]=1e3*this.frameCount/this.elapsedTime,this.elapsedTime=0,this.frameCount=0,e.broadcast(js.FPS,(()=>this.fps))),this.calcAndBroadcast(e)}}function qs(e,t="",n=""){let o="sdkStorage/";return t&&t.length>0&&(o=o+t+"/"),n&&n.length>0&&(o=o+n+"/"),o+e}class $s{constructor(e){this.modelData=e}validateInput(e){const t=null==e?void 0:e.key;if(!t||"string"!=typeof t)throw Error(t+" is not a valid key");return e}async exec(e){localStorage.setItem(qs(e.key,this.modelData.model.sid),JSON.stringify(e.data))}}class Ks{constructor(e){this.modelData=e}validateInput(e){const t=null==e?void 0:e.key;if(!t||"string"!=typeof t)throw Error(t+" is not a valid key");return{key:e.key}}async exec(e){const t=localStorage.getItem(qs(e.key,this.modelData.model.sid));return t?JSON.parse(t):null}}class Ys{constructor(e){this.modelData=e}validateInput(e){let t=null==e?void 0:e.modelId;if(null==t)t=this.modelData.model.sid;else if("*"===t)t="";else if("string"!=typeof t)throw Error(t+" is not a valid key");return{modelId:t}}async exec(e){const t=qs("",e.modelId),n={};for(const[e,o]of Object.entries(localStorage))e.startsWith(t)&&(n[e.slice(t.length)]=JSON.parse(o));return n}}class Xs{constructor(e){this.modelData=e}validateInput(e){const t=null==e?void 0:e.key;if(!t||"string"!=typeof t)throw Error(t+" is not a valid key");return{key:e.key}}async exec(e){localStorage.removeItem(qs(e.key,this.modelData.model.sid))}}class Zs{constructor(e,t){this.toSdkAlignmentMap={[e.ALIGNED]:h.Alignment.ALIGNED,[e.UNALIGNED]:h.Alignment.UNALIGNED},this.toSdkPlacementMap={[t.UNPLACED]:h.Placement.UNPLACED,[t.AUTO]:h.Placement.AUTO,[t.MANUAL]:h.Placement.MANUAL}}toSdkAlignment(e){return this.toSdkAlignmentMap[e]}toSdkPlacement(e){return this.toSdkPlacementMap[e]}}const Qs=Object.freeze({signedUrlDefaultExpireTime:24e4,signedUrlCheckInterval:1e4,signedUrlRefreshBuffer:15e3,visionTilingStartDate:new Date("8/26/2016"),visionTilingStartVersion:"1.1.407.13667",epsilon:1e-5,skyboxMeshGroup:"_group_skybox_",skysphereMeshGroup:"_group_skysphere_"});class Js{constructor(){this.currentSweep="",this.sweepTransitionActive=!1,this.currentMode=null,this.modeTransitionActive=!1}create(e,t,n){return new ve(t.onChanged((()=>this.throttleSweepDataChanges(e,t))),n.onChanged((()=>this.throttleViewmodeDataChanges(e,n))))}throttleSweepDataChanges(e,t){const n=t.currentSweep||"",o=t.transition.active&&t.transition.to!==t.transition.from;this.currentSweep===n&&this.sweepTransitionActive===o||(this.currentSweep=n,this.sweepTransitionActive=o,e.onChanged())}throttleViewmodeDataChanges(e,t){const n=t.currentMode,o=t.transition.active;this.currentMode===n&&this.modeTransitionActive===o||(this.currentMode=n,this.modeTransitionActive=o,e.onChanged())}}class ei{constructor(e,t){this.currentSweep=Object.assign(Object.assign({},ei.empty),{floorInfo:Object.assign({},ei.empty.floorInfo),neighbors:[],position:Object.assign({},ei.empty.position),rotation:Object.assign({},ei.empty.rotation)}),this.Viewmode=e.Viewmode,this.sweepPlacementConverter=t.sweepPlacementConverter}get data(){return this.currentSweep}equals(e){const t=Qs.epsilon;return this.currentSweep.id===e.data.id&&this.currentSweep.enabled===e.data.enabled&&this.currentSweep.alignmentType===e.data.alignmentType&&this.currentSweep.placementType===e.data.placementType&&this.currentSweep.floorInfo.id===e.data.floorInfo.id&&this.currentSweep.floorInfo.sequence===e.data.floorInfo.sequence&&this.compareNeighbors(e.currentSweep)&&Ne(this.currentSweep.position,e.data.position,t)&&Ne(this.currentSweep.rotation,e.data.rotation,t)}copy(e){this.copySweep(e.data)}update(e,t,n,o,a){const s=e.currentSweepObject;if(!s||e.transition.active||t.transition.active||!t.isInside()&&t.currentMode!==this.Viewmode.Outdoor)return void this.copySweep(ei.empty);let i;try{i=n.getFloor(s.floorId||"")}catch(e){i={id:void 0,index:void 0}}const r=o.getIdForSweep(s);this.currentSweep.uuid=s.uuid,this.currentSweep.sid=r,this.currentSweep.id=r,this.currentSweep.enabled=s.enabled,this.currentSweep.alignmentType=this.sweepPlacementConverter.toSdkAlignment(s.alignmentType),this.currentSweep.placementType=this.sweepPlacementConverter.toSdkPlacement(s.placementType),this.currentSweep.neighbors=[...s.neighbours],Ae(this.currentSweep.position,s.position),Ae(this.currentSweep.rotation,s.rotation),this.currentSweep.alignmentType===h.Alignment.UNALIGNED&&this.currentSweep.placementType===h.Placement.UNPLACED?(this.currentSweep.floorInfo.id=void 0,this.currentSweep.floorInfo.sequence=void 0):(this.currentSweep.floorInfo.id=i.id?a.getIdFromCwfId(i.id):i.id,this.currentSweep.floorInfo.sequence=i.index)}copySweep(e){this.currentSweep.uuid=e.uuid,this.currentSweep.sid=e.sid,this.currentSweep.id=e.id,this.currentSweep.enabled=e.enabled,this.currentSweep.alignmentType=e.alignmentType,this.currentSweep.placementType=e.placementType,this.currentSweep.floorInfo.id=e.floorInfo.id,this.currentSweep.floorInfo.sequence=e.floorInfo.sequence,this.currentSweep.neighbors=[...e.neighbors],Ae(this.currentSweep.position,e.position),Ae(this.currentSweep.rotation,e.rotation)}compareNeighbors(e){const t=this.currentSweep.neighbors.length;for(let n=0;n<t;++n)if(this.currentSweep.neighbors[n]!==e.neighbors[n])return!1;return t===e.neighbors.length}}ei.empty={uuid:"",sid:"",id:"",enabled:!1,alignmentType:h.Alignment.ALIGNED,placementType:h.Placement.UNPLACED,floorInfo:{id:void 0,sequence:void 0},neighbors:[],position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}};class ti{constructor(e,t,n,o){this.sweepData=n,this.sweepIdMap=o,this.NavigateToSweepCommand=e.NavigateToSweepCommand,this.issueCommand=t.issueCommand,this.cameraTransitionConverter=t.cameraTransitionConverter,this.conversion=t.conversionUtils}validateInputSweepId(e,t,n){if(!e||!ie(e))throw Error(`Sweep.moveTo: 'sweep' was not a valid sweep id; got ${e}`);const o=n.getSweepForId(e);if(!o)throw Error(e+" does not map to a valid sweep in this model");return o.id}validateInputRotation(e){if(!e)return;const t=Error(`Sweep.moveTo: 'options.rotation' was specified but was not a valid Rotation; got ${e}`);if(e&&!ct(e))throw t;const n=e||{},o={x:vt(n.x),y:vt(n.y)};if(n.z&&(o.z=vt(n.z)),!function(e){const t=e;return!!t&&!("object"!=typeof t||"z"in t&&!Et(t.z))&&Et(t.x)&&Et(t.y)}(o))throw t;return o}validateTransitionTime(e){if(!e)return;const t=Error(`Sweep.moveTo: options.transitionTime was specified but was not a valid, positive time; got ${e}`);if(!Et(e)&&!ie(e))throw t;const n="number"==typeof e?e:vt(e);if(!Et(n)||n<=0)throw t;return n}validateInput(e){const t=this.validateInputSweepId(e.sweep,this.sweepData,this.sweepIdMap),n=e.options||{},o=this.validateInputRotation(n.rotation),a=this.validateTransitionTime(n.transitionTime);if(n.transition&&!Ie(I,n.transition))throw Error(`Sweep.moveTo: options.transition was specified but was not a valid transition type; got ${n.transition}`);return{sweep:t,options:{rotation:o,transition:n.transition,transitionTime:a}}}async exec(e,t){const n=e.options.rotation?this.conversion.rotationToQuaternion(e.options.rotation):void 0,o=e.options.transition,a=e.options.transition?this.cameraTransitionConverter.fromSdkTransition(o):void 0,s=e.options.transitionTime;return await this.issueCommand(new this.NavigateToSweepCommand({sweep:e.sweep,rotation:n,transition:a,transitionTime:s}))}}class ni{create(e,t){return t.onChanged((()=>e.onChanged()))}}class oi{constructor(e,t,n,o,a,s){this.sweepData=n,this.floorsData=o,this.sweepIdMap=a,this.floorIdMap=s,this._data={},this.conversionUtils=e,this.sweepPlacementConverter=t}get data(){return this._data}isItemEqual(e,t){return!H(this.data[t],e.data[t])}update(){for(const e of this.sweepData.sweeps()){const{id:t,index:n}=e.floorId?this.floorsData.getFloor(e.floorId):{id:"",index:-1},o=t?this.floorIdMap.getIdFromCwfId(t):void 0,a=this.sweepIdMap.getIdFromCwfId(e.id),s=this.data[a]||{};s.uuid=e.uuid,s.sid=a,s.id=a,s.enabled=e.enabled,s.alignmentType=this.sweepPlacementConverter.toSdkAlignment(e.alignmentType),s.neighbors=e.neighbours.map((e=>this.sweepIdMap.getIdFromCwfId(e))),s.position=ai(e,s.position),s.rotation=this.conversionUtils.quaternionToRotation(e.rotation,s.rotation),s.floorInfo=o?{id:o,sequence:n}:{id:"",sequence:-1},this.data[s.id]=s}for(const e in this.data){this.sweepIdMap.getSweepForId(e)||delete this.data[e]}}clear(){this._data={}}}function ai(e,t){return(t=t||{}).x=e.position.x,t.y=e.position.y,t.z=e.position.z,t}class si{constructor(e,t,n){this.sweepData=e,this.sweepViewData=t,this.sweepIdMap=n}validateInput(e){return{sweepIds:ri(e.sweepIds,this.sweepData,this.sweepIdMap)}}async exec(e,t){for(const t of e.sweepIds)ci(t,!0,this.sweepData,this.sweepViewData)}}class ii{constructor(e,t,n){this.sweepData=e,this.sweepViewData=t,this.sweepIdMap=n}validateInput(e){return{sweepIds:ri(e.sweepIds,this.sweepData,this.sweepIdMap)}}async exec(e,t){for(const t of e.sweepIds)ci(t,!1,this.sweepData,this.sweepViewData)}}function ri(e,t,n){if(!Array.isArray(e))throw Error();return e.map((e=>function(e,t,n){if(!ie(e))throw Error(e+" is not a valid string input");const o=n.getSweepForId(e);if(!o)throw Error(e+" does not map to a valid sweep in this model");return o.id}(e,0,n)))}function ci(e,t,n,o){o.setVisible(e,t);const a=n.getSweep(e);a.enabled=t,a.commit()}class di{create(e,t){return t.onChanged({notify(){e.onChanged()}})}}class li{constructor(e){this.attachmentRegistry=e,this._data={}}get data(){return this._data}isItemEqual(e,t){return this.data[t].id===e.data[t].id&&this.data[t].src===e.data[t].src&&this.data[t].type===e.data[t].type}update(){for(const[,e]of this.attachmentRegistry.descriptors()){const t=this._data[e.id]||{};t.id=e.id,t.src=e.src,t.type=e.type,this._data[e.id]=t}for(const e in this.data){this.attachmentRegistry.has(e)||delete this._data[e]}}clear(){this._data={}}}class hi{constructor(e,t){this.mattertagData=e,this.attachmentRegistry=t,this.attachmentCounts=new Map}validateInput(e,t){ie(e.tagId)||this.throw(oe("tagId","string",e.tagId)),this.mattertagData.getTag(e.tagId)||this.throw(`${e.tagId} does not map to a valid tag`),ft(e.attachmentIds,ie)||this.throw(oe("attachmentId","string or strings",e.tagId));for(const n of e.attachmentIds)this.attachmentRegistry.get(t.applicationKey,n)||this.throw(`${n} does not map to a valid attachment`);return{tagId:e.tagId,attachmentIds:e.attachmentIds}}async exec(e,t){for(const n of e.attachmentIds){const o=this.attachmentRegistry.get(t.applicationKey,n);o||this.throw(`${n} does not map to a valid attachment`);const a=this.attachmentCounts.get(o)||0;this.attachmentCounts.set(o,a+1);const s=this.mattertagData.getTag(e.tagId);o.category===Fo.UPLOAD?s.fileAttachments.push(o):o.category===Fo.EXTERNAL?s.externalAttachments.push(o):o.category===Fo.SANDBOX&&s.sandboxAttachments.push(Object.assign(Object.assign({},o),{src:o.src+`?id=${o.id}&parent=${e.tagId}&${a}`}))}this.mattertagData.commit()}throw(e){throw Error("Tag.attach: "+e)}}class ui{constructor(e,t){this.mattertagData=e,this.attachmentRegistry=t}validateInput(e,t){ie(e.tagId)||this.throw(oe("tagId","string",e.tagId)),this.mattertagData.getTag(e.tagId)||this.throw(`${e.tagId} does not map to a valid tag`),ft(e.attachmentIds,ie)||this.throw(oe("attachmentId","string or strings",e.tagId));for(const n of e.attachmentIds)this.attachmentRegistry.get(t.applicationKey,n)||this.throw(`${n} does not map to a valid attachment`);return{tagId:e.tagId,attachmentIds:e.attachmentIds}}async exec(e,t){for(const n of e.attachmentIds){const o=this.attachmentRegistry.get(t.applicationKey,n);if(!o)return void this.throw(`${n} does not map to a valid attachment`);const a=this.mattertagData.getTag(e.tagId);o.category===Fo.UPLOAD?pi(a.fileAttachments,o.id):o.category===Fo.EXTERNAL?pi(a.externalAttachments,o.id):o.category===Fo.SANDBOX&&pi(a.sandboxAttachments,o.id)}this.mattertagData.commit()}throw(e){throw Error("Tag.detach: "+e)}}function pi(e,t){const n=e.findIndex((e=>e.id===t));n>=0&&e.splice(n,1)}class mi{constructor(e){this.attachmentRegistry=e,this.log=new ee("tag.registerAttachment")}validateInput(e,t){const n=e.srcs;return ft(n,re)||(ft(n,this.validateDescriptor)&&this.log.warn("Using attachment descriptors is deprecated and will be removed when Early Access closes."),this.throw(oe("descriptors","Array of AttachmentDescriptors or strings",n))),{srcs:n}}validateDescriptor(e,t){return ct(e)||this.throw(`descriptor #${t} is not an object`),ie(e.src)||this.throw(`descriptor[${t}].src is not a string`),Ie(u.AttachmentType,e.type)&&e.type!==u.AttachmentType.UNKNOWN||this.throw(`descriptor[${t}].type is not a valid attachment type`),e.type===u.AttachmentType.SANDBOX&&this.throw(`descriptor[${t}] has type ${u.AttachmentType.SANDBOX} and should be registered using 'Tag.registerSandbox' instead`),!0}async exec(e,t){const n=[];for(const o of e.srcs){const e="string"==typeof o?await this.attachmentRegistry.addBySrc(t.applicationKey,o):this.attachmentRegistry.add(t.applicationKey,o);n.push(e)}return n}throw(e){throw Error("Tag.registerAttachment: "+e)}}class gi{create(e,t){return t.onChanged((()=>e.onChanged()))}}class fi{constructor(e,t,n,o,a){this.THREE=e,this.mattertagData=t,this.roomIdMap=n,this.roomData=o,this.meshData=a,this._data={}}get data(){return this._data}isItemEqual(e,t){return!H(this.data[t],e.data[t])}update(){const e=e=>{const t=(new this.THREE.Vector3).set(e.x,e.y,e.z);for(const e of this.roomData.rooms()){const n=this.meshData.meshGroups.rooms.get(e.meshSubgroup);if(n&&n.boundingBox.containsPoint(t))return e}};for(const t of this.mattertagData.getTagList()){const n=this.mattertagData.getTag(t),o=this.data[n.sid]||{};if(o.id=n.sid,o.anchorPosition=qt(n,"anchorPosition",o.anchorPosition),o.stemVector=qt(n,"stemVector",o.stemVector),o.stemVisible=n.stemVisible,o.label=n.label,o.description=n.description,o.color=$t(n,"color",o.color),o.keywords=be(o.keywords||[],n.keywords),n.roomId)o.roomId=this.roomIdMap.getIdFromCwfId(n.roomId);else{const t=e(o.anchorPosition);t&&t.id&&(o.roomId=this.roomIdMap.getIdFromCwfId(t.id))}const a=n.fileAttachments.map((e=>e.id)),s=n.externalAttachments.map((e=>e.id)),i=n.sandboxAttachments.map((e=>e.id));o.attachments=[...a,...s,...i],this._data[n.sid]=o}for(const e in this.data){this.mattertagData.getTag(e)||delete this._data[e]}}clear(){this._data={}}}const wi=new ee("command.add");class Ti{constructor(e,t,n,o,a,s,i,r,c,d,l){this.THREE=e,this.AddMattertagCommand=t.AddMattertagCommand,this.issueCommand=n.issueCommand,this.mattertagsData=o,this.annotationsViewData=r,this.tagAttach=a,this.tagEditOpacity=s,this.attachmentRegistry=i,this.floorsData=c,this.roomData=d,this.meshData=l}validateInput(e,t){const{descriptors:n}=e;return ft(n,((e,n)=>this.validateDescriptor(e,n,t)))||this.throw("descriptors is not an array"),{descriptors:n}}validateDescriptor(e,t,n){if(ct(e)||this.throw(`descriptor #${t} is not an object`),St(e.anchorPosition)||this.throw(`descriptor[${t}].anchorPosition is not vector`),St(e.stemVector)||this.throw(`descriptor[${t}].stemVector is not vector`),void 0===e.id||ie(e.id)||this.throw(`descriptor[${t}].id is not a string`),void 0===e.stemVisible||dt(e.stemVisible)||this.throw(`descriptor[${t}].stemVisible is not a boolean`),void 0===e.label||re(e.label)||this.throw(`descriptor[${t}].label is not a string`),void 0===e.description||re(e.description)||this.throw(`descriptor[${t}].description is not a string`),void 0!==e.attachments){ft(e.attachments,re)||this.throw(`descriptor[${t}].attachments is not an array of strings`);for(let o=0;o<e.attachments.length;++o){const a=e.attachments[o];this.attachmentRegistry.get(n.applicationKey,a)||this.throw(`descriptor[${t}].attachment[${o}] does not map to a valid attachment`)}}return void 0===e.color||bt(e.color)||this.throw(`descriptor[${t}].color is not a Color`),void 0!==e.opacity&&(Et(e.opacity)||this.throw(`descriptor[${t}].opacity is not a number`),At(e.opacity,0,1)||(wi.warn(`descriptor[${t}].opacity was clamped from ${e.opacity} to the range [0, 1]`),e.opacity=Ct(e.opacity,0,1))),e.id&&this.mattertagsData.getTag(e.id)&&this.throw(`descriptor[${t}].id (${e.id}) is already in use`),!0}async exec(e,t){const n=[],o=[];for(let t=0;t<e.descriptors.length;t++){const a=new this.THREE.Vector3,s=new this.THREE.Vector3,i=e.descriptors[t];a.set(i.anchorPosition.x,i.anchorPosition.y,i.anchorPosition.z),s.set(i.stemVector.x,i.stemVector.y,i.stemVector.z);const r=s.length();s.normalize();const c=Mt(a,this.floorsData,this.roomData,this.meshData),d=this.floorsData.getFloorAtIndex(c);d||this.throw(`Could not add Tag on invalid floor with index: ${c}`),n.push({id:i.id,positionOptions:{position:a,normal:s,floorId:d.id},standardOptions:{label:i.label,description:i.description,stemVisible:i.stemVisible,stemHeight:r,color:i.color}}),i.attachments&&o.push(t)}const a=await this.issueCommand(new this.AddMattertagCommand(n));for(let n=0;n<e.descriptors.length;n++){const o=a[n],s=e.descriptors[n];this.annotationsViewData.updateCapabilities(o,{dock:!0,preview:!0,select:!0,share:!1}),void 0!==s.opacity&&await this.tagEditOpacity.exec({id:o,opacity:s.opacity},t),s.attachments&&ae(this.tagAttach,{tagId:o,attachmentIds:s.attachments},t)}return a}throw(e){throw Error("Tag.add: "+e)}}function Ii(e,t){return ie(e)&&!!t.getTag(e)}class yi{constructor(e,t){this.externals=e,this.mattertagsData=t}validateInput(e,t){var n;if(!Ii(e.id,this.mattertagsData))throw Error(`${e.id} does not map to a valid Tag`);if(void 0!==e.options&&!ct(e.options))throw Error(oe("options","object",e.options));return{id:e.id,options:{force:!!(null===(n=e.options)||void 0===n?void 0:n.force)}}}async exec(e,t){await this.externals.issueCommand(new this.externals.OpenTagCommand(e.id,{forceOpen:e.options.force}))}}class Ei{constructor(e,t){this.externals=e,this.mattertagsData=t}validateInput(e,t){var n;if(!Ii(e.id,this.mattertagsData))throw Error(`${e.id} does not map to a valid Tag`);if(void 0!==e.options&&!ct(e.options))throw Error(oe("options","object",e.options));return{id:e.id,options:{force:!!(null===(n=e.options)||void 0===n?void 0:n.force)}}}async exec(e,t){await this.externals.issueCommand(new this.externals.DockAnnotationCommand(e.id,na.TAG,e.options.force))}}class vi{constructor(e,t,n){this.externals=e,this.mattertagsData=t,this.tagsViewData=n}validateInput(e,t){if(!Ii(e.id,this.mattertagsData))throw Error(`${e.id} does not map to a valid Tag`);return{id:e.id}}async exec(e,t){var n;(null===(n=this.tagsViewData.openTagView)||void 0===n?void 0:n.id)===e.id&&await this.externals.issueCommand(new this.externals.CloseTagCommand)}}var Ci;!function(e){e.MATTERTAG="mattertag",e.NOTE="note",e.OBJECT="object"}(Ci||(Ci={}));Ci.MATTERTAG,Ci.NOTE,Ci.OBJECT;var Ai,Si,bi,Di;!function(e){e.DEFAULT="default",e.HIGHLIGHTED="highlighted",e.DIMMED="dimmed"}(Ai||(Ai={})),function(e){e.IDLE="idle",e.CREATING="creating",e.PRESSING="pressing",e.PLACING="placing",e.PLACED="placed"}(Si||(Si={})),function(e){e.UP="up",e.UP_LEFT="up-left",e.UP_RIGHT="up-right",e.DOWN="down",e.DOWN_LEFT="down-left",e.DOWN_RIGHT="down-right",e.LEFT="left",e.RIGHT="right"}(bi||(bi={}));class Oi{constructor(){this.focusedPin=null,this.selectedPin=null,this.dockedAnnotation=null}create(e,t,n){return new ve(t.onChanged((()=>this.throttlePinChanges(e,t))),n.onChanged((()=>this.throttleAnnotationChanges(e,n))))}throttlePinChanges(e,t){var n,o;const a=null!==(o=null===(n=t.focusedPin)||void 0===n?void 0:n.id)&&void 0!==o?o:null,s=t.selectedPinId;this.focusedPin===a&&this.selectedPin===s||(this.focusedPin=a,this.selectedPin=s,e.onChanged())}throttleAnnotationChanges(e,t){var n,o;const a=null!==(o=null===(n=t.dockedAnnotation)||void 0===n?void 0:n.id)&&void 0!==o?o:null;this.dockedAnnotation!==a&&(this.dockedAnnotation=a,e.onChanged())}}class Mi{constructor(){this._data={hovered:null,selected:new Set,docked:null}}get data(){return this._data}equals(e){return this.data.hovered===e.data.hovered&&this.data.docked===e.data.docked&&(t=this.data.selected,n=e.data.selected,t.size===n.size&&[...t].every((e=>n.has(e))));var t,n}update(e,t){var n,o;const a=e.focusedPin,s=e.selectedPinId?e.getPin(e.selectedPinId):null,i=null!==(o=null===(n=t.dockedAnnotation)||void 0===n?void 0:n.id)&&void 0!==o?o:null;this._data.hovered=(null==a?void 0:a.pinType)===Ci.MATTERTAG?a.id:null,this._data.selected.clear(),s&&s.pinType===Ci.MATTERTAG&&this._data.selected.add(s.id),this._data.docked=i}copy(e){this._data.hovered=e.data.hovered,this._data.docked=e.data.docked,function(e,t){e.clear();for(const n of t)e.add(n)}(this._data.selected,e.data.selected)}}class Ni{constructor(e,t,n){this.attachmentRegistry=e,this.tagViewData=t,this.iframeSrcDoc=n,this.idGenerator=new Jt}validateInput(e){if(!e.html||"string"!=typeof e.html)throw Error(e.html+" is not valid html");if(!Et(e.clientId))throw Error("Unexpected error: unable to create iframe");const t=e.options||{},n={on:"on",off:"off",send:"send",tag:"tag",docked:"docked"};t.globalVariableMap&&(ie(t.globalVariableMap.on)&&(n.on=t.globalVariableMap.on),ie(t.globalVariableMap.off)&&(n.off=t.globalVariableMap.off),ie(t.globalVariableMap.send)&&(n.send=t.globalVariableMap.send),ie(t.globalVariableMap.tag)&&(n.tag=t.globalVariableMap.tag),ie(t.globalVariableMap.docked)&&(n.docked=t.globalVariableMap.docked));const o={w:0,h:0};if(t.size){if(!(Et(t.size.w)&&t.size.w>=0&&Et(t.size.h)&&t.size.h>=0))throw Error(oe("options.size","Size",t.size));o.w=t.size.w,o.h=t.size.h}return{clientId:e.clientId,html:e.html,options:{name:t.name||"",globalVariableMap:n,size:o}}}async exec(e,t){const n=this.idGenerator.generate(),[o]=this.attachmentRegistry.addSandbox(t.applicationKey,{name:e.options.name,srcDoc:this.iframeSrcDoc,sandboxLoadedHandler:(t,o)=>{var a;t.contentWindow.postMessage({type:Zt.SETUP,id:n,targetId:e.clientId,customHTML:e.html,windowPath:"",parentTag:o,docked:(null===(a=this.tagViewData.dockedAnnotation)||void 0===a?void 0:a.id)===o,globalVariableMap:e.options.globalVariableMap},"*")},size:e.options.size});return{messengerType:Qt.POSTMESSAGE,iframeId:n,attachmentId:o}}}class Ri{constructor(e,t,n,o,a){this.externalTypes=e,this.externalCommands=t,this.pinViewData=n,this.tagsViewData=o,this.annotationsViewData=a}validateInput(e,t){const n=e.id;ie(n)&&this.pinViewData.getPin(n)||this.throw(`${e.id} does not map to a valid tag`);const o={opening:!1,navigating:!1,docking:!1};return ct(e.allow)&&(o.opening=!!e.allow.opening,o.navigating=!!e.allow.navigating,o.docking=!!e.allow.docking),{id:n,allow:o}}async exec(e,t){const n=this.pinViewData.getPin(e.id);if(n){const t=this.annotationsViewData.getCapabilities(n.id);this.annotationsViewData.updateCapabilities(n.id,{dock:e.allow.docking,preview:e.allow.opening,select:e.allow.navigating,share:t.share}),this.tagsViewData.updateCapabilities(n.id,{focus:!!e.allow.navigating}),e.allow.opening||this.externalCommands.issueCommand(new this.externalTypes.CloseAnnotationCommand(n.id,na.TAG))}else this.throw(`${e.id} does not map to a valid tag`)}throw(e){throw Error("Tag.allowAction: "+e)}}class Pi{constructor(e,t,n){this.mattertagData=n,this.EditMattertagCommand=e.EditMattertagCommand,this.issueCommand=t.issueCommand}validateInput(e,t){const{id:n}=e;return ie(n)||this.throw(oe("id","string",n)),this.mattertagData.getTag(n)||this.throw(`${n} does not map to a valid tag`),{id:n,properties:this.validateProperties(e.properties)}}validateProperties(e){ct(e)||this.throw("'properties' input is not an object");const{label:t,description:n}=e;return void 0===t||re(t)||this.throw(oe("label","string (or undefined)",t)),void 0===n||re(n)||this.throw(oe("description","string (or undefined)",n)),{label:t,description:n}}async exec(e,t){try{await this.issueCommand(new this.EditMattertagCommand(e.id,{label:e.properties.label,description:e.properties.description}))}catch(e){this.throw(e)}}throw(e){throw Error("Tag.editBillboard: "+e)}}class Li{constructor(e,t,n,o){this.THREE=e,this.EditMattertagCommand=t.EditMattertagCommand,this.issueCommand=n.issueCommand,this.mattertagData=o}validateInput(e,t){return ie(e.id)||this.throw(oe("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),bt(e.color)||this.throw(oe("color","Color",e.color)),{id:e.id,color:e.color}}async exec(e,t){try{const t=(new this.THREE.Color).setRGB(e.color.r,e.color.g,e.color.b);await this.issueCommand(new this.EditMattertagCommand(e.id,{color:t}))}catch(e){this.throw(e)}}throw(e){throw Error("Tag.editColor: "+e)}}class xi{constructor(e,t,n,o){this.THREE=e,this.mattertagData=t,this.mattertagMeshes=n,this.iconMaps=o}validateInput(e,t){return ie(e.id)||this.throw(oe("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),ie(e.iconId)||this.throw(oe("iconId","string",e.iconId)),{id:e.id,iconId:e.iconId}}async exec(e,t){const{id:n,iconId:o}=e,a=this.iconMaps.get(t.applicationKey);let s;try{s=await a.imagePromise[o]}catch(e){this.throw(e)}const i=a.map[o],r=s.naturalWidth/s.naturalHeight,c=new this.THREE.Vector3;r>1?c.set(r,1,1):c.set(1,1/r,1),this.mattertagMeshes.setOverrideMaterial(n,i,c)}throw(e){throw Error("Tag.editIcon: "+e)}}class ki{constructor(e,t,n){this.cwfTypes=e,this.mattertagData=n,this.issueCommand=t.issueCommand}validateInput(e,t){re(e.id)&&this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),e.stemParams&&ct(e.stemParams)||this.throw("invalid stem parameters objeect");const{stemHeight:n,stemVisible:o}=e.stemParams;return void 0===n||Et(n)||this.throw(oe("stemHeight","number",e.id)),void 0===o||dt(o)||this.throw(oe("stemVisibility","boolean",e.id)),{id:e.id,stemParams:{stemHeight:n,stemVisible:o}}}async exec(e){const{stemHeight:t,stemVisible:n}=e.stemParams,o={};void 0!==t&&(o.stemHeight=t),void 0!==n&&(o.stemVisible=n),await this.issueCommand(new this.cwfTypes.EditMattertagCommand(e.id,o))}throw(e){throw Error("Tag.editStem: "+e)}}class _i{constructor(e,t,n,o){this.ChangePinOpacityScaleCommand=e.ChangePinOpacityScaleCommand,this.PinType=e.PinType,this.issueCommand=t.issueCommand,this.mattertagData=n,this.pinsViewData=o}validateInput(e,t){return ie(e.id)||this.throw(oe("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),(!Et(e.opacity)||e.opacity<0||e.opacity>1)&&this.throw("'opacity' should be a number in the range of [0, 1]"),{id:e.id,opacity:e.opacity}}async exec(e,t){await this.waitForTagView(e.id),await this.issueCommand(new this.ChangePinOpacityScaleCommand(e.id,this.PinType.MATTERTAG,e.opacity))}async waitForTagView(e){if(!this.pinsViewData.getPin(e))return new Promise((t=>{const n=this.pinsViewData.onPinUpdate({onAdded(o,a){a===e&&(n.cancel(),t())}})}))}throw(e){throw Error("Tag.editOpacity: "+e)}}class Vi{constructor(e,t,n,o){this.mattertagData=n,this.roomIdMap=o,this.cwfTypes=e,this.issueCommand=t.issueCommand}validateInput(e){return ie(e.id)&&this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),{id:e.id,options:this.validateOptions(e.options)}}validateOptions(e){return e&&ct(e)||this.throw("invalid options provided"),{anchorPosition:this.validateVector3(e.anchorPosition,"`anchorPosition` was provided but not a valid Vector3"),stemVector:this.validateVector3(e.stemVector,"`stemVector` was provided, but not a valid Vector3"),roomId:this.validateRoomId(e.roomId)}}validateVector3(e,t){return void 0===e||St(e)||this.throw(t),e}validateRoomId(e){return void 0===e||ie(e)||this.throw(oe("roomId","string (or undefined)",e)),e&&!this.roomIdMap.getRoomForId(e)&&this.throw(`${e} does not map to a valid room`),e}async exec(e){const{anchorPosition:t,stemVector:n}=e.options,o=this.mattertagData.getTag(e.id),a=e.options.roomId&&this.roomIdMap.getRoomForId(e.options.roomId),s=a?a.floorId:o.floorId,i=t?o.anchorPosition.clone().set(t.x,t.y,t.z):o.anchorPosition,r=n?o.stemVector.clone().set(n.x,n.y,n.z):o.stemVector,c=n?r.length():o.stemHeight;r.normalize();const d={stemHeight:c},l={position:i,normal:r,floorId:s};await this.issueCommand(new this.cwfTypes.EditMattertagCommand(e.id,d,void 0,l))}throw(e){throw Error("Tag.editPosition: "+e)}}class Fi{constructor(e,t){this.cwfTypes=e,this.issueCommand=t.issueCommand}validateInput(e){const t=e.ids;return ft(t,ie)||this.throw("'ids' is expected to be a series of strings"),{ids:t}}async exec(e){const t=[];for(const n of e.ids)await this.issueCommand(new this.cwfTypes.CloseAnnotationCommand(n,na.TAG)),await this.issueCommand(new this.cwfTypes.RemoveMattertagCommand(n)),t.push(n);return t}throw(e){throw Error("Tag.remove: "+e)}}class Ui{constructor(e,t){this.mattertagData=e,this.mattertagMeshes=t}validateInput(e,t){return ie(e.id)||this.throw(oe("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),{id:e.id}}async exec(e,t){const{id:n}=e;this.mattertagMeshes.setOverrideMaterial(n,null,null)}throw(e){throw Error(`Tag.resetIcon: ${e}`)}}function Gi(e,t,n,o,a,s,i,r){const{mattertagData:c,mattertagMeshModule:d,meshData:l,floorData:h,pinViewData:p,annotationsViewData:m,tagsViewData:g,roomData:f,roomIdMap:w}=r;e.addEnumToInterface({namespace:"Tag",name:"AttachmentType",values:u.AttachmentType});const T=function(e,t){const n=Ye.create(t,new di,new F(li));return e.addCollectionToInterface({namespace:"Tag",name:"attachments"},n),n}(e,new pe(s)),I=function(e,t){const n=ne.create(t,new F(mi));return e.addAsyncCommandToInterface({namespace:"Tag",name:"registerAttachment",args:["srcs"],varArg:!0},n),n}(e,new pe(s)),y=function(e,t){const n=ne.create(t,new F(Ni));return e.addAsyncCommandToInterface({namespace:"Tag",name:"registerSandbox",args:["html","options"],subRoutine:"tag.registerSandbox"},n),n}(e,new pe(s,m,i)),E=function(e,t){const n=ne.create(t,new F(hi));return e.addAsyncCommandToInterface({namespace:"Tag",name:"attach",args:["tagId","attachmentIds"],varArg:!0},n),n}(e,new pe(c,s)),v=function(e,t){const n=ne.create(t,new F(ui));return e.addAsyncCommandToInterface({namespace:"Tag",name:"detach",args:["tagId","attachmentIds"],varArg:!0},n),n}(e,new pe(c,s)),C=function(e,t){const n=V.create(t,new Oi,new F(Mi));return e.addObservableToInterface({namespace:"Tag",name:"openTags"},n),n}(e,new pe(p,m)),A=function(e,t,n){const o=Ye.create(n,new gi,new F(fi,t));return e.addCollectionToInterface({namespace:"Tag",name:"data",elementFactory:"Tag.data"},o),o}(e,t,new pe(c,w,f,l)),S=function(e,t,n,o){const a=ne.create(o,new F(yi,Object.assign(Object.assign({},t),n)));return e.addAsyncCommandToInterface({namespace:"Tag",name:"open",args:["id","options"]},a),a}(e,n,o,new pe(c,g)),b=function(e,t,n,o){const a=ne.create(o,new F(Ei,Object.assign(Object.assign({},t),n)));return e.addAsyncCommandToInterface({namespace:"Tag",name:"dock",args:["id","options"]},a),a}(e,n,o,new pe(c,g)),D=function(e,t,n,o){const a=ne.create(o,new F(vi,Object.assign(Object.assign({},t),n)));return e.addAsyncCommandToInterface({namespace:"Tag",name:"close",args:["id"]},a),a}(e,n,o,new pe(c,g)),O=function(e,t,n,o){const a=ne.create(o,new F(Ri,t,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"allowAction",args:["id","allow"]},a),a}(e,n,o,new pe(p,g,m)),M=function(e,t,n,o){const a=ne.create(o,new F(Pi,t,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editBillboard",args:["id","properties"]},a),a}(e,n,o,new pe(c)),N=function(e,t,n,o,a){const s=ne.create(a,new F(Li,t,n,o));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editColor",args:["id","color"]},s),s}(e,t,n,o,new pe(c)),R=function(e,t,n){const o=ne.create(n,new F(xi,t));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editIcon",args:["id","iconId"]},o),o}(e,t,new pe(c,d,a)),P=function(e,t,n,o){const a=ne.create(o,new F(_i,t,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editOpacity",args:["id","opacity"]},a),a}(e,n,o,new pe(c,p)),L=function(e,t,n,o){const a=ne.create(o,new F(ki,t,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editStem",args:["id","stemParams"]},a),a}(e,n,o,new pe(c)),x=function(e,t,n,o){const a=ne.create(o,new F(Vi,t,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editPosition",args:["id","options"]},a),a}(e,n,o,new pe(c,w)),k=function(e,t,n,o){const a=ne.create(o,new F(Fi,t,n));return e.addAsyncCommandToInterface({namespace:"Tag",name:"remove",args:["ids"],varArg:!0},a),a}(e,n,o,new pe),_=function(e,t){const n=ne.create(t,new F(Ui));return e.addAsyncCommandToInterface({namespace:"Tag",name:"resetIcon",args:["id"]},n),n}(e,new pe(c,d));return{attachments:T,registerAttachment:I,registerSandbox:y,attach:E,detach:v,data:A,openTags:C,add:function(e,t,n,o,a){const s=ne.create(a,new F(Ti,t,n,o));return e.addAsyncCommandToInterface({namespace:"Tag",name:"add",args:["descriptors"],varArg:!0},s),s}(e,t,n,o,new pe(c,E,P,s,m,h,f,l)),open:S,dock:b,close:D,allowAction:O,editBillboard:M,editColor:N,editIcon:R,editOpacity:P,editStem:L,editPosition:x,remove:k,resetIcon:_}}class Hi{validateInput(e){if(!ie(e.arg0))throw Error(`Stat.test: arg0 was specified but was not a valid string; got ${e.arg0}`);return e}async exec(e,t){return e.arg0}}class zi{validateInput(e){return e}async exec(e,t){}}!function(e){e.ENUM1="test.enum1",e.ENUM2="test.enum2"}(Di||(Di={}));const Bi=new ee("Subscription");class ji{constructor(e,t,n=!1,o=""){this.startSubscription=e,this.endSubscription=t,this.id=o,this.isSubbed=!1,n&&this.renew()}renew(){this.isSubbed?Bi.debugWarn(`Duplicate subscription renew ${this.id}`):(this.startSubscription(),this.isSubbed=!0)}cancel(){this.isSubbed&&(this.endSubscription(),this.isSubbed=!1)}get active(){return this.isSubbed}}function Wi(e,t,n=!0,o=""){return new ji(e,t,n,o)}class qi{create(){return Wi((()=>{}),(()=>{}))}}class $i{constructor(){this._data={}}get data(){return this._data}isItemEqual(e,t){const n=this.data[t],o=e.data[t];return n.test===o.test}update(){}clear(){this._data={}}}class Ki{create(e){return Wi((()=>{}),(()=>{}))}}class Yi{constructor(){this._data={testString:"hello"}}get data(){return this._data}equals(e){return this._data.testString===e.data.testString}copy(e){this._data.testString=e.data.testString}update(){}}const Xi=new ee("sdk: tours");class Zi{constructor(e,t){this.tourControls=e,this.tourData=t}validateInput(e){return void 0!==e.index&&isNaN(e.index)&&(Xi.warn(e.index,"is not a valid number"),e.index=void 0),void 0!==e.steps&&isNaN(e.steps)&&(Xi.warn(e.steps,"is not a valid number"),e.steps=void 0),e}async exec(e,t){if(0===this.tourData.getSnapshotCount())throw Error("No tour data found");if(!this.tourControls.canChangeTourLocation())throw Error("TourStart ignored, cannot change location at this time, another transition is active");try{this.tourControls.startTour(e.index,e.steps,e.loop)}catch(e){throw Error(`Error occurred while starting tour - ${e}`)}}}class Qi{constructor(e){this.tourControls=e}validateInput(e){return e}async exec(e,t){try{await this.tourControls.stopTour()}catch(e){throw Error(`Error occurred while stopping tour - ${e}`)}}}class Ji{constructor(e,t){this.tourControls=e,this.tourData=t}validateInput(e){const t=e.index;if(!Et(t))throw Error(t+" is not a valid tour snapshot index");if(t<0||t>this.tourData.getSnapshotCount())throw Error(`${t} is outside of the range of tour snapshots: [0 , ${this.tourData.getSnapshotCount()-1}]`);return{index:t}}async exec(e,t){if(0===this.tourData.getSnapshotCount())throw Error("No tour data found");if(!this.tourControls.canChangeTourLocation())throw Error("TourStep ignored, cannot change location at this time, another transition is active");try{this.tourControls.tourGoTo(e.index)}catch(e){throw Error(`Error occurred while jumping to new tour location - ${e}`)}}}class er{constructor(e,t,n){this.forward=e,this.tourControls=t,this.tourData=n}validateInput(e){return e}async exec(e,t){if(0===this.tourData.getSnapshotCount())throw Error("No tour data found");if(!this.tourControls.canChangeTourLocation())throw Error("TourStep ignored, cannot change location at this time, another transition is active");try{this.forward?this.tourControls.tourGoNext(!1):this.tourControls.tourGoPrevious(!1)}catch(e){throw Error(`Error while trying to travel to the next tour snapshot - ${e}`)}}}function tr(e,t,n,o){!function(e,t,n){t.addBinding(nr,(async()=>n.getDependencies().then((async([n,o])=>{const a=await Promise.all(o.getEnabledSnapshots().map((n=>async function(e,t,n){const o=!e.is360,a=n.viewmodeConverter.toSdk(e.metadata.cameraMode,o);if(!a||a===n.commandModeConverter.toSdk(t.CommandViewmode.TRANSITIONING))throw Error("Failed to convert snapshot, invalid viewmode");return{sid:e.sid,thumbnailUrl:await e.thumbnailUrl.get(),imageUrl:await e.imageUrl.get(),is360:e.is360,name:e.name,mode:a,zoom:e.metadata.ssZoom,position:e.metadata.cameraPosition,rotation:n.conversionUtils.quaternionToRotation(e.metadata.cameraQuaternion)}}(n,e,t))));if(0===a.length)throw Error("No tour data found");return a}))))}(t,n,o),e.addCommandCreator({namespace:"Tour",name:"getData",args:[]},(()=>new nr));const a=o,s=ne.create(a,new F(Zi)),i=ne.create(a,new F(Qi)),r=ne.create(a,new F(Ji)),c=ne.create(a,new F(er,!0)),d=ne.create(a,new F(er,!1));e.addAsyncCommandToInterface({namespace:"Tour",name:"start",args:["index"]},s),e.addCommandToInterface({namespace:"Tour",name:"stop",args:[]},i),e.addCommandToInterface({namespace:"Tour",name:"step",args:["index"]},r),e.addCommandToInterface({namespace:"Tour",name:"prev",args:[]},c),e.addCommandToInterface({namespace:"Tour",name:"next",args:[]},d)}class nr extends j{constructor(){super(...arguments),this.id="GET_TOUR_DATA"}}class or{create(e,t){return t.onChanged((()=>e.onChanged()))}}class ar{constructor(){this._data={step:null}}get data(){return this._data}equals(e){return this._data.step===e.data.step}copy(e){this._data.step=e.data.step}update(e){var t;this._data.step=e.isTourActive()&&null!==(t=e.getTourCurrentSnapshotSid())&&void 0!==t?t:null}}class sr{create(e,t){return t.onChanged((()=>e.onChanged()))}}class ir{constructor(e){this._data={current:p.PlayState.INACTIVE},this.tourStateConverter=e.tourStateConverter}get data(){return this._data}equals(e){return this._data.current===e.data.current}copy(e){this._data.current=e.data.current}update(e){this._data.current=this.tourStateConverter.toSdkTourState(e.getTourState())}}class rr{constructor(e){this.toSdkTourStateMap={[e.Inactive]:p.PlayState.INACTIVE,[e.Active]:p.PlayState.ACTIVE,[e.StopScheduled]:p.PlayState.STOP_SCHEDULED}}toSdkTourState(e){return this.toSdkTourStateMap[e]}}class cr{create(e,t){return t.onChanged((()=>e.onChanged()))}}class dr{constructor(){this._data={from:null,to:null}}get data(){return this._data}equals(e){return this._data.from===e.data.from&&this._data.to===e.data.to}copy(e){this._data.from=e.data.from,this._data.to=e.data.to}update(e){const t=this.hasEnded;if(this.hasEnded=e.tourEnded,!t&&this.hasEnded)return this._data.from=null,void(this._data.to=null);const n=-1===e.tourCurrentSnapshot?null:e.getTourSnapshotSid(e.tourCurrentSnapshot),o=-1===e.transition.toIndex?null:e.getTourSnapshotSid(e.transition.toIndex);null!==o&&(n===o?(this._data.from=null,this._data.to=null):(this._data.from=n,this._data.to=o))}}class lr{create(e,t,n){const o=()=>e.onChanged();return new ve(n.onChanged(o),t.onChanged(o))}}class hr{constructor(e){this._data={from:null,to:null},this.viewmodeConverter=e.viewmodeConverter}get data(){return this._data}equals(e){return this._data.from===e._data.from&&this._data.to===e._data.to}copy(e){this._data={from:e._data.from,to:e._data.to}}update(e,t){const n=t.currentSweep&&t.isSweepAligned(t.currentSweep),o=t.transition.to&&t.isSweepAligned(t.transition.to);this._data=e.transition.active?{from:this.viewmodeConverter.toSdk(e.transition.from,!!n),to:this.viewmodeConverter.toSdk(e.transition.to,!!o)}:{from:null,to:null}}}class ur{create(e,t){return t.onChanged((()=>e.onChanged()))}}class pr{constructor(e){this.pluginData=e,this._data={}}get data(){return this._data}isItemEqual(e,t){const n=this.data[t],o=e.data[t];return n.applicationKey===o.applicationKey&&n.id===o.id}update(){for(const e of this.pluginData.plugins.entries())this._data[e[0]]={applicationKey:e[1].applicationKey,id:e[1].id};for(const e in this.data)this.pluginData.plugins.has(e)||delete this._data[e]}clear(){this._data={}}}function mr(o,l,u,g,f,w){const{THREE:T}=l,{appPhaseModule:E,applicationData:v,cameraData:U,canvasData:G,deepLinks:H,floorData:j,floorViewData:$,labelData:K,mattertagData:Y,mattertagViewData:X,measurementModeData:Z,meshData:Q,modelData:J,annotationsViewData:ee,raycasterData:te,roomData:oe,settingsData:ae,sweepData:ie,sweepViewData:re,tourData:ce,viewmodeData:de,commonControlsModule:le,floorCasterModule:he,mattertagDataModule:ue,mattertagMeshModule:ve,mattertagViewDataModule:Ce,meshQuery:Ae,modelDataModule:Se,modelMeshModule:be,navigationModule:De,plugin:Oe,renderToTextureModule:Me,sceneModule:Ne,sensorModule:_e,settingsModule:Ve,tourControlsModule:Fe,webglRendererModule:Ue,zoomControlModule:Be,sweepTextureLoader:ct,cursorController:lt,pluginData:gt,externalR3FModule:ft}=f;w.idOption=w.idOption||y.LEGACY;const vt=new D(T),Ct=new A(u.Viewmode),At=function(e){return async function(t,n){const o=n.rotationSpeed;let a=0;const s=Math.abs(n.xAngle),i=Math.abs(n.yAngle),r=Math.max(s,i);if(r>=Math.PI){const e=r/Math.PI,t=Math.floor(e),n=s/e,o=i/e,c=s-n*t,d=i-o*t;a=Math.acos(Math.cos(n)*Math.cos(o))*t+Math.acos(Math.cos(c)*Math.cos(d))}else a=Math.acos(Math.cos(Math.abs(n.xAngle))*Math.cos(Math.abs(n.yAngle)));if(a){const s=new e.Vector2(-n.xAngle,n.yAngle);return s.multiplyScalar(o/a),t.startRotateTransition(a/o,s,!1)}}}(T),St=new Zs(u.SweepAlignmentType,u.SweepPlacementType),bt=Object.assign(Object.assign({},g),{conversionUtils:new D(T),directionConverter:new C(u.Vectors),getPose:qe(T,Ct),rotateCamera:At,orientCamera:xe(T,u.Viewmode,At),appPhaseConverter:new k(u.AppPhase),applicationConverter:new _(u.Application),mediaConverter:new Tt(u.MattertagMediaType,u.TagDescriptionChunkType),chunkTypeConverter:new It(u.TagDescriptionChunkType),linkTypeConverter:new yt(u.TagLinkType),sweepPlacementConverter:St,viewmodeConverter:Ct,commandModeConverter:new S(u.CommandViewmode),cameraTransitionConverter:new b(u.CameraTransitionType),makeLabelData:ot(T,g.worldToScreenPosition),makeModelData:Oa(vt,St),sweepUtils:new O(u.SweepAlignmentType),tourStateConverter:new rr(u.TourState)}),Ot=async function(e,t){const n=await e;return t===y.LEGACY?new M(n):new N(n)}(ie,w.idOption),Nt=async function(e,t){const n=await e;return t===y.LEGACY?new R(n):new P(n)}(j,w.idOption),Rt=async function(e,t,n){const o=await e,a=await t;return n===y.LEGACY?new L(o,a):new x(o)}(oe,j,w.idOption),jt=async function(e,t){const n=await e;return new qo(n,t)}(Y,l.oEmbed),qt=new Map;var $t;($t=o).addEnumToInterface({namespace:"App",name:"Phase",values:e.Phase}),$t.addEnumToInterface({namespace:"App",name:"Event",values:e.Event}),$t.addEnumToInterface({namespace:"App",name:"Application",values:e.Application}),function(t,n,o){const a=[void 0],s=e=>(a[0]=o.appPhaseConverter.toSdkAppPhase(e.phase),a);o.subscribe(n.AppPhaseChangeMessage,(n=>{t.broadcast(e.Event.PHASE_CHANGE,s,n)}))}(o,u,bt),function(e,t,n){n.getDependencies().then((([e])=>{t.addBinding(W,(async()=>{try{const n=e.getData();return{phase:t.appPhaseConverter.toSdkAppPhase(n.phase),application:t.applicationConverter.toSdkApplication(n.application)}}catch(e){throw Error("Error: Can't get application data at this time")}}))})),e.addCommandCreator({namespace:"App",name:"getState",args:[]},(()=>new W))}(o,bt,new pe(E)),function(t,n,o){n.addBinding(q,(async()=>{const t={[e.Phase.WAITING]:null,[e.Phase.LOADING]:null,[e.Phase.STARTING]:null,[e.Phase.PLAYING]:null,[e.Phase.ERROR]:null},[a]=await o.getDependencies();for(const e in a.phaseTimes){const o=Number(e);t[n.appPhaseConverter.toSdkAppPhase(o)]=a.phaseTimes[o]}return t})),t.addCommandCreator({namespace:"App",name:"getLoadTimes",args:[]},(()=>new q))}(o,bt,new pe(v)),function(e,t,n,o){const a=V.create(o,new z,new F(B,t,n));e.addObservableToInterface({namespace:"App",name:"state"},a)}(o,u,bt,new pe(v));const Kt=me(o,T,bt,{iconMaps:qt});!function(e,t,n){n.getDependencies().then((([e,n,o,a])=>{const s={position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:r.Mode.TRANSITIONING};t.addBinding(ge,(async()=>t.getPose(s,e,n,o,a)))})),e.addCommandCreator({namespace:"Camera",name:"getPose",args:[]},(()=>new ge))}(o,bt,new pe(U,ie,de,Ot)),function(e,t,n,o){o.getDependencies().then((([e,o,a])=>{n.addBinding(we,(async function(s={}){if(!a.isInside())throw Error("Camera.lookAtScreenCoords must be called from Inside mode");const i=n.screenPositionToNDC(s.x,s.y,o.width,o.height),r=new t.Vector3(0,0,-1).applyQuaternion(o.pose.rotation),c=n.ndcToWorldPosition(o,new t.Vector2(i.x,i.y),1).normalize(),d=r.clone().setY(0).angleTo(c.clone().setY(0)),l=Math.asin(c.y-r.y),h=d*Math.sign(i.x),u=l;return n.rotateCamera(e,{xAngle:h,yAngle:u,zAngle:0,rotationSpeed:fe})}))})),e.addCommandCreator({namespace:"Camera",name:"lookAtScreenCoords",args:["x","y"]},(function(e={}){if(e.x=e.x||0,e.y=e.y||0,isNaN(e.x)||isNaN(e.y))throw new Error(`${JSON.stringify(e)} does not contain valid screen coordinates`);return new we({x:e.x,y:e.y})}))}(o,T,bt,new pe(le,U,de)),function(e,n,o){o.getDependencies().then((([o,a,s,i])=>{const c=[{position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:r.Mode.TRANSITIONING}],d=(()=>{let r=0,l=!1;const h=()=>(n.getPose(c[0],o,a,s,i),c);return()=>{const n=Date.now(),o=r+100;if(n>o){l=!1,r=n;try{e.broadcast(t.Event.MOVE,h)}catch(e){Te.debug("failed to broadcast pose, one of the module dependencies are probably not loaded yet")}}else l||(setTimeout((()=>d()),o-n),l=!0)}})();o.onChanged(d),s.onChanged(d)})),e.addEnumToInterface({namespace:"Camera",name:"Event",values:t.Event})}(o,bt,new pe(U,ie,de,Ot)),function(e,n,o){o.getDependencies().then((([e])=>n.addBinding(ye,(async o=>{const a=o.direction;if(!Ie(t.Direction,o.direction))throw new Error(`${o.direction} is not a valid direction`);await e.navigateInLocalDirection(n.directionConverter.toVector(a))})))),e.addEnumToInterface({namespace:"Camera",name:"Direction",values:t.Direction}),e.addCommandCreator({namespace:"Camera",name:"moveInDirection",args:["direction"]},(e=>new ye(e||{})))}(o,bt,new pe(De)),function(e,t,n,o){o.getDependencies().then((([e,o])=>{n.addBinding(Ee,(async n=>{const a=o.pose.position,s=n.x-a.x,i=n.z-a.z,r=new t.Vector2(s,i),c=r.length();r.setLength(.005),await e.startTranslateTransition(c/.005,r,!1)}))})),e.addCommandCreator({namespace:"Camera",name:"pan",args:["position"]},(e=>{if((e=e||{}).position=e.position||{},e.position.x=e.position.x-0,e.position.z=e.position.z-0,isNaN(e.position.x)||isNaN(e.position.z))throw new Error(`${JSON.stringify(e)} does not contain a valid position to pan`);return new Ee({x:e.position.x,z:e.position.z})}))}(o,T,bt,new pe(le,U)),function(e,t,n,o){const a=V.create(o,new Re,new F(Pe,t,n.viewmodeConverter));e.addObservableToInterface({namespace:"Camera",name:"pose"},a)}(o,T,bt,new pe(U,ie,de,Ot)),function(e,t,n,o){const a=t.MathUtils.degToRad(80)/1e3;o.getDependencies().then((([e,t,o])=>{n.addBinding(Le,(async t=>await n.rotateCamera(e,t))),n.addBinding(ke,(async a=>await n.orientCamera(t,e,o,a)))}));const s=e=>{const n=(e=e||{}).options||{},o=t.MathUtils.degToRad(e.xAngle||0),s=t.MathUtils.degToRad(e.yAngle||0),i=t.MathUtils.degToRad(e.zAngle||0);let r=a;if(n.speed){if(isNaN(n.speed)||n.speed<=0)throw new Error(`${JSON.stringify(n)} does not contain valid rotation speed`);r=t.MathUtils.degToRad(n.speed)/1e3}if(isNaN(o)||isNaN(s)||isNaN(i))throw new Error(`${JSON.stringify(e)} does not contain valid rotation angles`);return{xAngle:o,yAngle:s,zAngle:i,rotationSpeed:r}};e.addCommandCreator({namespace:"Camera",name:"rotate",args:["xAngle","yAngle","options"]},(e=>new Le(s(e)))),e.addCommandCreator({namespace:"Camera",name:"setRotation",args:["rotation","options"]},(e=>{const t=(e=e||{}).rotation||{};return new ke(s({xAngle:t.x,yAngle:t.y,zAngle:t.z,options:e.options}))}))}(o,T,bt,new pe(le,U,de)),function(e,t,n,o){const a=o,s=ne.create(a,new F(Ge,t,n)),i=ne.create(a,new F(He,t,n)),r=ne.create(a,new F(ze,t,n));e.addCommandToInterface({namespace:"Camera",name:"zoomTo",args:["zoomPct"]},s),e.addCommandToInterface({namespace:"Camera",name:"zoomBy",args:["zoomDelta"]},i),e.addCommandToInterface({namespace:"Camera",name:"zoomReset",args:[]},r)}(o,u,bt,new pe(U,de,Be)),function(e,t,n){const o=V.create(n,new je,new F(We,t));e.addObservableToInterface({namespace:"Camera",name:"zoom"},o)}(o,u,new pe(U,de)),function(e,t,n){const o=V.create(n,new $e,new F(Ke,t));e.addObservableToInterface({namespace:"Floor",name:"current"},o)}(o,u,new pe($,ie,U,Nt)),function(e,t,o,a){e.addEnumToInterface({namespace:"Floor",name:"Event",values:n.Event}),a.getDependencies().then((([a])=>{const s=[-1,-1];function i(e){if(a){const t=e.to?a.getFloor(e.to):null,n=e.from?a.getFloor(e.from):null;t&&(s[0]=t.index),n&&(s[1]=n.index)}return s}const r=[-1,""];function c(e){if(a){const t=e.floorId?a.getFloor(e.floorId):null;t&&(r[0]=t.index)}return r[1]=e.floorName,r}o.subscribe(t.StartMoveToFloorMessage,(t=>e.broadcast(n.Event.CHANGE_START,i,t))),o.subscribe(t.EndMoveToFloorMessage,(t=>e.broadcast(n.Event.CHANGE_END,c,t)))}))}(o,u,bt,new pe(j)),function(e,t){const n=Ye.create(t,new Xe,new F(Ze));e.addCollectionToInterface({namespace:"Floor",name:"data"},n)}(o,new pe(j,Nt)),function(e,t,n){t.addBinding(Qe,(async()=>{const[e]=await n.getDependencies();return Je(e)})),e.addCommandCreator({namespace:"Floor",name:"getData",args:[]},(()=>new Qe))}(o,bt,new pe($)),function(e,t,n,o){o.getDependencies().then((([e])=>n.addBinding(et,(async o=>{if("number"!=typeof o.floorIndex||o.floorIndex<0)throw Error("floor index must be a non-negative number");try{const a="boolean"==typeof o.moveCamera&&!o.moveCamera,s=a?250:void 0;await n.issueCommand(new t.MoveToFloorIndexCommand(o.floorIndex,a,s));const i=e.currentFloor;return i?i.index:-1}catch(e){throw Error(`Could not move to floor at index ${o.floorIndex}`)}})))),e.addCommandCreator({namespace:"Floor",name:"moveTo",args:["floorIndex","moveCamera"]},(e=>new et(e)))}(o,u,bt,new pe($)),function(e,t,n,o){const a=ne.create(o,new F(tt,t,n));e.addCommandToInterface({namespace:"Floor",name:"showAll",args:["moveCamera"]},a)}(o,u,bt,new pe($)),function(e,t,n){t.addBinding(nt,(async()=>t.makeLabelData(...await n.getDependencies()))),e.addCommandCreator({namespace:"Label",name:"getData",args:[]},(()=>new nt))}(o,bt,new pe(U,j,K,Nt)),function(e,t,n,o){e.addEnumToInterface({namespace:"Label",name:"Event",values:a.Event}),o.getDependencies().then((([o,s,i,r,c])=>{const d=()=>[n.makeLabelData(o,i,s,c)];o.onChanged((n=>{r.currentMode===t.Viewmode.Floorplan&&e.broadcast(a.Event.POSITION_UPDATED,d,n)}))}))}(o,u,bt,new pe(U,K,j,de,Nt)),function(e,t){const n=Ye.create(t,new at,new F(st));e.addCollectionToInterface({namespace:"Label",name:"data"},n)}(o,new pe(K,j,Nt)),function(e,t){const n=ne.create(t,new F(it));e.addAsyncCommandToInterface({namespace:"Link",name:"createLink",args:[]},n)}(o,new pe(H)),function(e,t){const n=ne.create(t,new F(rt));e.addAsyncCommandToInterface({namespace:"Link",name:"createDeepLink",args:[]},n)}(o,new pe(H)),function(e,t){const n=ne.create(t,new F(ht,e)),o=ne.create(t,new F(ut,e)),a=ne.create(t,new F(pt,e)),i=ne.create(t,new F(mt,e));e.addEnumToInterface({namespace:"Link",name:"OpenPolicy",values:s.OpenPolicy}),e.addAsyncCommandToInterface({namespace:"Link",name:"setModelLinkPolicy",args:["policy","baseHref"],subRoutine:"link.setopenpolicy"},n),e.addAsyncCommandToInterface({namespace:"Link",name:"setNavigationLinkPolicy",args:["policy","baseHref"],subRoutine:"link.setopenpolicy"},o),e.addAsyncCommandToInterface({namespace:"Link",name:"setSameOriginLinkPolicy",args:["policy"]},a),e.addAsyncCommandToInterface({namespace:"Link",name:"setExternalLinkPolicy",args:["openInNewWindow"]},i)}(o,new pe(H)),function(e,t){const n=ne.create(t,new F(wt));e.addEnumToInterface({namespace:"Link",name:"CreationPolicy",values:s.CreationPolicy}),e.addAsyncCommandToInterface({namespace:"Link",name:"setShareLinkPolicy",args:["policy","baseHref","options"],subRoutine:"link.setsharepolicy"},n)}(o,new pe(H));const Zt=async function(){const e=w.sandboxPath;return(await fetch(e)).text()}();if(w.useNewTags){const e=Gi(o,T,u,bt,qt,jt,Zt,Object.assign(Object.assign({},f),{roomIdMap:Rt}));ra(o,u,Object.assign(Object.assign({},bt),{getIframeSrcDoc:Zt}),Kt,e,[Y,ee,j,Nt,jt])}else{!function(e){e.addEnumToInterface({namespace:"Mattertag",name:"DescriptionChunkType",values:i.DescriptionChunkType}),e.addEnumToInterface({namespace:"Mattertag",name:"Event",values:i.Event}),e.addEnumToInterface({namespace:"Mattertag",name:"LinkType",values:i.LinkType}),e.addEnumToInterface({namespace:"Mattertag",name:"MediaType",values:i.MediaType}),e.addEnumToInterface({namespace:"Mattertag",name:"Transition",values:I})}(o);const e=function(e,t,n,o,a){const s=ne.create(a,new F(kt,t,o)),i=ne.create(a,new F(_t,t,o));return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"registerIcon",args:["textureId","textureSrc"]},n.registerTexture),e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editIcon",args:["tagId","iconId"]},s),e.addAsyncCommandToInterface({namespace:"Mattertag",name:"resetIcon",args:["tagId"]},i),{editIcon:s}}(o,T,Kt,bt.loadImage,new pe(qt,ve,Y));Pt(o,T,u,bt,new pe(j,oe,Q,ue,e.editIcon)),function(e,t,n,o){n.addBinding(Lt,(async()=>o.getDependencies().then((([e,t,o])=>{try{const a=[];return e.iterate((e=>{const{id:s,index:i}=t.getFloor(e.floorId),r=o.getIdFromCwfId(s),c=e.mediaSrc,d=n.mediaConverter.fromTagChunkType(e.mediaType);a.push({sid:e.sid,label:e.label,description:e.description,parsedDescription:xt(e.parsedDescription,n.chunkTypeConverter,n.linkTypeConverter),mediaSrc:c,mediaType:d,media:{type:d,src:c},anchorPosition:{x:e.anchorPosition.x,y:e.anchorPosition.y,z:e.anchorPosition.z},anchorNormal:{x:e.anchorNormal.x,y:e.anchorNormal.y,z:e.anchorNormal.z},color:{r:e.color.r,g:e.color.g,b:e.color.b},enabled:e.enabled,floorId:i,floorIndex:i,floorInfo:{id:r,sequence:i},stemVector:{x:e.stemVector.x,y:e.stemVector.y,z:e.stemVector.z},stemHeight:e.stemHeight,stemVisible:e.stemVisible})})),a}catch(e){throw Error("problem getting tag data")}})))),e.addCommandCreator({namespace:"Mattertag",name:"getData",args:[]},(()=>new Lt))}(o,0,bt,new pe(Y,j,Nt)),function(e,t,n,o,a){const s={[i.MediaType.NONE]:n.TagDescriptionChunkType.none,[i.MediaType.PHOTO]:n.TagDescriptionChunkType.photo,[i.MediaType.VIDEO]:n.TagDescriptionChunkType.video,[i.MediaType.RICH]:n.TagDescriptionChunkType.rich};a.getDependencies().then((()=>{o.addBinding(Ht,(async e=>{const t=e.tagId;if(!Vt(t))throw new Ft(t);if(!e.properties)return;const a=e.properties[Gt.LABEL],r=e.properties[Gt.MEDIA],c=e.properties[Gt.DESCRIPTION];if(null!=a&&"string"!=typeof a)throw Error("Mattertag.editBillboard only accepts a string for the title field");if(null!=c&&"string"!=typeof c)throw Error("Mattertag.editBillboard only accepts a string for the description field");if(null!=r){if("string"!=typeof r.src)throw Error("Mattertag.editBillboard only accepts a string for the media.src field");if(!Ie(i.MediaType,r.type))throw Error("Mattertag.editBillboard only accepts a value from Mattertag.MediaType for the media.type field")}let d;r&&(d={mediaType:s[r.type],mediaSrc:r.src});const l={label:a,description:c};await o.issueCommand(new n.EditMattertagCommand(e.tagId,l,d))})),o.addBinding(zt,(async e=>{const a=e.color;if(null!=a&&!Dt(a,Ut))throw Error("Mattertag.editColor only accepts a Color object of the form {r, g, b} for the color field");const s={color:(new t.Color).setRGB(a.r,a.g,a.b)};await o.issueCommand(new n.EditMattertagCommand(e.tagId,s))})),o.addBinding(Bt,(async e=>{const t=e.stemHeight,a=e.stemVisible;if(null!=t&&!Et(t))throw Error("Mattertag.editStem only accepts a numeric value for stemHeight");if(null!=a&&!dt(a))throw Error("Mattertag.editStem only accepts a boolean value for stemVisible");const s={};void 0!==t&&(s.stemHeight=t),void 0!==a&&(s.stemVisible=a),await o.issueCommand(new n.EditMattertagCommand(e.tagId,s))}))})),e.addCommandCreator({namespace:"Mattertag",name:"editBillboard",args:["tag","values"]},(e=>new Ht(e.tag,e.values))),e.addCommandCreator({namespace:"Mattertag",name:"editColor",args:["tag","color"]},(e=>new zt(e.tag,e.color))),e.addCommandCreator({namespace:"Mattertag",name:"editStem",args:["tag","stemParams"]},(e=>new Bt(e.tag,e.stemParams)))}(o,T,u,bt,new pe(Y)),function(e,t){const n=ne.create(t,new F(Wt));e.addCommandToInterface({namespace:"Mattertag",name:"editOpacity",args:["sid","opacity"]},n)}(o,new pe(Y,ve)),function(e,t,n){const o=Ye.create(n,new Yt,new F(Xt,t));e.addCollectionToInterface({namespace:"Mattertag",name:"data"},o)}(o,bt,new pe(Y,j,Nt)),function(e,t){const n=ne.create(t,new F(en));e.addCommandToInterface(Object.assign({},nn),n)}(o,new pe(Y,Zt)),function(e,t,n,o){let a;e.addCommandCreator({namespace:"Mattertag",name:"editPosition",args:["sid","options"]},(e=>{if(!a)throw Error("Edit command not bound yet");return a(e)}));const s=new t.Vector3,i=new t.Vector3;o.getDependencies().then((function([e,t,o,r]){a=({sid:a,options:c})=>{const{stemVector:d,anchorPosition:l}=c,h={};if(!Vt(a))throw new Ft(a);const u=e.getTag(a);if(!u)throw Error(`${a} was not found in the mattertag data`);if(l&&(!Et(l.x)||!Et(l.y)||!Et(l.z)))throw Error(`${l} is not a valid Vector3`);if(d&&(!Et(d.x)||!Et(d.y)||!Et(d.z)))throw Error(`${d} is not a valid Vector3`);let p=t.getFloor(u.floorId);i.copy(u.anchorPosition),s.copy(u.anchorNormal),d&&(s.set(d.x,d.y,d.z),h.stemHeight=s.length(),s.normalize()),l&&(i.set(l.x,l.y,l.z),p=t.getFloorAtIndex(Mt(i,t,o,r)));const m=void 0!==c.floorIndex?c.floorIndex:c.floorId;if(void 0!==m&&(p=t.getFloorAtIndex(m)),!p)throw new Error(`Could not move Mattertag to invalid floor with index: ${m}`);return new n.EditMattertagCommand(a,h,void 0,{floorId:p.id,normal:s,position:i})}}))}(o,T,u,new pe(Y,j,oe,Q)),function(e,t,n){e.addCommandCreator({namespace:"Mattertag",name:"navigateToTag",args:["sid","transitionType"]},(e=>{const o=e.transitionType?n.cameraTransitionConverter.fromSdkTransition(e.transitionType):t.CameraTransitionType.Interpolate;return new on(e.sid,o)})),n.addBinding(on,(async e=>{try{return await n.issueCommand(new t.NavigateToMattertagCommand(e.sid,e.transition)),e.sid}catch(t){throw Error(`Could not move to tag with sid ${e.sid}`)}}))}(o,u,bt),function(e,t){const n=ne.create(t,new F(an));e.addCommandToInterface({namespace:"Mattertag",name:"preventAction",args:["sid","prevent"]},n)}(o,new pe(X)),function(e,t,n){e.addCommandCreator({namespace:"Mattertag",name:"remove",args:["tags"]},(function(e){const n=[];if(!e.tags)throw Error("invalid list of tags to remove");if(Array.isArray(e.tags)){const o=e.tags,a=o.length;n.length=a;for(let e=0;e<a;++e)n[e]=new t.RemoveMattertagCommand(o[e])}else n.push(new t.RemoveMattertagCommand(e.tags));return new sn(n)})),n.addBinding(sn,(async e=>{const t=[],o=e.removeCommands;for(const e of o){const o=await n.issueCommand(e);o&&t.push(o)}return t}))}(o,u,bt),rn(o,u,bt),function(e,t,n,o){o.getDependencies().then((([o])=>{const a=["",""],s=e=>(a[0]=o.openTag,a[1]=e.url,a);n.subscribe(t.MattertagLinkOpenedMessage,(t=>{e.broadcast(i.Event.LINK_OPEN,s,t)}))}))}(o,u,bt,new pe(X)),function(e,t,n){e.addCommandCreator({namespace:"Mattertag",name:"closeBillboards",args:["tag"]},(e=>new dn(e.tag))),n.getDependencies().then((([e])=>{t.addBinding(cn,(async t=>{const n=t.tag;if(!Vt(n))throw new Ft(n);e.openBillboard(n)}))})),n.getDependencies().then((([e])=>{t.addBinding(dn,(async t=>{const n=t.tag;if(!Vt(n))throw new Ft(n);e.closeBillboard(t.tag)}))}))}(o,bt,new pe(Ce))}!function(e,t,n){t.addBinding(da,(async()=>{const[e,t]=await n.getDependencies();return la(e,t)})),e.addCommandCreator({namespace:"Measurements",name:"getData",args:[]},(()=>new da))}(o,bt,new pe(Z,j)),function(e,t,n){const o=Ye.create(n,new ha(t.MeasuringPhase),new F(ua));e.addCollectionToInterface({namespace:"Measurements",name:"data"},o)}(o,u,new pe(Z)),function(e,t){const n=V.create(t,new pa,new F(ma));e.addObservableToInterface({namespace:"Measurements",name:"mode"},n)}(o,new pe(Z)),function(e,t,n){n.addBinding(ga,(async e=>n.issueCommand(new t.ToggleToolCommand(t.Tools.MEASUREMENTS,e.active)))),e.addCommandCreator({namespace:"Measurements",name:"toggleMode",args:["active"]},(e=>new ga(e.active)))}(o,u,bt),function(e,t,n,o){e.addEnumToInterface({namespace:"Mode",name:"Event",values:r.Event}),o.getDependencies().then((([o,a])=>{const s=[void 0,void 0],i=e=>{const t=a.currentMode,i=n.sweepUtils.isSweepAligned(o,e.fromSweep),r=n.sweepUtils.isSweepAligned(o,e.toSweep);return s[0]=n.viewmodeConverter.toSdk(t,i),s[1]=n.viewmodeConverter.toSdk(t,r),s};n.subscribe(t.EndMoveToSweepMessage,(t=>{n.sweepUtils.isSweepAligned(o,t.fromSweep)!==n.sweepUtils.isSweepAligned(o,t.toSweep)&&e.broadcast(r.Event.CHANGE_END,i,t)}));const c=[void 0,void 0],d=e=>{const t=n.sweepUtils.isCurrentSweepAligned(o);return c[0]=n.viewmodeConverter.toSdk(e.fromMode,t),c[1]=n.viewmodeConverter.toSdk(e.toMode,t),c};n.subscribe(t.BeginSwitchViewmodeMessage,(t=>e.broadcast(r.Event.CHANGE_START,d,t)));const l=[void 0,void 0],h=e=>{const t=n.sweepUtils.isCurrentSweepAligned(o);return l[0]=n.viewmodeConverter.toSdk(e.fromMode,t),l[1]=n.viewmodeConverter.toSdk(e.toMode,t),l};n.subscribe(t.EndSwitchViewmodeMessage,(t=>e.broadcast(r.Event.CHANGE_END,h,t)))}))}(o,u,bt,new pe(ie,de)),function(e,t,n,o,a){o.addBinding(ya,(async e=>{try{e.options=e.options||{};let t=n.CameraTransitionType.Interpolate;const a=e.options.transition;return void 0===a||isNaN(a)||(t=a),await o.issueCommand(new n.ChangeViewmodeCommand(e.mode,t,{position:e.options.position,rotation:e.options.rotation,zoom:e.options.zoom})),e.mode}catch(t){const n=t instanceof Ta?`Mode.moveTo -> Cannot move to ${e.mode} during a mode transition`:`Mode.moveTo -> Could not move to ${e.mode}`;if(Ia.info(t,n),t instanceof Ta)throw Error(`Mode.moveTo -> Cannot move to ${e.mode} during a mode transition`);throw Error(`Mode.moveTo -> Could not move to ${e.mode}`)}}));const s=new Ea(t,n.CommandViewmode,o.conversionUtils,o.cameraTransitionConverter);e.addCommandCreator({namespace:"Mode",name:"moveTo",args:["mode","options"]},(e=>new ya(s.validateMoveToModeInput(e)))),e.addEnumToInterface({namespace:"Mode",name:"Mode",values:n.CommandViewmode}),e.addEnumToInterface({namespace:"Mode",name:"TransitionType",values:I})}(o,T,u,bt,new pe),function(e,t,n,o){const a=V.create(o,new va,new F(Ca,t,n));e.addObservableToInterface({namespace:"Mode",name:"current"},a)}(o,u,bt,new pe(de,ie)),function(e,t,n){const o=V.create(n,new lr,new F(hr,t));e.addObservableToInterface({namespace:"Mode",name:"transition"},o)}(o,bt,new pe(de,ie)),Sa(o,bt,new pe(J,ie,j,Ot)),Da(o,u,bt,new pe(J,ae)),function(e,t,n,o){e.addEnumToInterface({namespace:"Model",name:"Event",values:c.Event});const a={sid:"",sweeps:[],modelSupportsVr:!1},s=[a];o.getDependencies().then((o=>{n.subscribe(t.ModelDataLoadedMessage,(async t=>{const[i,r,d]=o;await n.makeModelData(t.sid,t.vrSupported,i.getSweepList(),r,d,a),e.broadcast(c.Event.MODEL_LOADED,(()=>s))}))}))}(o,u,bt,new pe(ie,j,Ot)),function(e,t){const n=ne.create(t,new F(Ma));e.addCommand("OAuth.updateToken",n)}(o,new pe(u.MpSdkAuthentication)),function(e,t){const n=Ye.create(t,new ur,new F(pr));e.addCollectionToInterface({namespace:"Plugin",name:"data",sdkTypes:[Na.POSTMESSAGE],origins:Ra},n)}(o,new pe(gt)),function(e,t){const n=ne.create(t,new F(Pa));e.addAsyncCommandToInterface({namespace:"Plugin",name:"load",args:["key","path","config"],varArg:!1,sdkTypes:[Na.POSTMESSAGE],origins:Ra},n)}(o,new pe(Oe)),function(e,t){const n=ne.create(t,new F(La));e.addAsyncCommandToInterface({namespace:"Plugin",name:"unload",args:["key"],varArg:!1,sdkTypes:[Na.POSTMESSAGE],origins:Ra},n)}(o,new pe(Oe)),function(e,t,n,o){const a=V.create(o,new xa,new F(ka,t,n));e.addEnumToInterface({namespace:"Pointer",name:"Colliders",values:d.Colliders}),e.addObservableToInterface({namespace:"Pointer",name:"intersection"},a)}(o,T,u,new pe(te,j,oe,Q,Ae)),function(e,t,n){const o=ne.create(n,new F(_a)),a=ne.create(n,new F(Va));e.addCommandToInterface({namespace:"Pointer",name:"registerTexture",args:["textureId","textureSrc"],varArg:!1},t),e.addCommandToInterface({namespace:"Pointer",name:"editTexture",args:["textureId"],varArg:!1},o),e.addCommandToInterface({namespace:"Pointer",name:"resetTexture",args:[],varArg:!1},a)}(o,Kt.registerTexture,new pe(lt,qt)),function(e,t){const n=ne.create(t,new F(Fa));e.addCommandToInterface({namespace:"Pointer",name:"setFadeProps",args:["props"],varArg:!1},n)}(o,new pe(lt)),function(e,t){const n=ne.create(t,new F(Ua));e.addCommandToInterface({namespace:"Pointer",name:"setVisible",args:["visible"],varArg:!1},n)}(o,new pe(lt)),function(e,t,n,o,a){const s=new $a(new t.Camera,o.encodeRenderTarget),i=new F(Qa,s,n,o),r=ne.create(a,i),c=ne.create(a,se(i,"`Camera.takeScreenshot` is deprecated; use `Renderer.takeScreenshot` instead"));e.addCommandToInterface({namespace:"Renderer",name:"takeScreenShot",args:["resolution","visibleObjects","returnType"]},r),e.addCommandToInterface({namespace:"Camera",name:"takeScreenShot",args:["resolution","visibleObjects","returnType"]},c)}(o,T,u,bt,new pe(G,Ue,Me)),function(e,t,n,o,a){const s=ne.create(a,new F(Ja,t,n,o));e.addCommandToInterface({namespace:"Renderer",name:"takeEquirectangular",args:[]},s)}(o,T,u,bt,new pe(Ue,Me,de,ie,ct)),function(e,t,n,o){const a=ne.create(o,new F(es,t,n));e.addCommandToInterface({namespace:"Renderer",name:"getScreenPosition",args:["worldPosition"]},a)}(o,u,bt,new pe(Ue)),function(e,t,n,o){const a=ne.create(o,new F(ts,t,n));e.addCommandToInterface({namespace:"Renderer",name:"getWorldPositionData",args:["screenPosition","height","includeHiddenFloors"]},a)}(o,u,bt,new pe(j,he)),function(e,t){const n=ne.create(t,new F(Ga));e.addAsyncCommandToInterface({namespace:"R3F",name:"registerR3F",args:["callbacks"],sdkTypes:[Na.DIRECT]},n)}(o,new pe(ft)),function(e,t,n,o,a){e.addAsyncCommandToInterface({namespace:"R3F",name:"focus",args:["target","options"],sdkTypes:[Na.DIRECT]},ne.create(a,new F(Ba,t,n,o)))}(o,T,u,bt,new pe(De,de)),function(e,t){const n=ne.create(t,new F(Wa));e.addAsyncCommandToInterface({namespace:"R3F",name:"controlsToggle",args:["enabled"],sdkTypes:[Na.DIRECT]},n)}(o,new pe(le)),function(e,t){const n=ne.create(t,new F(za));e.addAsyncCommandToInterface({namespace:"R3F",name:"navigationToggle",args:["enabled"],sdkTypes:[Na.DIRECT]},n)}(o,new pe(De)),function(e,t){const n=V.create(t,new ns,new F(os));e.addObservableToInterface({namespace:"Room",name:"current",objectFactory:"current.room"},n)}(o,new pe(oe,j,U,ie,de,Q,Rt,Nt)),function(e,t){const n=Ye.create(t,new as,new F(ss));e.addCollectionToInterface({namespace:"Room",name:"data",elementFactory:"collection.room"},n)}(o,new pe(oe,j,Rt,Nt,Q)),function(e,t,n,o,a,s,i){(function(e){e.addEnumToInterface({namespace:"Scene",name:"InteractionType",values:m.InteractionType,sdkTypes:[Na.DIRECT]}),e.addEnumToInterface({namespace:"Scene",name:"Component",values:m.Component,sdkTypes:[Na.DIRECT]}),e.addEnumToInterface({namespace:"Scene",name:"PathType",values:Za,sdkTypes:[Na.DIRECT]})})(e),function(e,t){const n=ne.create(t,new F(is));e.addAsyncCommandToInterface({namespace:"Scene",name:"register",args:["name","factory"],sdkTypes:[Na.DIRECT]},n),t.getDependencies().then((([t])=>{e.addEnumToInterface({namespace:"Scene",name:"Component",values:t.componentMap(),sdkTypes:[Na.DIRECT]})}))}(e,new pe(o)),function(e,t){const n=ne.create(t,new F(rs));e.addAsyncCommandToInterface({namespace:"Scene",name:"createNode",args:[],varArg:!1,sdkTypes:[Na.DIRECT]},n)}(e,new pe(o)),function(e,t,n){t.addBinding(cs,(async e=>{const[t]=await n.getDependencies();return t.sceneTags().getObjects(e.tags)})),e.addCommandCreator({namespace:"Scene",name:"query",args:["tags"],sdkTypes:[Na.DIRECT]},(e=>new cs(e)))}(e,t,new pe(o,a)),function(e,t,n,o){o.getDependencies().then((([e])=>{n.addBinding(ds,(async n=>{n.callback(e.threeRenderer,t,e.getScene().effectComposer)}))})),e.addCommandCreator({namespace:"Scene",name:"configure",args:["callback"],sdkTypes:[Na.DIRECT]},(e=>new ds(e)))}(e,n,t,new pe(s)),function(e,t,n){n.getDependencies().then((([e])=>{t.addBinding(ls,(async t=>e.getSignedUrls().getImageBitmap(t.path,t.width,t.height,t.options)))})),e.addCommandCreator({namespace:"Scene",name:"getImage",args:["path","width","height","options"],sdkTypes:[Na.DIRECT]},(e=>new ls(e)))}(e,t,new pe(i)),function(e,t){const n=ne.create(t,new F(hs));e.addAsyncCommandToInterface({namespace:"Scene",name:"deserialize",args:["text"],varArg:!1,sdkTypes:[Na.DIRECT]},n)}(e,new pe(o)),function(e,t){const n=ne.create(t,new F(ps));e.addCommandToInterface({namespace:"Scene",name:"serialize",args:["objects"],varArg:!1,sdkTypes:[Na.DIRECT]},n)}(e,new pe(o)),function(e,t){const n=ne.create(t,new F(ms));e.addAsyncCommandToInterface({namespace:"Scene",name:"createNodes",args:["count","userContext"],varArg:!1,sdkTypes:[Na.DIRECT]},n)}(e,new pe(o)),function(e,t){const n=ne.create(t,new F(gs));e.addAsyncCommandToInterface({namespace:"Scene",name:"registerComponents",args:["components"],sdkTypes:[Na.DIRECT]},n)}(e,new pe(o)),function(e,t){const n=ne.create(t,new F(fs));e.addAsyncCommandToInterface({namespace:"Scene",name:"createObjects",args:["count"],varArg:!1,sdkTypes:[Na.DIRECT]},n)}(e,new pe(o)),function(e,t,n){const o=ne.create(n,new F(ws));e.addCommandToInterface({namespace:"Scene",name:"unregisterComponents",args:["components"],varArg:!1,sdkTypes:[Na.DIRECT]},o)}(e,0,new pe(o))}(o,bt,T,Ne,be,Ue,Se),Bs(T,u.SourceType,u.sensorVolumes)(o,new pe(_e)),function(e,t,n,o){n.addBinding(t.SettingGetCommand,(async e=>{const[t]=await o.getDependencies();return t.tryGetProperty(e.key,t.settingsData.getOverrideParam(e.key,void 0))})),e.addCommandCreator({namespace:"Settings",name:"get",args:["key"]},(e=>new t.SettingGetCommand(e.key)))}(o,u,bt,new pe(Ve)),function(e,t,n,o){n.addBinding(t.SettingUpdateCommand,(async e=>{if(!e.key||"string"!=typeof e.key)throw Error("Settings: invalid key");const[t]=await o.getDependencies();return t.updateSetting(e.key,e.value),t.tryGetProperty(e.key,void 0)})),e.addCommandCreator({namespace:"Settings",name:"update",args:["key","value"]},(e=>new t.SettingUpdateCommand(e.key,e.value)))}(o,u,bt,new pe(Ve)),function(e,t,n){n.getDependencies().then((([n])=>{new Ws(t.waitForUpdate,n).calcAndBroadcast(e)})),e.addEnumToInterface({namespace:"Stat",name:"Event",values:js})}(o,bt,new pe(ae)),function(e,t){const n=ne.create(t,new F($s));e.addAsyncCommandToInterface({namespace:"XStorage",name:"setItem",args:["key","data"],origins:Ra},n)}(o,new pe(J)),function(e,t){const n=ne.create(t,new F(Ks));e.addAsyncCommandToInterface({namespace:"XStorage",name:"getItem",args:["key"],origins:Ra},n)}(o,new pe(J)),function(e,t){const n=ne.create(t,new F(Ys));e.addAsyncCommandToInterface({namespace:"XStorage",name:"getAllItems",args:["modelId"],origins:Ra},n)}(o,new pe(J)),function(e,t){const n=ne.create(t,new F(Xs));e.addAsyncCommandToInterface({namespace:"XStorage",name:"removeItem",args:["key"],origins:Ra},n)}(o,new pe(J)),function(e){e.addEnumToInterface({namespace:"Sweep",name:"Transition",values:I}),e.addEnumToInterface({namespace:"Sweep",name:"Alignment",values:h.Alignment}),e.addEnumToInterface({namespace:"Sweep",name:"Placement",values:h.Placement})}(o),function(e,t,n,o){const a=V.create(o,new Js,new F(ei,t,n));e.addObservableToInterface({namespace:"Sweep",name:"current"},a)}(o,u,bt,new pe(ie,de,j,Ot,Nt)),function(e,t,n,o){e.addEnumToInterface({namespace:"Sweep",name:"Event",values:h.Event});const a=["",""],s=()=>a;n.subscribe(t.BeginMoveToSweepMessage,(async t=>{const n=await o;t.fromSweep&&t.fromSweep!==t.toSweep&&(a[0]=t.fromSweep?n.getIdFromCwfId(t.fromSweep):t.fromSweep,a[1]=n.getIdFromCwfId(t.toSweep),e.broadcast(h.Event.EXIT,s,t))})),n.subscribe(t.BeginSwitchViewmodeMessage,(n=>{n.fromMode===t.Viewmode.Panorama&&n.toMode!==t.Viewmode.Panorama&&(a[0]=i[1],a[1]=void 0,e.broadcast(h.Event.EXIT,s))}));const i=["",""],r=()=>i;n.subscribe(t.EndMoveToSweepMessage,(async t=>{const n=await o;i[0]=t.fromSweep?n.getIdFromCwfId(t.fromSweep):t.fromSweep,i[1]=n.getIdFromCwfId(t.toSweep),e.broadcast(h.Event.ENTER,r)}))}(o,u,bt,Ot),function(e,t,n,o){const a=ne.create(o,new F(ti,t,n));e.addEnumToInterface({namespace:"Sweep",name:"Transition",values:I}),e.addCommandToInterface({namespace:"Sweep",name:"moveTo",args:["sweep","options"]},a)}(o,u,bt,new pe(ie,Ot,De)),function(e,t,n){const o=Ye.create(n,new ni,new F(oi,t.conversionUtils,t.sweepPlacementConverter));e.addCollectionToInterface({namespace:"Sweep",name:"data"},o)}(o,bt,new pe(ie,j,Ot,Nt)),function(e,t){const n=ne.create(t,new F(si)),o=ne.create(t,new F(ii));e.addCommandToInterface({namespace:"Sweep",name:"enable",args:["sweepIds"],varArg:!0},n),e.addCommandToInterface({namespace:"Sweep",name:"disable",args:["sweepIds"],varArg:!0},o)}(o,new pe(ie,re,Ot)),function(e){(function(e,t){const n=ne.create(t,new F(Hi));e.addCommandToInterface({namespace:"Test",name:"echo",args:["arg0"],varArg:!1,origins:Ra},n)})(e,new pe),function(e,t){const n=ne.create(t,new F(zi));e.addCommandToInterface({namespace:"Test",name:"directCommand",args:[],sdkTypes:[Na.DIRECT],varArg:!1,origins:Ra},n),e.addCommandToInterface({namespace:"Test",name:"postMessageCommand",args:[],sdkTypes:[Na.POSTMESSAGE],varArg:!1,origins:Ra},n)}(e,new pe),function(e){e.addEnumToInterface({namespace:"Test",name:"directEnum",values:Di,sdkTypes:[Na.DIRECT],origins:Ra}),e.addEnumToInterface({namespace:"Test",name:"postMessageEnum",values:Di,sdkTypes:[Na.POSTMESSAGE],origins:Ra})}(e),function(e,t){const n=Ye.create(t,new qi,new F($i));e.addCollectionToInterface({namespace:"Test",name:"directCollection",sdkTypes:[Na.DIRECT],origins:Ra},n),e.addCollectionToInterface({namespace:"Test",name:"postMessageCollection",sdkTypes:[Na.POSTMESSAGE],origins:Ra},n)}(e,new pe),function(e,t){const n=V.create(t,new Ki,new F(Yi));e.addObservableToInterface({namespace:"Test",name:"directObservable",sdkTypes:[Na.DIRECT],origins:Ra},n),e.addObservableToInterface({namespace:"Test",name:"postMessageObservable",sdkTypes:[Na.POSTMESSAGE],origins:Ra},n)}(e,new pe)}(o),function(e){e.addEnumToInterface({namespace:"Tour",name:"PlayState",values:p.PlayState})}(o),function(e,t,n){e.addEnumToInterface({namespace:"Tour",name:"Event",values:p.Event}),n.subscribe(t.TourStartedMessage,(()=>e.broadcast(p.Event.STARTED))),n.subscribe(t.TourStoppedMessage,(()=>e.broadcast(p.Event.STOPPED))),n.subscribe(t.TourEndedMessage,(()=>e.broadcast(p.Event.ENDED)));const o=[-1],a=e=>(o[0]=e.index,o);n.subscribe(t.TourSteppedMessage,(t=>e.broadcast(p.Event.STEPPED,a,t)))}(o,u,bt),tr(o,u,bt,new pe(Fe,ce)),function(e,t){const n=V.create(t,new or,new F(ar));e.addObservableToInterface({namespace:"Tour",name:"currentStep"},n)}(o,new pe(ce)),function(e,t,n){const o=V.create(n,new sr,new F(ir,t));e.addObservableToInterface({namespace:"Tour",name:"state"},o)}(o,bt,new pe(ce)),function(e,t){const n=V.create(t,new cr,new F(dr));e.addObservableToInterface({namespace:"Tour",name:"transition"},n)}(o,new pe(ce))}return new ee("SDK interface").info("Showcase SDK interface version","23.2.1_sdk-2-g0f96029da7"),v})()}));